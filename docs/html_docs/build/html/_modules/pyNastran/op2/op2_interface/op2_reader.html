

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyNastran.op2.op2_interface.op2_reader &mdash; pyNastran 1.4-dev 1.4-dev documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> pyNastran 1.4-dev
          

          
            
            <img src="../../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how_to/index.html">How To: pyNastran</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/pyNastran.html">pyNastran Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual/index.html">pyNastran Manual</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">pyNastran 1.4-dev</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>pyNastran.op2.op2_interface.op2_reader</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyNastran.op2.op2_interface.op2_reader</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines various tables that don&#39;t fit in other sections:</span>
<span class="sd">  - OP2Reader</span>
<span class="sd">    - read_cmodeext(self)</span>
<span class="sd">    - read_cmodeext_helper(self)</span>
<span class="sd">    - read_aemonpt(self)</span>
<span class="sd">    - read_monitor(self)</span>
<span class="sd">    - read_r1tabrg(self)</span>
<span class="sd">    - read_hisadd(self)</span>

<span class="sd">    - read_cstm(self)</span>
<span class="sd">    - read_dit(self)</span>
<span class="sd">    - read_extdb(self)</span>
<span class="sd">    - read_fol(self)</span>
<span class="sd">    - read_frl(self)</span>
<span class="sd">    - read_gpl(self)</span>
<span class="sd">    - read_ibulk(self)</span>
<span class="sd">    - read_intmod(self)</span>
<span class="sd">    - read_meff(self)</span>
<span class="sd">    - read_omm2(self)</span>
<span class="sd">    - read_sdf(self)</span>
<span class="sd">    - read_tol(self)</span>
<span class="sd">    - _skip_pcompts(self)</span>
<span class="sd">    - _read_pcompts(self)</span>

<span class="sd">  - Matrix</span>
<span class="sd">    - _get_matrix_row_fmt_nterms_nfloats(self, nvalues, tout)</span>
<span class="sd">    - _skip_matrix_mat(self)</span>
<span class="sd">    - read_matrix(self, table_name)</span>
<span class="sd">    - _read_matpool_matrix(self)</span>
<span class="sd">    - _read_matrix_mat(self)</span>
<span class="sd">    - grids_comp_array_to_index(grids1, comps1, grids2, comps2,</span>
<span class="sd">                                make_matrix_symmetric)</span>

<span class="sd">  - Others</span>
<span class="sd">    - _get_marker_n(self, nmarkers)</span>
<span class="sd">    - read_markers(self)</span>
<span class="sd">    - _skip_subtables(self)</span>
<span class="sd">    - _skip_table_helper(self)</span>
<span class="sd">    - _print_month(self, month, day, year, zero, one)</span>
<span class="sd">    - read_results_table(self)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">count</span>
<span class="kn">from</span> <span class="nn">struct</span> <span class="kn">import</span> <span class="n">unpack</span><span class="p">,</span> <span class="n">Struct</span><span class="p">,</span> <span class="n">error</span> <span class="k">as</span> <span class="n">struct_error</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>  <span class="c1"># type: ignore</span>

<span class="kn">from</span> <span class="nn">pyNastran.utils.numpy_utils</span> <span class="kn">import</span> <span class="n">integer_types</span>
<span class="kn">from</span> <span class="nn">pyNastran.f06.errors</span> <span class="kn">import</span> <span class="n">FatalError</span>
<span class="kn">from</span> <span class="nn">pyNastran.op2.errors</span> <span class="kn">import</span> <span class="n">FortranMarkerError</span><span class="p">,</span> <span class="n">SortCodeError</span>
<span class="kn">from</span> <span class="nn">pyNastran.op2.result_objects.gpdt</span> <span class="kn">import</span> <span class="n">GPDT</span><span class="p">,</span> <span class="n">BGPDT</span>
<span class="kn">from</span> <span class="nn">pyNastran.op2.result_objects.eqexin</span> <span class="kn">import</span> <span class="n">EQEXIN</span>
<span class="kn">from</span> <span class="nn">pyNastran.op2.result_objects.matrix</span> <span class="kn">import</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">MatrixDict</span>
<span class="kn">from</span> <span class="nn">pyNastran.op2.result_objects.design_response</span> <span class="kn">import</span> <span class="n">DSCMCOL</span>
<span class="kn">from</span> <span class="nn">pyNastran.op2.op2_interface.nx_tables</span> <span class="kn">import</span> <span class="n">NX_VERSIONS</span>


<span class="kn">from</span> <span class="nn">pyNastran.op2.result_objects.design_response</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">WeightResponse</span><span class="p">,</span> <span class="n">DisplacementResponse</span><span class="p">,</span> <span class="n">StressResponse</span><span class="p">,</span> <span class="n">StrainResponse</span><span class="p">,</span> <span class="n">ForceResponse</span><span class="p">,</span>
    <span class="n">FlutterResponse</span><span class="p">,</span> <span class="n">FractionalMassResponse</span><span class="p">,</span> <span class="n">Convergence</span><span class="p">,</span> <span class="n">Desvars</span><span class="p">,</span> <span class="n">DSCMCOL</span><span class="p">)</span>
<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="kn">from</span> <span class="nn">pyNastran.op2.op2</span> <span class="kn">import</span> <span class="n">OP2</span>

<span class="n">IS_TESTING</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1">#class MinorTables:</span>
    <span class="c1">#def __init__(self, op2_reader):</span>
        <span class="c1">#self.op2_reader = op2_reader</span>

<div class="viewcode-block" id="SubTableReadError"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.SubTableReadError">[docs]</a><span class="k">class</span> <span class="nc">SubTableReadError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<span class="n">DENSE_MATRICES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sa">b</span><span class="s1">&#39;KELM&#39;</span><span class="p">,</span>
    <span class="sa">b</span><span class="s1">&#39;MELM&#39;</span><span class="p">,</span>
    <span class="sa">b</span><span class="s1">&#39;BELM&#39;</span><span class="p">,</span>
    <span class="sa">b</span><span class="s1">&#39;KELMP&#39;</span><span class="p">,</span>
    <span class="sa">b</span><span class="s1">&#39;MELMP&#39;</span><span class="p">,</span>
<span class="p">]</span>

<div class="viewcode-block" id="OP2Reader"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader">[docs]</a><span class="k">class</span> <span class="nc">OP2Reader</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Stores methods that aren&#39;t useful to an end user&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op2</span><span class="p">:</span> <span class="n">OP2</span><span class="p">):</span>
        <span class="c1">#: should an h5_file be created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_as_h5</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1">#: the h5 file object used to reduce memory usage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h5_file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="c1"># Hack to dump the IBULK/CASECC decks in reverse order</span>
        <span class="c1"># It&#39;s in reverse because that&#39;s how Nastran writes it.</span>
        <span class="c1">#</span>
        <span class="c1"># We could write it correctly, but there&#39;s a chance the</span>
        <span class="c1"># deck could crash.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dump_deck</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">op2</span> <span class="o">=</span> <span class="n">op2</span>  <span class="c1"># type: OP2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mapped_tables</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">b</span><span class="s1">&#39;GPL&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_gpl</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;GPLS&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_gpls</span><span class="p">,</span>

            <span class="c1"># GPDT  - Grid point definition table</span>
            <span class="sa">b</span><span class="s1">&#39;GPDT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_gpdt</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;GPDTS&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_gpdt</span><span class="p">,</span>

            <span class="c1"># BGPDT - Basic grid point definition table.</span>
            <span class="sa">b</span><span class="s1">&#39;BGPDT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_bgpdt</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;BGPDTS&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_bgpdt</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;BGPDTOLD&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_bgpdt</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;BGPDTVU&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_bgpdt</span><span class="p">,</span>

            <span class="c1"># optimization</span>
            <span class="sa">b</span><span class="s1">&#39;DESCYC&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_descyc</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;DBCOPT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_dbcopt</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;DSCMCOL&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_dscmcol</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;DESTAB&#39;</span> <span class="p">:</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_read_destab</span><span class="p">,</span>

            <span class="c1">#b&#39;MEFF&#39; : self.read_meff,</span>
            <span class="sa">b</span><span class="s1">&#39;INTMOD&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_intmod</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;HISADD&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_hisadd</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;EXTDB&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_extdb</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;OMM2&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_omm2</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;STDISP&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_stdisp</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;TOL&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_tol</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;PCOMPT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_pcompts</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;PCOMPTS&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_pcompts</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;MONITOR&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_monitor</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;AEMONPT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_aemonpt</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;FOL&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fol</span><span class="p">,</span>  <span class="c1"># frequency response list</span>
            <span class="sa">b</span><span class="s1">&#39;FRL&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_frl</span><span class="p">,</span>  <span class="c1"># frequency response list</span>
            <span class="sa">b</span><span class="s1">&#39;SDF&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_sdf</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;IBULK&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_ibulk</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;ICASE&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_icase</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;CDDATA&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_cddata</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;CMODEXT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cmodext</span><span class="p">,</span>

            <span class="c1"># element matrices</span>
            <span class="c1">#b&#39;KELM&#39; : self._read_element_matrix,</span>
            <span class="c1">#b&#39;MELM&#39; : self._read_element_matrix,</span>
            <span class="c1">#b&#39;BELM&#39; : self._read_element_matrix,</span>
            <span class="c1">#b&#39;KELMP&#39; : self._read_element_matrix,</span>
            <span class="c1">#b&#39;MELMP&#39; : self._read_element_matrix,</span>

            <span class="c1"># element dictionaries</span>
            <span class="sa">b</span><span class="s1">&#39;KDICT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;MDICT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;BDICT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;KDICTP&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;MDICTP&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;KDICTDS&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;KDICTX&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;XDICT&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;XDICTB&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;XDICTDS&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;XDICTX&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dict</span><span class="p">,</span>

            <span class="c1"># coordinate system transformation matrices</span>
            <span class="sa">b</span><span class="s1">&#39;CSTM&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_cstm</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;CSTMS&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_cstm</span><span class="p">,</span>

            <span class="sa">b</span><span class="s1">&#39;R1TABRG&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_r1tabrg</span><span class="p">,</span>
            <span class="c1"># Qualifier info table???</span>
            <span class="sa">b</span><span class="s1">&#39;QUALINFO&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_qualinfo</span><span class="p">,</span>

            <span class="c1"># Equivalence between external and internal grid/scalar numbers</span>
            <span class="sa">b</span><span class="s1">&#39;EQEXIN&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_eqexin</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;EQEXINS&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_eqexin</span><span class="p">,</span>

            <span class="sa">b</span><span class="s1">&#39;XSOP2DIR&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_xsop2dir</span><span class="p">,</span>
        <span class="p">}</span>

<div class="viewcode-block" id="OP2Reader.read_nastran_version"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_nastran_version">[docs]</a>    <span class="k">def</span> <span class="nf">read_nastran_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the version header&quot;&quot;&quot;</span>
        <span class="c1">#try:</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#except:</span>
            <span class="c1">#self._goto(0)</span>
            <span class="c1">#try:</span>
                <span class="c1">#self.f.read(4)</span>
            <span class="c1">#except:</span>
                <span class="c1">#raise FatalError(&quot;The OP2 is empty.&quot;)</span>
            <span class="c1">#raise</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_mode = </span><span class="si">%s</span><span class="s1"> (vectorized; 1st pass)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_mode = </span><span class="si">%s</span><span class="s1"> (vectorized; 2nd pass)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">markers</span> <span class="o">==</span> <span class="p">[</span><span class="mi">3</span><span class="p">,]:</span>  <span class="c1"># PARAM, POST, -1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;marker = 3 -&gt; PARAM,POST,-1?</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">post</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block</span><span class="p">()</span>   <span class="c1"># TODO: is this the date...pretty sure at least for MSC</span>
            <span class="c1">#assert len(data) == 12, len(data)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">7</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_string_block</span><span class="p">()</span>  <span class="c1"># &#39;NASTRAN FORT TAPE ID CODE - &#39;</span>
            <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;NASTRAN FORT TAPE ID CODE - &#39;</span><span class="p">:</span>
                <span class="n">macro_version</span> <span class="o">=</span> <span class="s1">&#39;nastran&#39;</span>
            <span class="k">elif</span> <span class="sa">b</span><span class="s1">&#39;IMAT v&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">imat_version</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
                <span class="n">macro_version</span> <span class="o">=</span> <span class="s1">&#39;IMAT </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">imat_version</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;msc&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">version_ints</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">version_ints</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
                    <span class="n">macro_version</span> <span class="o">=</span> <span class="s1">&#39;MSFC&#39;</span>
                    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;msc&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
            <span class="c1">#print(&#39;macro_version = %r&#39; % macro_version)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1">#version_str = version.decode(self._encoding)</span>
            <span class="c1">#print(&#39;version = %r&#39; % version_str)</span>

            <span class="k">if</span> <span class="n">macro_version</span> <span class="o">==</span> <span class="s1">&#39;nastran&#39;</span><span class="p">:</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="n">_parse_nastran_version</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">macro_version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;IMAT&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;ATA&#39;</span><span class="p">),</span> <span class="n">version</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span> <span class="o">=</span> <span class="n">macro_version</span>
            <span class="k">elif</span> <span class="n">macro_version</span> <span class="o">==</span> <span class="s1">&#39;MSFC&#39;</span><span class="p">:</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span> <span class="o">=</span> <span class="n">macro_version</span>
                <span class="c1">#self.show_data(version)</span>
                <span class="c1">#assert version.startswith(b&#39;ATA&#39;), version</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">markers</span> <span class="o">==</span> <span class="p">[</span><span class="mi">2</span><span class="p">,]:</span>  <span class="c1"># PARAM, POST, -2</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;marker = 2 -&gt; PARAM,POST,-2?</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">post</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span> <span class="o">==</span> <span class="s1">&#39;autodesk&#39;</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;autodesk&#39;</span>
        <span class="k">elif</span> <span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span> <span class="o">==</span> <span class="s1">&#39;nasa95&#39;</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;nasa95&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;msc&#39;</span><span class="p">,</span> <span class="s1">&#39;nx&#39;</span><span class="p">,</span> <span class="s1">&#39;optistruct&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;nastran_format=</span><span class="si">{</span><span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span><span class="si">}</span><span class="s1"> mode=</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1"> and must be &quot;msc&quot;, &quot;nx&quot;, &quot;optistruct&quot;, or &quot;autodesk&quot;&#39;</span><span class="p">)</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No mode was set, assuming &#39;msc&#39;&quot;</span><span class="p">)</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;msc&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;mode = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">set_table_type</span><span class="p">()</span></div>

<div class="viewcode-block" id="OP2Reader.read_xsop2dir"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_xsop2dir">[docs]</a>    <span class="k">def</span> <span class="nf">read_xsop2dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matrix datablocks are named with the matrix name, and they contain</span>
<span class="sd">        only the matrices with no row and column DOF information.</span>

<span class="sd">        External superelements are written to the OP2 in the XSOP2DIR datablock</span>
<span class="sd">        which contains the directory of matrices, and multiple EXTDB datablocks</span>
<span class="sd">        that contain these matrices.  The information in XSOP2DIR can be used</span>
<span class="sd">        to rename the EXTDB datablocks to their corresponding matrix name.</span>

<span class="sd">        The MATPOOL datablock contains matrices of several different formats.</span>
<span class="sd">        MATPOOL matrices are DMIG-formatted matrices. Matrices from all of</span>
<span class="sd">        these sources can be stored as structured array.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># C:\MSC.Software\simcenter_nastran_2019.2\tpl_post1\extse04c_cnv1_0.op2</span>
        <span class="c1"># C:\MSC.Software\simcenter_nastran_2019.2\tpl_post2\extse04c_cnv1_0.op2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skip_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1">#op2 = self.op2</span>
        <span class="n">unused_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># (101, 14, 0, 0, 0, 0, 0)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="c1">#self.read_3_markers([-2, 1, 0])</span>
        <span class="c1">#data = self._read_record()</span>

        <span class="n">itable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">struct_8s</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">marker</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers4</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_4</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">struct_16s</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">marker</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">struct_16s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_8</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>
        <span class="c1">#b&#39;XSOP2DIR&#39;,</span>
        <span class="c1">#b&#39;PVT0    &#39;</span>
        <span class="c1">#b&#39;GEOM1EX &#39;</span>
        <span class="c1"># b&#39;GEOM2EX &#39;</span>
        <span class="c1"># b&#39;GEOM4EX &#39;</span>
        <span class="c1"># b&#39;GEOM1EXA&#39;</span>
        <span class="c1">#b&#39;MATK    &#39;</span>
        <span class="c1">#b&#39;MATM    &#39;</span>
        <span class="c1">#b&#39;MATV    &#39;</span>
        <span class="c1">#b&#39;TUG1    &#39;</span>
        <span class="c1">#b&#39;MUG1    &#39;</span>
        <span class="c1">#b&#39;TES1    &#39;</span>
        <span class="c1">#b&#39;MES1    &#39;</span>

<div class="viewcode-block" id="OP2Reader.read_eqexin"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_eqexin">[docs]</a>    <span class="k">def</span> <span class="nf">read_eqexin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;isat_random.op2&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">unused_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">fmt1</span> <span class="o">=</span> <span class="n">mapfmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="n">idata</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">101</span><span class="p">,</span> <span class="n">idata</span>
        <span class="n">unused_nnodes</span> <span class="o">=</span> <span class="n">idata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idata</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idata</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idata</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idata</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idata</span>
        <span class="c1">#print(&#39;----------------------&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_table_name</span><span class="p">([</span><span class="s1">&#39;EQEXIN&#39;</span><span class="p">,</span> <span class="s1">&#39;EQEXINS&#39;</span><span class="p">,</span> <span class="s1">&#39;EQEXNOUT&#39;</span><span class="p">])</span>
        <span class="c1">#print(&#39;----------------------&#39;)</span>
        <span class="c1"># ints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">eqexin1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">eqexin2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">nid</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">doftype</span> <span class="o">=</span> <span class="n">eqexin_to_nid_dof_doftype</span><span class="p">(</span><span class="n">eqexin1</span><span class="p">,</span> <span class="n">eqexin2</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">eqexin</span> <span class="o">=</span> <span class="n">EQEXIN</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">doftype</span><span class="p">)</span></div>
        <span class="c1">#print(&#39;nid = %s&#39; % nid.tolist()) [1,2,3,...]</span>
        <span class="c1">#print(&#39;dof = %s&#39; % dof.tolist()) [1,7,13,...]</span>
        <span class="c1">#print(&#39;doftype = %s&#39; % doftype.tolist())</span>

<div class="viewcode-block" id="OP2Reader.read_aemonpt"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_aemonpt">[docs]</a>    <span class="k">def</span> <span class="nf">read_aemonpt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the AEMONPT table&quot;&quot;&quot;</span>
        <span class="c1">#self.log.debug(&quot;table_name = %r&quot; % op2.table_name)</span>
        <span class="n">unused_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;record 1&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">bi</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">101</span><span class="p">,</span> <span class="n">a</span>
            <span class="k">assert</span> <span class="n">bi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bi</span>
            <span class="k">assert</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">27</span><span class="p">,</span> <span class="n">c</span>
            <span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span>
            <span class="k">assert</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">6</span><span class="p">,</span> <span class="n">e</span>
            <span class="k">assert</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span>
            <span class="k">assert</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">g</span>
        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;record 2&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="n">word</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">word</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;AECFMON &#39;</span><span class="p">,</span> <span class="n">word</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;record 3&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">108</span><span class="p">,</span> <span class="n">ndata</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">56</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="mi">12</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s 56s 5i 4s 8s 3i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
            <span class="p">(</span><span class="n">aero</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">comps</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">bi</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="o">=</span> <span class="n">out</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;aero=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">aero</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;comps=</span><span class="si">%r</span><span class="s1"> cp=</span><span class="si">%s</span><span class="s1"> b,c,d=(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">comps</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">bi</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;coeff=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">coeff</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;word=</span><span class="si">%r</span><span class="s1"> (e, f, g)=(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span> <span class="c1"># (1, 2, 0)</span>
            <span class="k">assert</span> <span class="n">cp</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cp</span>
            <span class="k">assert</span> <span class="n">bi</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bi</span>
            <span class="k">assert</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c</span>
            <span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span>
            <span class="k">assert</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">e</span>
            <span class="k">assert</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">f</span>
            <span class="k">assert</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">g</span>

        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;record 4&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1">#data = self._read_record()</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>

        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;end&#39;)</span>
        <span class="c1">#self.show(200)</span>

<div class="viewcode-block" id="OP2Reader.read_monitor"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">read_monitor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the MONITOR table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;table_name = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">unused_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;record 1&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">bi</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">101</span><span class="p">,</span> <span class="n">a</span>
            <span class="k">assert</span> <span class="n">bi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bi</span>
            <span class="k">assert</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">27</span><span class="p">,</span> <span class="n">c</span>
            <span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span>
            <span class="k">assert</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">6</span><span class="p">,</span> <span class="n">e</span>
            <span class="k">assert</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">f</span>
            <span class="k">assert</span> <span class="n">g</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">g</span>
        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;record 2&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">word</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">word</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;STCFMON &#39;</span><span class="p">,</span> <span class="n">word</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;record 3&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data[96:108])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">108</span><span class="p">,</span> <span class="n">ndata</span>
            <span class="p">(</span><span class="n">unused_aero</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">comps</span><span class="p">,</span> <span class="n">cp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">unused_coeff</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">cd</span><span class="p">,</span>
             <span class="n">ind_dof</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s 56s 2i 3f 4s 8s 3i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">108</span><span class="p">])</span>
            <span class="c1">#print(&#39;aero=%r&#39; % aero)</span>
            <span class="c1">#print(&#39;name=%r&#39; % name)</span>
            <span class="c1">#print(&#39;comps=%s cp=%s (x, y, z)=(%s, %s, %s)&#39; % (comps, cp, x, y, z))</span>
            <span class="c1">#print(&#39;coeff=%r&#39; % coeff)</span>
            <span class="c1">#print(&#39;word=%r (column, cd, ind_dof)=(%s, %s, %s)&#39; % (word, column, cd, ind_dof))</span>
            <span class="k">assert</span> <span class="n">cp</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cp</span>
            <span class="k">assert</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">x</span>
            <span class="k">assert</span> <span class="n">y</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">y</span>
            <span class="k">assert</span> <span class="n">d</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span>
            <span class="k">assert</span> <span class="n">column</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">column</span>
            <span class="k">assert</span> <span class="n">cd</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cd</span>
            <span class="k">assert</span> <span class="n">ind_dof</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ind_dof</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">monitor_data</span> <span class="o">=</span> <span class="p">[{</span>
                <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;cp&#39;</span> <span class="p">:</span> <span class="n">cp</span><span class="p">,</span>
                <span class="s1">&#39;cd&#39;</span> <span class="p">:</span> <span class="n">cd</span><span class="p">,</span>
                <span class="s1">&#39;xyz&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                <span class="s1">&#39;comps&#39;</span> <span class="p">:</span> <span class="n">comps</span><span class="p">,</span>
            <span class="p">}]</span>

        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;record 4&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1">#data = self._read_record()</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>

        <span class="c1">#print(&#39;-----------------------&#39;)</span>
        <span class="c1">#print(&#39;end&#39;)</span>
        <span class="c1">#self.show(200)</span>

    <span class="k">def</span> <span class="nf">_read_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;testing the KDICT&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skip_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#self.log.debug(&#39;table_name = %r&#39; % op2.table_name)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data)</span>

        <span class="n">unused_ints</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="c1">#print(&#39;date?  = (?, month, day, ?, ?, ?) =&#39;, ints)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1">#print(&#39;name = %r&#39; % name)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">matdict</span> <span class="o">=</span> <span class="n">MatrixDict</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">itable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">markers</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">break</span>
            <span class="c1">#-------------------------------------------------------------------</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
            <span class="n">n0</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">eltype</span><span class="p">,</span> <span class="n">numwids</span><span class="p">,</span> <span class="n">numgrid</span><span class="p">,</span> <span class="n">dof_per_grid</span><span class="p">,</span> <span class="n">form</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;5i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
            <span class="n">n0</span> <span class="o">+=</span> <span class="mi">20</span>
            <span class="c1">#print(&#39;etype&#39;, eltype)</span>
            <span class="c1">#print(&#39;numwids&#39;, numwids)</span>
            <span class="c1">#print(&#39;numgrid&#39;, numgrid)</span>
            <span class="c1">#print(&#39;dof_per_grid&#39;, dof_per_grid)</span>
            <span class="c1">#print(&#39;form&#39;, form)</span>
            <span class="n">eids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ge</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">address</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xforms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">sils</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">n0</span> <span class="o">&lt;</span> <span class="n">ndata</span><span class="p">:</span>
                <span class="c1">#print(&quot;--------&quot;)</span>
                <span class="c1">#print(&#39;n0=%s ndata=%s&#39; % (n0, ndata))</span>
                <span class="n">eid</span><span class="p">,</span> <span class="n">unused_nactive_grid</span><span class="p">,</span> <span class="n">gei</span><span class="p">,</span> <span class="n">address1</span><span class="p">,</span> <span class="n">address2</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;2i f 2i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">n0</span><span class="p">:</span><span class="n">n0</span><span class="o">+</span><span class="mi">20</span><span class="p">])</span>
                <span class="n">eids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eid</span><span class="p">)</span>
                <span class="n">ge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gei</span><span class="p">)</span>
                <span class="n">address</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">address1</span><span class="p">,</span> <span class="n">address2</span><span class="p">])</span>
                <span class="n">n0</span> <span class="o">+=</span> <span class="mi">20</span>
                <span class="c1">#print(&#39;eid&#39;, eid)</span>
                <span class="c1">#print(&#39;nactive_grid&#39;, nactive_grid)</span>
                <span class="c1">#print(&#39;ge&#39;, ge)</span>
                <span class="c1">#print(&#39;address1&#39;, address1)</span>
                <span class="c1">#print(&#39;address2&#39;, address2)</span>
                <span class="k">if</span> <span class="n">form</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
                    <span class="n">nbytes</span> <span class="o">=</span> <span class="n">numgrid</span> <span class="o">*</span> <span class="mi">4</span>
                    <span class="n">sil</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">i&#39;</span> <span class="o">%</span> <span class="n">numgrid</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">n0</span><span class="p">:</span><span class="n">n0</span><span class="o">+</span><span class="n">nbytes</span><span class="p">])</span>
                    <span class="n">n0</span> <span class="o">+=</span> <span class="n">nbytes</span>
                    <span class="c1">#print(&#39;sil =&#39;, sil)</span>
                    <span class="k">assert</span> <span class="nb">min</span><span class="p">(</span><span class="n">sil</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sil</span>
                    <span class="k">assert</span> <span class="nb">max</span><span class="p">(</span><span class="n">sil</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100000000</span><span class="p">,</span> <span class="n">sil</span>
                    <span class="n">sils</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sil</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">form</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">form</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
                    <span class="n">xform</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;9d&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">n0</span><span class="p">:</span><span class="n">n0</span><span class="o">+</span><span class="mi">36</span><span class="o">*</span><span class="mi">2</span><span class="p">])</span>
                    <span class="n">xform_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xform</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="c1">#print(xform_array)</span>
                    <span class="n">xforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xform_array</span><span class="p">)</span>
                    <span class="n">n0</span> <span class="o">+=</span> <span class="mi">36</span><span class="o">*</span><span class="mi">2</span>
                    <span class="c1">#print(&#39;xform =&#39;, xform, len(xform))</span>
                <span class="c1">#self.show_data(data[:n0+80], types=&#39;if&#39;)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xforms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xforms</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">eids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eids</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
            <span class="n">ge</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ge</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="n">address</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
            <span class="n">sils</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sils</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
            <span class="c1">#print(&#39;eids, address:\n&#39;, eids, &#39;\n&#39;, address)</span>
            <span class="c1">#print(&#39;sils (etype=%s):\n%s&#39; % (eltype, sils))</span>
            <span class="n">matdict</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">eltype</span><span class="p">,</span> <span class="n">numwids</span><span class="p">,</span> <span class="n">numgrid</span><span class="p">,</span> <span class="n">dof_per_grid</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span>
                        <span class="n">eids</span><span class="p">,</span> <span class="n">ge</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">sils</span><span class="p">,</span> <span class="n">xform</span><span class="o">=</span><span class="n">xforms</span><span class="p">)</span>
            <span class="c1">#-------------------------------------------------------------------</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">matdicts</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">matdict</span>

    <span class="k">def</span> <span class="nf">_read_destab</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;reads the DESTAB table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>

        <span class="n">result_name</span> <span class="o">=</span> <span class="s1">&#39;responses.desvars&#39;</span>
        <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">is_not_saved</span><span class="p">(</span><span class="n">result_name</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_table</span><span class="p">(</span><span class="s1">&#39;DESTAB&#39;</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1">#if self.read_mode == 1:</span>
            <span class="c1">#return ndata</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#self.log.debug(&#39;table_name = %r&#39; % op2.table_name)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;_read_destab - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="c1"># (101, 3, 3, 0, 3, 0, 0)</span>

        <span class="n">itable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">destab</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">structi</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="s1">&#39;2i 8s 4f&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">destab</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_16s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">destab</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">destab</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">structi</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="s1">&#39;2q 16s 4d&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">destab</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;DESTAB&#39;</span><span class="p">,</span> <span class="n">destab</span>

        <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">desvars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">markers</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">break</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

            <span class="c1">#self.show(100, types=&#39;ifs&#39;, endian=None)</span>
            <span class="c1">#self.show_data(data[:8], types=&#39;ifs&#39;, endian=None)</span>

            <span class="c1">#1 IDVID I Internal design variable identification number</span>
            <span class="c1">#2 DVID I External design variable identification number</span>
            <span class="c1">#3 LABEL1 CHAR4 First part of design Variable</span>
            <span class="c1">#4 LABEL2 CHAR4 Second part of design Variable</span>
            <span class="c1">#5 VMIN RS Lower bound</span>
            <span class="c1">#6 VMAX RS Upper bound</span>
            <span class="c1">#7 DELX RS Move limit for a design cycle</span>
            <span class="c1"># 8 ???</span>

            <span class="c1">#C:\NASA\m4\formats\git\examples\move_tpl\accopt3.op2</span>
            <span class="c1">#---------------------------------------------------------------------------------------------------------</span>
                <span class="c1">#INTERNAL       DESVAR                         LOWER                               UPPER</span>
                    <span class="c1">#ID            ID          LABEL            BOUND             VALUE             BOUND</span>
            <span class="c1">#---------------------------------------------------------------------------------------------------------</span>
                <span class="c1">#1             1      THICK           2.0000E-02        5.0000E-02        8.0000E-02</span>
                <span class="c1">#2             2      SPRING          1.0000E-02        6.2500E-02        7.5000E-02</span>
                <span class="c1">#3             3      SPRING          5.0000E-02        1.2500E-01        1.5000E-01</span>
            <span class="c1"># internal, desvar, label, lower,   upper,  ???,  ???</span>
            <span class="c1"># (1, 1, b&#39;THICK   &#39;, 0.019999, 0.07999999, -0.5, 0.0)</span>
            <span class="c1"># (2, 2, b&#39;SPRING  &#39;, 0.009999, 0.07500000, -0.5, 0.0)</span>
            <span class="c1"># (3, 3, b&#39;SPRING  &#39;, 0.050000, 0.15000000, -0.5, 0.0)</span>

            <span class="c1">##        id       label   xinit   xlb   xub delxv</span>
            <span class="c1">#DESVAR  1       THICK   .05     0.02    .08</span>
            <span class="c1">#DESVAR  2       SPRING  .0625   .01     .075</span>
            <span class="c1">#DESVAR  3       SPRING  .125    .05     .15</span>

            <span class="c1"># C:\NASA\m4\formats\git\examples\move_tpl\betaadj.op2</span>
            <span class="c1">#---------------------------------------------------------------------------------------------------------</span>
                <span class="c1">#INTERNAL       DESVAR                         LOWER                               UPPER</span>
                    <span class="c1">#ID            ID          LABEL            BOUND             VALUE             BOUND</span>
            <span class="c1">#---------------------------------------------------------------------------------------------------------</span>
                <span class="c1">#11            20      BETA            1.0000E-03        8.0000E-01        1.0000E+20</span>
            <span class="c1"># int, des, label,     lower,     upper,     ???,  ???</span>
            <span class="c1">#(11, 20, b&#39;BETA    &#39;, 0.0010000, 1.000e+20, 0.200, 0.0)</span>
            <span class="c1">#        id       label   xinit   xlb   xub delxv</span>
            <span class="c1">#desvar  20       beta    0.8     0.001	xub	0.20</span>
            <span class="n">desvar</span> <span class="o">=</span> <span class="n">structi</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1">#internal_id, desvar_id, label, lower, upper, delxv, dunno = desvar</span>
            <span class="c1">#print(desvar)</span>
            <span class="c1">#assert np.allclose(desvar[5], -0.5), desvar  # -0.5 is the default</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">desvar</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">desvar</span>
            <span class="n">desvars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">desvar</span><span class="p">)</span>
            <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">desvars</span> <span class="o">=</span> <span class="n">Desvars</span><span class="p">(</span><span class="n">desvars</span><span class="p">)</span>
        <span class="c1">#if self.read_mode == 2:</span>
            <span class="c1">#self.log.warning(&#39;DESTAB results were read, but not saved&#39;)</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">_read_cmodext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fails if a streaming block???:</span>
<span class="sd">         - nx_spike\mnf16_0.op2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;table_name = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;_read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---marker0 = </span><span class="si">%s</span><span class="s1">---</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers</span><span class="p">)</span>

        <span class="n">marker</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">marker</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">unused_table_name</span><span class="p">,</span> <span class="n">oneseventy_a</span><span class="p">,</span> <span class="n">oneseventy_b</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;8sii&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">table_name</span><span class="p">,</span> <span class="n">oneseventy_a</span><span class="p">,</span> <span class="n">oneseventy_b</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;16sqq&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">unused_table_name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">oneseventy_a</span> <span class="o">==</span> <span class="mi">170</span><span class="p">,</span> <span class="n">oneseventy_a</span>
        <span class="k">assert</span> <span class="n">oneseventy_b</span> <span class="o">==</span> <span class="mi">170</span><span class="p">,</span> <span class="n">oneseventy_b</span>
        <span class="c1">#print(&#39;170*4 =&#39;, 170*4)</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cmodext_helper</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span> <span class="c1"># -3</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cmodext_helper</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cmodext_helper</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cmodext_helper</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cmodext_helper</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;table8&#39;</span><span class="p">)</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_cmodext_helper</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">show_ndata</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_cmodext_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker_orig</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="n">marker_orig</span>
        <span class="c1">#markers = self.read_nmarkers([marker, 1, 1]) # -3</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">show_ndata</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">markers</span> <span class="o">==</span> <span class="p">[</span><span class="n">marker_orig</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">markers</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;markers =&#39;</span><span class="p">,</span> <span class="n">markers</span><span class="p">)</span>

        <span class="c1">#marker = self.get_nmarkers(1, rewind=False, macro_rewind=False)[0]</span>
        <span class="n">val_old</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------------------&#39;</span><span class="p">)</span>
        <span class="c1">#i = 0</span>
        <span class="c1">#icheck = 7</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1">#print(&#39;i = %i&#39; % i)</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">marker</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;marker = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">marker</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">marker</span> <span class="o">==</span> <span class="mi">6</span><span class="p">,</span> <span class="n">marker</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block</span><span class="p">()</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;val=</span><span class="si">%s</span><span class="s1"> delta=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span> <span class="o">-</span> <span class="n">val_old</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifs&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span>
            <span class="c1">#print(&#39;i=%s val=%s delta=%s&#39; % (i, val, val - val_old))</span>
            <span class="n">val_old</span> <span class="o">=</span> <span class="n">val</span>

            <span class="n">marker2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#print(marker2)</span>
            <span class="k">if</span> <span class="n">marker2</span> <span class="o">==</span> <span class="mi">696</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="c1">#i += 1</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------------&#39;</span><span class="p">)</span>

        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;****marker = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">marker</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">marker</span> <span class="o">==</span> <span class="mi">696</span><span class="p">,</span> <span class="n">marker</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block</span><span class="p">()</span>
        <span class="c1">#self.show_data(data)</span>

        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="n">marker</span> <span class="o">==</span> <span class="p">(</span><span class="n">marker_orig</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">marker</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">show_ndata</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">marker</span>

        <span class="c1">#data = self._read_record()</span>
        <span class="c1">#marker -= 1</span>
        <span class="c1">#op2.show_ndata(100)</span>

        <span class="c1">##marker -= 1</span>
        <span class="c1">##marker_end = op2.get_marker1(rewind=False)</span>

<div class="viewcode-block" id="OP2Reader.read_cstm"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_cstm">[docs]</a>    <span class="k">def</span> <span class="nf">read_cstm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the CSTM table, which defines the transform from global to basic.</span>

<span class="sd">        Returns 14-column matrix 2-d array of the CSTM data:</span>
<span class="sd">        ::</span>
<span class="sd">          [</span>
<span class="sd">           [ id1 type xo yo zo T(1,1:3) T(2,1:3) T(3,1:3) ]</span>
<span class="sd">           [ id2 type xo yo zo T(1,1:3) T(2,1:3) T(3,1:3) ]</span>
<span class="sd">           ...</span>
<span class="sd">          ]</span>

<span class="sd">        T is transformation from local to basic for the coordinate system.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">is_geometry</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">is_geometry</span>
        <span class="n">unused_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#print(self.show_data(data, types=&#39;ifsqd&#39;))</span>
        <span class="c1"># 101, 466286, 15,      1, 1, 180, 0</span>
        <span class="c1"># 101, 466286, ncoords, 1, 1, 180, 0</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
        <span class="c1">#if self.size == 4:</span>
            <span class="c1">#idtype = &#39;int32&#39;</span>
            <span class="c1">#fdtype = &#39;float32&#39;</span>
        <span class="c1">#else:</span>
            <span class="c1">#idtype = &#39;int64&#39;</span>
            <span class="c1">#fdtype = &#39;float64&#39;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span> <span class="c1"># CSTM</span>
        <span class="c1">#print(self.show_data(data, types=&#39;s&#39;))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">factor</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">coord_type_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span> <span class="p">:</span> <span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span>
            <span class="mi">2</span> <span class="p">:</span> <span class="s1">&#39;???&#39;</span><span class="p">,</span>
            <span class="mi">3</span> <span class="p">:</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">,</span>
            <span class="mi">5</span> <span class="p">:</span> <span class="s1">&#39;GMSURF&#39;</span><span class="p">,</span>
            <span class="mi">7</span> <span class="p">:</span> <span class="s1">&#39;???&#39;</span><span class="p">,</span>
            <span class="mi">8</span> <span class="p">:</span> <span class="s1">&#39;???&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1">#1. Coordinate system type:</span>
        <span class="c1">#- 0 = unknown (seriously?)</span>
        <span class="c1">#- 1 = rectangular</span>
        <span class="c1">#- 2 = cylindrical</span>
        <span class="c1">#- 3 = spherical</span>
        <span class="c1">#- 4 = convective coordinate system defined on a GMCURV+GMSURF pair</span>
        <span class="c1">#- 5 = convective coordinate system defined on a GMSURF</span>
        <span class="c1">#- 6 = convective coordinate system defined on a FEEDGE+FEFACE pair</span>
        <span class="c1">#- 7 = convective coordinate system defined on a FEFACE</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">itable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>

        <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">markers</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">break</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
            <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_geometry</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="sa">b</span><span class="s1">&#39;GEOM1&#39;</span> <span class="ow">in</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_names</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">nblocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nblocks</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># vectorized</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span>
            <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">fdtype8</span><span class="p">)</span>
            <span class="c1">#doubles = np.frombuffer(blocks[1], dtype=&#39;float64&#39;)</span>
            <span class="n">nints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">nints</span> <span class="o">%</span> <span class="mi">14</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;nints=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nints</span><span class="p">)</span>
            <span class="n">ncstm</span> <span class="o">=</span> <span class="n">get_table_size_from_ncolumns</span><span class="p">(</span><span class="s1">&#39;CSTM&#39;</span><span class="p">,</span> <span class="n">nints</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">ints</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncstm</span><span class="p">,</span> <span class="mi">14</span><span class="p">)[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">floats</span> <span class="o">=</span> <span class="n">floats</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncstm</span><span class="p">,</span> <span class="mi">14</span><span class="p">)[:,</span> <span class="mi">2</span><span class="p">:]</span>
            <span class="c1">#assert ncstm == 1, &#39;ncoords = %s&#39; % ncstm</span>
            <span class="c1">#print(self.coords)</span>
            <span class="c1">#for i, unused_coord in enumerate(ints):</span>
            <span class="n">cid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">coord_type_int</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">coord_type_int</span> <span class="ow">in</span> <span class="n">coord_type_map</span><span class="p">:</span>
                <span class="n">unused_coord_type</span> <span class="o">=</span> <span class="n">coord_type_map</span><span class="p">[</span><span class="n">coord_type_int</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;cid=</span><span class="si">%s</span><span class="s1"> coord_type_int=</span><span class="si">%s</span><span class="s1"> is not supported</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">coord_type_int</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;coords&#39;</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">intsi</span><span class="p">,</span> <span class="n">valuesi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ints</span><span class="p">,</span> <span class="n">floats</span><span class="p">):</span>
                <span class="n">cid</span> <span class="o">=</span> <span class="n">intsi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">coord_type_int</span> <span class="o">=</span> <span class="n">intsi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">valuesi</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">,</span> <span class="n">valuesi</span>
                <span class="c1">#if coord_type_int in coord_type_map:</span>
                    <span class="c1">#unused_coord_type = coord_type_map[coord_type_int]</span>
                <span class="c1">#else:  # pragma: no cover</span>
                    <span class="c1">#msg = &#39;cid=%s coord_type_int=%s is not supported\n&#39; % (cid, coord_type_int)</span>
                    <span class="c1">#if hasattr(self, &#39;coords&#39;):</span>
                        <span class="c1">#print(op2.coords)</span>
                    <span class="c1">#raise RuntimeError(msg)</span>

                <span class="n">origin</span> <span class="o">=</span> <span class="n">valuesi</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">valuesi</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">unused_j</span> <span class="o">=</span> <span class="n">valuesi</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">valuesi</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
                <span class="n">zaxis</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">k</span>
                <span class="n">xzplane</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">i</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">origin</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">zaxis</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xzplane</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">xzplane</span>
                <span class="k">if</span> <span class="n">coord_type_int</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">add_cord2r</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="n">xzplane</span><span class="p">,</span>
                                                <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">coord_type_int</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">add_cord2c</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="n">xzplane</span><span class="p">,</span>
                                                <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">coord_type_int</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">add_cord2s</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="n">xzplane</span><span class="p">,</span>
                                                <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">coord_type_int</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="c1">#- 7 = convective coordinate system defined on a FEFACE</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">coord_type_int</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="c1">#- 7 = convective coordinate system defined on a FEFACE</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">coord_type_int</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="c1">#- 7 = convective coordinate system defined on a FEFACE</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;coord_type_int=</span><span class="si">{</span><span class="n">coord_type_int</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nblocks</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># cstm style</span>
            <span class="c1">#block4 - 4 values  - cid, type, int_index, double_index</span>
            <span class="c1">#block5 - 12 values - ox, oy, oz, T11, T12, T13, T21, T22, T23, T31, T32, T33</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span>
            <span class="n">doubles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="n">nints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>
            <span class="n">ndoubles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">doubles</span><span class="p">)</span>
            <span class="n">ncoords</span> <span class="o">=</span> <span class="n">nints</span> <span class="o">//</span> <span class="mi">4</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">ints</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncoords</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="c1">#print(&#39;ints =&#39;, ints.tolist())</span>
            <span class="k">if</span> <span class="n">ncoords</span> <span class="o">==</span> <span class="n">ndoubles</span> <span class="o">//</span> <span class="mi">12</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">doubles</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncoords</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
                <span class="c1">#print(&#39;doubles =&#39;, doubles.tolist())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ncoords</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
                <span class="c1">#print(&#39;floats =&#39;, floats.tolist())</span>
            <span class="k">for</span> <span class="n">intsi</span><span class="p">,</span> <span class="n">valuesi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ints</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
                <span class="n">cid</span><span class="p">,</span> <span class="n">cid_type</span><span class="p">,</span> <span class="n">unused_int_index</span><span class="p">,</span> <span class="n">unused_double_index</span> <span class="o">=</span> <span class="n">intsi</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">valuesi</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">,</span> <span class="n">valuesi</span>

                <span class="n">origin</span> <span class="o">=</span> <span class="n">valuesi</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">valuesi</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">unused_j</span> <span class="o">=</span> <span class="n">valuesi</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">valuesi</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>
                <span class="n">zaxis</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">k</span>
                <span class="n">xzplane</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">i</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">origin</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">zaxis</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">xzplane</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="n">xzplane</span>
                <span class="k">if</span> <span class="n">cid_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">add_cord2r</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="n">xzplane</span><span class="p">,</span>
                                                <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">cid_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">add_cord2c</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="n">xzplane</span><span class="p">,</span>
                                                <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">cid_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">add_cord2s</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="n">xzplane</span><span class="p">,</span>
                                                <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cid_type=</span><span class="si">{</span><span class="n">cid_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;nCSTM blocks=</span><span class="si">{</span><span class="n">nblocks</span><span class="si">}</span><span class="s1"> (not 1 or 2)&#39;</span><span class="p">)</span></div>

        <span class="c1">#print(self.op2.coords)</span>

        <span class="c1">#while i &lt; len(ints):</span>
            <span class="c1">#break</span>
            <span class="c1">#cid = ints[i]</span>
            <span class="c1">#coord_type_int = ints[i + 1]</span>

            <span class="c1">#if coord_type_int in coord_type_map:</span>
                <span class="c1">#unused_coord_type = coord_type_map[coord_type_int]</span>
            <span class="c1">#else:  # pragma: no cover</span>
                <span class="c1">#msg = &#39;cid=%s coord_type_int=%s is not supported\n&#39; % (cid, coord_type_int)</span>
                <span class="c1">#if hasattr(self, &#39;coords&#39;):</span>
                    <span class="c1">#print(op2.coords)</span>
                <span class="c1">#raise RuntimeError(msg)</span>

            <span class="c1">#if coord_type_int in [1, 2, 3]: # rectangular, cylindrical, spherical</span>
                <span class="c1">#translations_cosines = floats[i+3:i+14]</span>
                <span class="c1">#print(len(translations_cosines))</span>
                <span class="c1">#i += 14</span>
            <span class="c1">#else:</span>
                <span class="c1">#raise NotImplementedError(&#39;coord_type_int = %i&#39; % coord_type_int)</span>
        <span class="c1">#if 0:</span>
            <span class="c1">## vectorized</span>
            <span class="c1">#assert nints % 14 == 0, &#39;nints=%s&#39; % (nints)</span>
            <span class="c1">#ncstm = get_table_size_from_ncolumns(&#39;CSTM&#39;, nints, 14)</span>
            <span class="c1">#ints = ints.reshape(ncstm, 14)[:, :2]</span>
            <span class="c1">#floats = floats.reshape(ncstm, 14)[:, 2:]</span>
            <span class="c1">##assert ncstm == 1, &#39;ncoords = %s&#39; % ncstm</span>
            <span class="c1">##print(self.coords)</span>
            <span class="c1">#for i, unused_coord in enumerate(ints):</span>
                <span class="c1">#cid = ints[i, 0]</span>
                <span class="c1">#coord_type_int = ints[i, 1]</span>
            <span class="c1">#if coord_type_int in coord_type_map:</span>
                <span class="c1">#unused_coord_type = coord_type_map[coord_type_int]</span>
            <span class="c1">#else:  # pragma: no cover</span>
                <span class="c1">#msg = &#39;cid=%s coord_type_int=%s is not supported\n&#39; % (cid, coord_type_int)</span>
                <span class="c1">#if hasattr(self, &#39;coords&#39;):</span>
                    <span class="c1">#print(op2.coords)</span>
                <span class="c1">#raise RuntimeError(msg)</span>

            <span class="c1">#print(self.coords)</span>
            <span class="c1">#print(&#39;cid = &#39;, cid)</span>
            <span class="c1">#print(&#39;coord_type = &#39;, coord_type)</span>
            <span class="c1">#print(&#39;myints =&#39;, ints)</span>
            <span class="c1">#print(&#39;floats =&#39;, floats)</span>



<div class="viewcode-block" id="OP2Reader.read_qualinfo"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_qualinfo">[docs]</a>    <span class="k">def</span> <span class="nf">read_qualinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the QUALINFO table</span>

<span class="sd">        -100001 (AUXMID=0;AFPMID=0;DESITER=0;HIGHQUAL=0;PVALID=0;DESINC=0;DISCRETE=FALSE;MASSID=0;ARBMID=0;PARTNAME=&#39; &#39;;TRIMID=0;MODULE=0)</span>
<span class="sd">        -100000 (AUXMID=0;AFPMID=0;DESITER=0;HIGHQUAL=0;PVALID=0;DESINC=0;ARBMID=0;PARTNAME=&#39; &#39;;DISCRETE=FALSE;TRIMID=0)</span>
<span class="sd">         -99999 (AUXMID=0;AFPMID=0;HIGHQUAL=0;PVALID=0;DESINC=0;PRESEQP=TRUE;ARBMID=0;PARTNAME=&#39; &#39;;TRIMID=0;FLXBDYID=0;DFPHASE=&#39; &#39;)</span>
<span class="sd">         -99998 (AUXMID=0;AFPMID=0;DESITER=0;HIGHQUAL=0;DESINC=0;DISCRETE=FALSE;ARBMID=0;MASSID=0;PARTNAME=&#39; &#39;;TRIMID=0)</span>
<span class="sd">           1431 (HIGHQUAL=0;AUXMID=0;AFPMID=0;DESINC=0;ARBMID=0;PARTNAME=&#39; &#39;;TRIMID=0;FLXBDYID=0)</span>
<span class="sd">           1459 (PEID=0;DESITER=0;PVALID=0;NL99=0;APRCH=&#39; &#39;;QCPLD=&#39; &#39;;HIGHQUAL=0;AUXMID=0;DESINC=0;DISCRETE=FALSE;MASSID=0;PARTNAME=&#39; &#39;;MODULE=0)</span>
<span class="sd">           1461 (PEID=0;APRCH=&#39; &#39;;QCPLD=&#39; &#39;;HIGHQUAL=0;AUXMID=0;DESINC=0;PARTNAME=&#39; &#39;;MODULE=0)</span>
<span class="sd">           1541 (SEID=0;PEID=0;MTEMP=0;DESITER=0;PVALID=0;APRCH=&#39; &#39;;QCPLD=&#39; &#39;;HIGHQUAL=0;P2G=&#39; &#39;;K2GG=&#39; &#39;;M2GG=&#39; &#39;;DELTA=FALSE;AUXMID=0;BNDSHP=FALSE;ADJOINT=FALSE;DESINC=0;DISCRETE=FALSE;CASEF06=&#39; &#39;;ISOLAPP=1;SUBCID=0;OSUBID=1;STEPID=0;RGYRO=0;PARTNAME=&#39; &#39;;SSTEPID=0;MODULE=0)</span>

<span class="sd">        Word Name Type Description</span>
<span class="sd">        1 NAME(2) CHAR4 Datablock Name</span>

<span class="sd">        Word Name Type Description</span>
<span class="sd">        1 DBKEY   I     database KEY associated with qualifiers</span>
<span class="sd">        2 QLEN(C) I     length in words of qualifiers string</span>
<span class="sd">        3 QUALSTR CHAR4 Qualifier information string</span>
<span class="sd">        Word 3 repeats QLEN times</span>

<span class="sd">        Word Name Type Description</span>
<span class="sd">        1 FUNIT   I Fortran unit op2 file was written to</span>
<span class="sd">        2 NUMKEYS I Number of keys</span>
<span class="sd">        3 BIT(5)  I ,{</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we read the table on the first pass, so if we ever see a</span>
        <span class="c1"># 64-bit table, the error message makes a bit more sense</span>
        <span class="n">read_record_ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_skip_read_record_ndata</span><span class="p">()</span>

        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#self.log.debug(&#39;table_name = %r&#39; % op2.table_name)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;_read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># (301, 1, 8, 0, 0, 0, 0)</span>
        <span class="c1"># (???, ?, n, ?, ?, ?, ?)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="n">read_record_ndata</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">28</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c1"># 7*4</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1"># QUALINFO</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="n">read_record_ndata</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">itable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">stop_marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stop_marker</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="n">read_record_ndata</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">db_key</span><span class="p">,</span> <span class="n">qlen</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;2i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ndata</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
                <span class="n">qual_str</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">db_key</span><span class="si">:</span><span class="s1"> 7d</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">qual_str</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">stop_marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.read_extdb"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_extdb">[docs]</a>    <span class="k">def</span> <span class="nf">read_extdb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fails if a streaming block:</span>
<span class="sd">         - nx_spike\extse04c_0.op2</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># C:\MSC.Software\simcenter_nastran_2019.2\tpl_post1\extse04c_cnv1_0.op2</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;table_name = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;_read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---marker0 = </span><span class="si">%s</span><span class="s1">---</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="c1">#self.show_data(data, types=&#39;ifs&#39;, endian=None)</span>
                <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="c1">#print(name, 8)</span>
            <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">int1</span><span class="p">,</span> <span class="n">int2</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s 2i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="c1">#name = name.decode(self._encoding)</span>
                <span class="c1">#print(name, int1, int2, 16)</span>
            <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
                <span class="c1">#self.show_data(data)</span>
                <span class="n">name1</span><span class="p">,</span> <span class="n">int1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">int2</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s i 12s i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="c1">#print(name1, int1, name2, int2, 28)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifs&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">int1</span><span class="p">,</span> <span class="n">int2</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s 2q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">56</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifsd&#39;</span><span class="p">)</span>
                <span class="n">name1</span><span class="p">,</span> <span class="n">int1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">int2</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s q 24s q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">name1</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name1</span><span class="p">)</span>
                <span class="n">name2</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifsdq&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifsdq&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>

        <span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># old</span>
            <span class="c1">#self.show(200)</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1">#print(&#39;====================&#39;)</span>
                <span class="c1">#print(f&#39;***reading {marker}&#39;)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">marker</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                <span class="k">except</span> <span class="n">FortranMarkerError</span><span class="p">:</span>
                    <span class="c1">#op2.show_ndata(100)</span>
                    <span class="k">raise</span>

                <span class="n">nfields1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nfields1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nfields1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">nfields1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1">#data, ndata = self._read_record_ndata()</span>
                    <span class="n">nfields1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>

                    <span class="n">nfields_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">while</span> <span class="n">nfields_test</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block</span><span class="p">()</span>
                        <span class="n">nblock</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
                        <span class="n">ndouble</span> <span class="o">=</span> <span class="p">(</span><span class="n">nblock</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">//</span> <span class="mi">8</span>
                        <span class="n">fmt</span> <span class="o">=</span> <span class="n">mapfmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;i</span><span class="si">%d</span><span class="s1">d&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ndouble</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
                        <span class="c1">#out = Struct(self._endian + b&#39;i 3d&#39;).unpack(block)</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
                        <span class="c1">#print(out, nblock)</span>
                        <span class="n">nfields_test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1">#print(&#39;-------&#39;)</span>
                    <span class="c1">#print(f&#39;end of marker={marker}&#39;)</span>
                    <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="c1">#marker = self.get_marker1(rewind=True)</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;EXTDB error&#39;</span><span class="p">)</span>

                <span class="c1">#op2.show_ndata(100)</span>
                <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1">#print(&#39;nfields =&#39;, nfields)</span>
                <span class="k">if</span> <span class="n">nfields</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#print(&#39;breaking...&#39;)</span>
                    <span class="c1">#self.show(200)</span>
                    <span class="k">break</span>
                <span class="c1">#elif nfields == 3:</span>
                    <span class="c1">#data = self._read_record()</span>
                    <span class="c1">#self.show(200, types=&#39;ifs&#39;, endian=None)</span>
                    <span class="c1">#aaa</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">int1</span><span class="p">,</span> <span class="n">int2</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;4s 2i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="c1"># b&#39;\xff\xff\x00\x00&#39; 65535 25535 12 ???</span>
                    <span class="c1">#print(name, int1, int2, 12)</span>
                    <span class="c1">#self.show_data(data)</span>
                    <span class="c1">#self.show_data(data)</span>
                <span class="k">elif</span> <span class="n">ndata</span> <span class="o">&gt;</span> <span class="mi">99</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;EXTDB; ndata=</span><span class="si">{</span><span class="n">ndata</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">mapfmt_str</span><span class="p">(</span><span class="s1">&#39;if&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
                <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="c1">#print(&#39;--------------------&#39;)</span>
            <span class="n">unused_marker_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="OP2Reader.read_descyc"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_descyc">[docs]</a>    <span class="k">def</span> <span class="nf">read_descyc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the DESCYC table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="c1">#op2.log.debug(&quot;table_name = %r&quot; % op2.table_name)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">mapfmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;DESCYC  &#39;</span><span class="p">,</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">design_cycle</span><span class="p">,</span> <span class="n">design_cycle_type_bytes</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;i8s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">design_cycle</span><span class="p">,</span> <span class="n">design_cycle_type_bytes</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;q16s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">design_cycle_type_bytes</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">design_cycle_type_bytes</span><span class="p">)</span>

        <span class="c1">#Design cycle type; &#39;D&#39; for discretized design cycle</span>
        <span class="c1">#Blank for continuous design cycle</span>
        <span class="k">if</span> <span class="n">design_cycle_type_bytes</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;        &#39;</span><span class="p">:</span>
            <span class="n">design_cycle_type_str</span> <span class="o">=</span> <span class="s1">&#39;continuous&#39;</span>
        <span class="k">elif</span> <span class="n">design_cycle_type_bytes</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;D       &#39;</span><span class="p">:</span>
            <span class="n">design_cycle_type_str</span> <span class="o">=</span> <span class="s1">&#39;discrete&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">design_cycle_type_bytes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>
        <span class="c1">#print(&#39;descyc&#39;)</span>
        <span class="c1">#print(&#39;  ints =&#39;, ints)</span>
        <span class="c1">#print(&#39;  name =&#39;, name)</span>
        <span class="c1">#print(f&#39;  design_cycle={design_cycle} type={design_cycle_type_str!r} count={op2._count}&#39;)</span>

<div class="viewcode-block" id="OP2Reader.read_dbcopt"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_dbcopt">[docs]</a>    <span class="k">def</span> <span class="nf">read_dbcopt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the DBCOPT table, which is a design variable history table&quot;&quot;&quot;</span>
        <span class="c1">#C:\MSC.Software\simcenter_nastran_2019.2\tpl_post1\cc577.op2</span>
        <span class="c1"># ints    = (101, 11, 10, 3, 4, 0, 0)</span>
        <span class="c1"># objective_function = [1175749.5, 711181.875, 369194.03125, 112453.1406, 229.4625, 50.9286, 50.8863, 50.8316, 50.7017, 49.7571, 49.3475]</span>
        <span class="c1"># approx = [0.0, 651307.3125, 388093.0625, 150222.453125, 5894.2626, 50.9092, 50.8834, 50.8252, 49.4544, 49.6455, 49.2533]</span>
        <span class="c1"># max_value_of_constraint = [nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]</span>
        <span class="c1"># desvar_ids = [1, 2, 3]</span>
        <span class="c1"># cycle_1_values = [1.0, 1.0, 1.0]</span>
        <span class="c1"># cycle_n_values = [1.4, 0.6, 1.4,</span>
        <span class="c1">#                   1.96, 0.36, 1.96,</span>
        <span class="c1">#                   2.744, 0.216, 2.744,</span>
        <span class="c1">#                   3.8416, 0.1296, 3.8416, ...]</span>

        <span class="c1"># 1 NFEA I Number of finite element analyses</span>
        <span class="c1"># 2 NAOP I Number of optimization cycles w.r.t. approximate model</span>
        <span class="c1"># 3 NDV I Number of design variables</span>
        <span class="c1"># 4 NCC I Convergence criterion</span>
        <span class="c1"># 5 UNDEF(2 ) None</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">mapfmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">nopt</span><span class="p">,</span> <span class="n">napprox</span><span class="p">,</span> <span class="n">nvars</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zeroa</span><span class="p">,</span> <span class="n">zerob</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">101</span><span class="p">,</span> <span class="n">num</span>
        <span class="k">assert</span> <span class="n">zeroa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zeroa</span>
        <span class="k">assert</span> <span class="n">zerob</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zerob</span>

        <span class="c1"># (101, 11, 10, 3, 4, 0, 0)</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;DBCOPT  &#39;</span><span class="p">,</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#ndata = len(data) // 4</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">fdtype</span> <span class="o">=</span> <span class="s1">&#39;float32&#39;</span>
            <span class="n">idtype</span> <span class="o">=</span> <span class="s1">&#39;int32&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fdtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span>
            <span class="n">idtype</span> <span class="o">=</span> <span class="s1">&#39;int64&#39;</span>
        <span class="n">objective_function</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">fdtype</span><span class="p">)</span> <span class="c1"># .tolist()</span>
        <span class="c1">#print(f&#39;  objective_function = {objective_function}; n={len(objective_function)}&#39;)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">objective_function</span><span class="p">)</span> <span class="o">==</span> <span class="n">nopt</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;len(objective_function)=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">objective_function</span><span class="p">)</span><span class="si">}</span><span class="s1"> nopt=</span><span class="si">{</span><span class="n">nopt</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">approx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">fdtype</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="c1"># .tolist()</span>
        <span class="n">napprox_actual</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">approx</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">approx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">approx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">napprox_actual</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="c1">#print(approx.tolist())</span>
        <span class="c1">#assert napprox_actual == napprox, f&#39;napprox_actual={napprox_actual} napprox={napprox}&#39;</span>
        <span class="c1">#print(f&#39;  approx = {approx}; n={len(approx)}&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">max_value_of_constraint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">fdtype</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1">#print(f&#39;  max_value_of_constraint = {max_va/lue_of_constraint}; n={len(max_value_of_constraint)}&#39;)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">desvar_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">idtype</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">desvar_ids</span><span class="p">)</span> <span class="o">==</span> <span class="n">nvars</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;len(desvars)=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">desvars</span><span class="p">)</span><span class="si">}</span><span class="s1"> nvars=</span><span class="si">{</span><span class="n">nvars</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">cycle_1_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">fdtype</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">marker0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">marker0</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">cycle_n_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">fdtype</span><span class="p">)</span>
        <span class="n">cycle_n_values2</span> <span class="o">=</span> <span class="n">cycle_n_values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cycle_n_values</span><span class="p">)</span> <span class="o">//</span> <span class="n">nvars</span><span class="p">,</span> <span class="n">nvars</span><span class="p">)</span>
        <span class="n">cycle_n_values3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">cycle_1_values</span><span class="p">,</span> <span class="n">cycle_n_values2</span><span class="p">])</span>

        <span class="n">approx_obj_constraint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">approx</span><span class="p">,</span> <span class="n">objective_function</span><span class="p">,</span> <span class="n">max_value_of_constraint</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="c1">#print(f&#39;  desvar_ids = {desvar_ids}&#39;)</span>
        <span class="c1">#print(f&#39;  approx_obj_constraint; {approx_obj_constraint.shape}:\n{approx_obj_constraint}&#39;)</span>
        <span class="c1">#print(f&#39;  cycle_n_values {cycle_n_values3.shape}:\n{cycle_n_values3}&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>
        <span class="c1">#data = self._read_record()</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="c1">#self.show_ndata(100)</span>

<div class="viewcode-block" id="OP2Reader.read_dscmcol"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_dscmcol">[docs]</a>    <span class="k">def</span> <span class="nf">read_dscmcol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the DSCMCOL table, which defines the columns? for the DSCM2 table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;table_name = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#fmt = mapfmt(self._endian + b&#39;7i&#39;, self.size)</span>
        <span class="c1">#num, ndesvars, one_zero, zeroa, zerob, zeroc, zerod = Struct(fmt).unpack(data)</span>
        <span class="c1">#print(num, ndesvars, one_zero, zeroa, zerob, zeroc, zerod)</span>
        <span class="c1"># (101, 3, 1, 0, 0, 0, 0)</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;DSCMCOL &#39;</span><span class="p">,</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="n">responses</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span>
            <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">fdtype8</span><span class="p">)</span>
            <span class="n">nresponses_dresp1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span> <span class="o">//</span> <span class="mi">9</span>
            <span class="n">dscmcol_dresp1</span><span class="p">(</span><span class="n">responses</span><span class="p">,</span> <span class="n">nresponses_dresp1</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span><span class="p">)</span>

        <span class="c1">#self.show_data(data[4*idata:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nfields</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_dscmcol_response</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># read the DRESP2 columns</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span>
            <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">fdtype8</span><span class="p">)</span>
            <span class="n">nresponses_dresp2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span> <span class="o">//</span> <span class="mi">6</span>
            <span class="n">dscmcol_dresp2</span><span class="p">(</span><span class="n">responses</span><span class="p">,</span> <span class="n">nresponses_dresp2</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_save_dscmcol_response</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">_save_dscmcol_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">responses</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;saves the DSCMCOL dictionary&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">responses</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">dscmcol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;overwriting DSCMCOL&#39;</span><span class="p">)</span>
            <span class="n">respi</span> <span class="o">=</span> <span class="n">DSCMCOL</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">respi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">dscmcol</span> <span class="o">=</span> <span class="n">respi</span>

<div class="viewcode-block" id="OP2Reader.read_fol"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_fol">[docs]</a>    <span class="k">def</span> <span class="nf">read_fol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the FOL table</span>
<span class="sd">        Frequency response frequency output list</span>

<span class="sd">        tested by TestOP2.test_monpnt3</span>

<span class="sd">        +------+---------+-------+-----------------+</span>
<span class="sd">        | Word |  Name   | Type  |   Description   |</span>
<span class="sd">        +======+=========+=======+=================+</span>
<span class="sd">        |  1   | NAME(2) | CHAR4 | Data block name |</span>
<span class="sd">        +------+---------+-------+-----------------+</span>
<span class="sd">        |  3   |  FREQ   |  RS   |   Frequency     |</span>
<span class="sd">        +------+---------+-------+-----------------+</span>
<span class="sd">        | Word 3 repeats until End of Record       |</span>
<span class="sd">        +------------------------------------------+</span>

<span class="sd">        +------+----------+------+-----------------------------+</span>
<span class="sd">        | Word |  Name    | Type |   Description               |</span>
<span class="sd">        +======+==========+======+=============================+</span>
<span class="sd">        |  1   |  WORD1   |  I   | Number of frequencies       |</span>
<span class="sd">        +------+----------+------+-----------------------------+</span>
<span class="sd">        |  2   |  WORD2   |  I   | Frequency set record number |</span>
<span class="sd">        +------+----------+------+-----------------------------+</span>
<span class="sd">        |  3   |  WORD3   |  I   | Number of loads             |</span>
<span class="sd">        +------+----------+------+-----------------------------+</span>
<span class="sd">        |  4   | UNDEF(3) | None | Not used                    |</span>
<span class="sd">        +------+----------+------+-----------------------------+</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;table_name = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">subtable_name_raw</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name_raw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">subtable_name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;FOL&#39;</span><span class="p">,</span> <span class="s1">&#39;subtable_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span>

        <span class="n">nfloats</span> <span class="o">=</span> <span class="p">(</span><span class="n">ndata</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span>
        <span class="k">assert</span> <span class="n">nfloats</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">==</span> <span class="p">(</span><span class="n">ndata</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1">f&#39;</span> <span class="o">%</span> <span class="n">nfloats</span>
        <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:])),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s1">&#39;Cannot overwrite op2._frequencies...</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;op2._frequencies = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;new_freqs = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span><span class="p">,</span> <span class="n">freqs</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span> <span class="o">=</span> <span class="n">freqs</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">, freqs]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">subtable_name_raw</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  freqs = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">freqs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_subtables</span><span class="p">()</span></div>

<div class="viewcode-block" id="OP2Reader.read_frl"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_frl">[docs]</a>    <span class="k">def</span> <span class="nf">read_frl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads the FRL (Frequency Response List) table</span>

<span class="sd">        tested by TestOP2.test_op2_good_sine_01</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">fmt1</span> <span class="o">=</span> <span class="n">mapfmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">idata</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">101</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;idata[0]=</span><span class="si">{</span><span class="n">idata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">; idata=</span><span class="si">{</span><span class="n">idata</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;idata[1]=</span><span class="si">{</span><span class="n">idata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">; idata=</span><span class="si">{</span><span class="n">idata</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;idata[2]=</span><span class="si">{</span><span class="n">idata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">; idata=</span><span class="si">{</span><span class="n">idata</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;idata[3]=</span><span class="si">{</span><span class="n">idata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">; idata=</span><span class="si">{</span><span class="n">idata</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;idata[4]=</span><span class="si">{</span><span class="n">idata</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s1">; idata=</span><span class="si">{</span><span class="n">idata</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;idata[5]=</span><span class="si">{</span><span class="n">idata</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s1">; idata=</span><span class="si">{</span><span class="n">idata</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">assert</span> <span class="n">idata</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;idata[6]=</span><span class="si">{</span><span class="n">idata</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="si">}</span><span class="s1">; idata=</span><span class="si">{</span><span class="n">idata</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="c1">#print(self.show_data(data))</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">subtable_name_raw</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name_raw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">subtable_name</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;FRL&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;FRL0&#39;</span><span class="p">],</span> <span class="s1">&#39;subtable_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
            <span class="c1">#(FRL, 200, 201)</span>
            <span class="n">subtable_name_raw</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name_raw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">subtable_name</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;FRL&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;FRL0&#39;</span><span class="p">],</span> <span class="s1">&#39;subtable_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
            <span class="c1">#(FRL, 70, 71, 72)</span>
            <span class="n">subtable_name_raw</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name_raw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">subtable_name</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;FRL&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;FRL0&#39;</span><span class="p">],</span> <span class="s1">&#39;subtable_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
            <span class="c1">#(FRL, 71, 72, 73, 74)</span>
            <span class="n">subtable_name_raw</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name_raw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">subtable_name</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;FRL&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;FRL0&#39;</span><span class="p">],</span> <span class="s1">&#39;subtable_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifsd&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;bad length...&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">isubtable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
                <span class="c1">#self.show_data(data)</span>
                <span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">fdtype</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1">#print(&#39;read_mode=%s itable=%s freqs=%s&#39; % (self.read_mode, isubtable, freqs.tolist()))</span>
                <span class="k">if</span> <span class="n">isubtable</span> <span class="o">==</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span><span class="p">):</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s1">&#39;Cannot overwrite op2._frequencies...</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;op2._frequencies = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;new_freqs = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span><span class="p">,</span> <span class="n">freqs</span><span class="p">))</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                    <span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span> <span class="o">=</span> <span class="n">freqs</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#C:\MSC.Software\simcenter_nastran_2019.2\tpl_post2\rtr_mfreq41kf.op2</span>
                    <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span><span class="p">):</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="s1">&#39;Cannot overwrite op2._frequencies...</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;op2._frequencies = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                            <span class="s1">&#39;new_freqs = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">_frequencies</span><span class="p">,</span> <span class="n">freqs</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">isubtable</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">isubtable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">isubtable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="OP2Reader.read_gpl"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_gpl">[docs]</a>    <span class="k">def</span> <span class="nf">read_gpl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads the GPL table (grid point list?)</span>

<span class="sd">        tested by TestOP2.test_beam_modes</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">read_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">read_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span>

        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#self.log.debug(&#39;table_name = %r&#39; % op2.table_name)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">header_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>  <span class="c1"># (102, 117, 0, 0, 0, 0, 0)</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">header_data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span>

        <span class="c1">#seid = ints[0] # ???</span>
        <span class="n">nnodes</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">#self.show_data(unused_data)</span>
        <span class="c1">#print(&#39;--------------------&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_table_name</span><span class="p">([</span><span class="s1">&#39;GPL&#39;</span><span class="p">,</span> <span class="s1">&#39;GPLOUT&#39;</span><span class="p">])</span>
        <span class="c1">#else ndata == 12:  # TestOP2Matrix.test_gpspc</span>
        <span class="c1">#print(&#39;--------------------&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="n">read_record</span><span class="p">()</span> <span class="c1"># nids 1-117</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1"># nids 1-117 (column 1) with nid*1000 (column 2)</span>
            <span class="c1">#</span>
            <span class="c1"># External grid or scalar identification number = node_id</span>
            <span class="c1"># Sequence number = 1000 * external identification number</span>
            <span class="n">unused_nid_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nnodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="OP2Reader.read_gpls"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_gpls">[docs]</a>    <span class="k">def</span> <span class="nf">read_gpls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;table_name = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>  <span class="c1"># (101, 139, 0, 0, 0, 0, 0)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">gpl_gpls</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8si&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gpl_gpls</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16sq&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">gpl_gpls</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;GPL&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;GPLS&#39;</span><span class="p">],</span> <span class="n">gpl_gpls</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span>
                          <span class="mi">101</span><span class="p">,</span> <span class="mi">201</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;GPLS method=</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span>
        <span class="c1">#print(ints)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span>
        <span class="n">nints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="n">ints</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nints</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1">#print(ints)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>
        <span class="c1">#data = self._read_record()</span>
        <span class="c1">#self.show_data(data, types=&#39;ifs&#39;, endian=None)</span>

<div class="viewcode-block" id="OP2Reader.read_table_name"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_table_name">[docs]</a>    <span class="k">def</span> <span class="nf">read_table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_table_name4</span><span class="p">(</span><span class="n">table_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_table_name8</span><span class="p">(</span><span class="n">table_names</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.read_table_name4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_table_name4">[docs]</a>    <span class="k">def</span> <span class="nf">read_table_name4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">table_names</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata4</span><span class="p">()</span> <span class="c1"># GPL</span>
        <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">table_name_bytes</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">table_name_bytes</span><span class="p">,</span> <span class="n">zero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_8s_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">SubTableReadError</span><span class="p">(</span><span class="s1">&#39;cannot read table_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">table_names</span><span class="p">)</span>

        <span class="n">table_name_str</span> <span class="o">=</span> <span class="n">table_name_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">table_name_str</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;actual=</span><span class="si">{</span><span class="n">table_name_str</span><span class="si">}</span><span class="s1"> allowed=</span><span class="si">{</span><span class="n">table_names</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">table_name_str</span></div>

<div class="viewcode-block" id="OP2Reader.read_table_name8"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_table_name8">[docs]</a>    <span class="k">def</span> <span class="nf">read_table_name8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="n">table_names</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata8</span><span class="p">()</span> <span class="c1"># GPL</span>
        <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">table_name_bytes</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_16s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
            <span class="n">table_name_bytes</span><span class="p">,</span> <span class="n">zero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_16s_q</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifsq&#39;</span><span class="p">)</span>
            <span class="c1">#self.show_data(data[16:], types=&#39;ifsq&#39;)</span>
            <span class="k">raise</span> <span class="n">SubTableReadError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cannot read table_name=</span><span class="si">{</span><span class="n">table_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">table_name_bytes</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">table_name_bytes</span><span class="p">)</span>
        <span class="n">table_name_str</span> <span class="o">=</span> <span class="n">table_name_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">table_name_str</span> <span class="ow">in</span> <span class="n">table_names</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;actual=</span><span class="si">{</span><span class="n">table_name_str</span><span class="si">}</span><span class="s1"> allowed=</span><span class="si">{</span><span class="n">table_names</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">table_name_str</span></div>

<div class="viewcode-block" id="OP2Reader.read_gpdt"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_gpdt">[docs]</a>    <span class="k">def</span> <span class="nf">read_gpdt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads the GPDT table</span>

<span class="sd">        tested by ???</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#if self.read_mode == 1:</span>
            <span class="c1">#read_record = self._skip_record</span>
        <span class="c1">#else:</span>
        <span class="n">read_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span>
        <span class="n">skip_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span>

        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="c1">#self.log.debug(&#39;table_name = %r&#39; % table_name)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_gpdt - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">table_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">header_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>  <span class="c1"># (103, 117, 0, 0, 0, 0, 0)</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">header_data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span>

        <span class="c1">#seid = ints[0] # ??? is this a table number&gt;</span>
        <span class="n">unused_nnodes</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">#print(&#39;--------------------&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_table_name</span><span class="p">([</span><span class="s1">&#39;GPDT&#39;</span><span class="p">,</span> <span class="s1">&#39;GPDTS&#39;</span><span class="p">])</span>

        <span class="c1">#print(&#39;--------------------&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>


        <span class="c1">## TODO: no idea how this works...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">read_record</span><span class="p">()</span> <span class="c1"># nid,cp,x,y,z,cd,ps</span>
            <span class="n">xword</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
            <span class="n">nvalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="n">xword</span>
            <span class="k">if</span> <span class="n">nvalues</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># mixed ints, floats</span>
                <span class="c1">#  0   1   2   3   4   5   6</span>
                <span class="c1"># id, cp, x1, x2, x3, cd, ps</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="n">get_table_size_from_ncolumns</span><span class="p">(</span><span class="s1">&#39;GPDT&#39;</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
                <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">fdtype8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">iints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span> <span class="c1"># [1, 2, 6, 7] - 1</span>
                <span class="n">nid_cp_cd_ps</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[:,</span> <span class="n">iints</span><span class="p">]</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">nvalues</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># mixed ints, doubles</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="n">get_table_size_from_ncolumns</span><span class="p">(</span><span class="s1">&#39;GPDT&#39;</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                <span class="n">iints</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
                <span class="c1">#ifloats = [2, 3, 4, 5, 6, 7]</span>
                <span class="n">idoubles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
                <span class="n">unused_izero</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>

                <span class="c1">#print(&#39;ints:&#39;)</span>
                <span class="c1">#print(ints)</span>
                <span class="c1"># nid cp, x,    y,    z,    cd, ps</span>
                <span class="c1"># [0, 1,  2, 3, 4, 5, 6, 7, 8,   9]</span>
                <span class="c1"># [ ,  ,  1, 1, 2, 2, 3, 3,  ,    ]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="c1">#floats = np.frombuffer(data, op2.fdtype).reshape(nrows, 10).copy()</span>
                    <span class="n">doubles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;float64&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                    <span class="n">nid_cp_cd_ps</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[:,</span> <span class="n">iints</span><span class="p">]</span>
                    <span class="n">xyz</span> <span class="o">=</span> <span class="n">doubles</span><span class="p">[:,</span> <span class="n">idoubles</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">nvalues</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">gpdt</span> <span class="o">=</span> <span class="n">GPDT</span><span class="p">(</span><span class="n">nid_cp_cd_ps</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unused_data</span> <span class="o">=</span> <span class="n">skip_record</span><span class="p">()</span> <span class="c1"># nid,cp,x,y,z,cd,ps</span>


        <span class="c1"># 1. Scalar points are identified by CP=-1 and words X1 through</span>
        <span class="c1">#    PS are zero.</span>
        <span class="c1"># 3. or fluid grid points, CD=-1.</span>
        <span class="c1">#print(nid_cp_cd_ps)</span>
        <span class="c1">#print(xyz)</span>


        <span class="n">isubtable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">isubtable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;unexpected GPDT marker marker=</span><span class="si">%s</span><span class="s1">; expected=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">isubtable</span><span class="p">))</span>
            <span class="c1">#markers = self.get_nmarkers(1, rewind=False)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">isubtable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#markers = self.get_nmarkers(1, rewind=True)</span>
            <span class="c1">#self.log.debug(&#39;GPDT record; markers=%s&#39; % str(markers))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#self.log.debug(&#39;unexpected GPDT record; markers=%s&#39; % str(markers))</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
                <span class="c1">#print(&#39;read_mode=%s freqs=%s&#39; % (self.read_mode, freqs.tolist()))</span>

            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">isubtable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">isubtable</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">del</span> <span class="n">isubtable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="OP2Reader.read_bgpdt"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_bgpdt">[docs]</a>    <span class="k">def</span> <span class="nf">read_bgpdt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads the BGPDT, BGPDTS, BGPDTOLD tables</span>

<span class="sd">        tested by TestOP2Matrix.test_gpspc</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#if self.read_mode == 1:</span>
            <span class="c1">#read_record = self._skip_record</span>
        <span class="c1">#else:</span>
        <span class="n">read_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span>

        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;table_name = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_bgpdt - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">table_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">header_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>  <span class="c1"># (105, 51, 0, 0, 0, 0, 0)</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">header_data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span>

        <span class="c1">#seid = ints[0] # ??? is this a table number&gt;</span>
        <span class="n">unused_nnodes</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># validated</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1">#print(&#39;--------------------&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_table_name</span><span class="p">([</span><span class="s1">&#39;BGPDT&#39;</span><span class="p">,</span> <span class="s1">&#39;BGPDTS&#39;</span><span class="p">,</span> <span class="s1">&#39;BGPDTOLD&#39;</span><span class="p">,</span> <span class="s1">&#39;BGPDTOUT&#39;</span><span class="p">])</span>

        <span class="c1">#print(&#39;--------------------&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="c1">#C:\MSC.Software\simcenter_nastran_2019.2\tpl_post2\s402_sphere_03.op2</span>
        <span class="c1">#GRID 1 0 0.0    0.0 0.0      0</span>
        <span class="c1">#GRID 2 0 0.0    0.0 0.0      0</span>
        <span class="c1">#GRID 3 0 0.0871 0.0 -0.99619 0</span>
        <span class="c1">#D = (0.0, 5e-324,</span>
        <span class="c1">#     5e-324, 3e-322, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.5e-323,</span>
        <span class="c1">#     1e-323, 3e-322, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 6.4e-323,</span>
        <span class="c1">#     1.5e-323, 3e-322, 0.0, 0.0, 0.0871, 0.0, -0.99619)</span>
        <span class="c1">#L = (0, 1,</span>
        <span class="c1">#     1, 61, 0, 0, 0, 0, 0, 0, 7,</span>
        <span class="c1">#     2, 61, 0, 0, 0, 0, 0, 0, 13,</span>
        <span class="c1">#     3, 61, 0, 0, 0.0871, 0, -0.99619)</span>

        <span class="c1">#C:\MSC.Software\simcenter_nastran_2019.2\tpl_post2\s402_flxslddriver_05.op2</span>
        <span class="c1">#doubles (float64) = (0.0, 5e-324, 5e-324, 3e-322, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.5e-323, 1e-323, 3e-322, 0.0, 0.0, 10.0, 0.0, 0.0, 0.0, 6.4e-323, 1.5e-323, 3e-322, 0.0, 0.0, 20.0, 0.0, 0.0, 0.0, 9.4e-323, 2e-323, 3e-322, 0.0, 0.0, 30.0, 0.0, 0.0, 0.0, 1.24e-322, 2.5e-323, 3e-322, 0.0, 0.0, 40.0, 0.0, 0.0, 0.0, 1.53e-322, 3e-323, 3e-322, 0.0, 0.0, 50.0, 0.0, 0.0, 0.0, 1.83e-322, 3.5e-323, 3e-322, 0.0, 0.0, 60.0, 0.0, 0.0, 0.0, 2.1e-322, 4e-323, 3e-322, 0.0, 0.0, 70.0, 0.0, 0.0, 0.0, 2.4e-322, 4.4e-323, 3e-322, 0.0, 0.0, 80.0, 0.0, 0.0, 0.0, 2.7e-322, 5e-323, 3e-322, 0.0, 0.0, 90.0, 0.0, 0.0, 0.0, 3e-322, 5.4e-323, 3e-322, 0.0, 0.0, 100.0, 0.0, 0.0, 0.0, 3.3e-322, 6e-323, 3e-322, 0.0, 0.0, 5.0, 0.0, 20.0, 0.0, 3.6e-322, 6.4e-323, 3e-322, 0.0, 0.0, 5.0, 0.0, 0.0, 0.0, 3.9e-322, 7e-323, 3e-322, 0.0, 0.0, 10.0, 0.0, 0.0)</span>
        <span class="c1">#long long (int64) = (</span>
            <span class="c1">#0, 1,</span>
            <span class="c1">#1, 61, 0, 0, 0, 0, 0, 0, 7,</span>
            <span class="c1">#2, 61, 0, 0, 4621819117588971520, 0, 0, 0, 13,</span>
            <span class="c1">#3, 61, 0, 0, 4626322717216342016, 0, 0, 0, 19,</span>
            <span class="c1">#4, 61, 0, 0, 4629137466983448576, 0, 0, 0, 25,</span>
            <span class="c1">#5, 61, 0, 0, 4630826316843712512, 0, 0, 0, 31,</span>
            <span class="c1">#6, 61, 0, 0, 4632233691727265792, 0, 0, 0, 37,</span>
            <span class="c1">#7, 61, 0, 0, 4633641066610819072, 0, 0, 0, 43,</span>
            <span class="c1">#8, 61, 0, 0, 4634626229029306368, 0, 0, 0, 49,</span>
            <span class="c1">#9, 61, 0, 0, 4635329916471083008, 0, 0, 0, 55,</span>
            <span class="c1">#10, 61, 0, 0, 4636033603912859648, 0, 0, 0, 61,</span>
            <span class="c1">#11, 61, 0, 0, 4636737291354636288, 0, 0, 0, 67,</span>
            <span class="c1">#12, 61, 0, 0, 4617315517961601024, 0, 4626322717216342016, 0, 73,</span>
            <span class="c1">#13, 61, 0, 0, 4617315517961601024, 0, 0, 0, 79,</span>
            <span class="c1">#14, 61, 0, 0, 4621819117588971520, 0, 0)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">read_record</span><span class="p">()</span> <span class="c1"># cd,x,y,z</span>
            <span class="n">xword</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
            <span class="n">nvalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="n">xword</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="n">get_table_size_from_ncolumns</span><span class="p">(</span><span class="s1">&#39;BGPDT&#39;</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">fdtype8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">cd</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">xyz</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">bgpdt</span> <span class="o">=</span> <span class="n">BGPDT</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">xyz</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#bad = []</span>
                <span class="c1">#nvalues = len(data) // 4</span>
                <span class="c1">#for i in [2, 3, 6]: # 2-16 checked</span>
                    <span class="c1">#if nvalues % i != 0:</span>
                        <span class="c1">#bad.append(i)</span>
                <span class="c1">#if bad:</span>
                    <span class="c1">#print(nvalues, bad)</span>
                    <span class="c1">#asdf</span>
                <span class="c1">#self.show_data(data, types=&#39;ifqd&#39;)</span>
                <span class="n">nrows</span> <span class="o">=</span> <span class="p">(</span><span class="n">nvalues</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">//</span> <span class="mi">7</span>
                <span class="c1">#print(nrows)</span>
                <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype8</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">fdtype8</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1">#print(ints)</span>
                <span class="c1">#print(floats)</span>
                <span class="c1">#print(nrows*7, len(floats))</span>
                <span class="c1">#ints = ints[2:].reshape(nrows, 7)</span>
                <span class="c1">#floats = floats[2:].reshape(nrows, 7)</span>
                <span class="c1">#for inti, floati in zip(ints, floats):</span>
                    <span class="c1">#print(inti[:-3], floats[-3:])</span>
            <span class="c1">#print(&#39;cd = %s&#39; % cd.tolist())</span>
            <span class="c1">#print(&#39;xyz:\n%s&#39; % xyz)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">marker</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span>

        <span class="c1">## TODO: why is this needed??? (it is, but dmap is not clear)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data, types=&#39;i&#39;)</span>
        <span class="n">isubtable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">isubtable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">marker</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
            <span class="n">isubtable</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="OP2Reader.read_hisadd"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_hisadd">[docs]</a>    <span class="k">def</span> <span class="nf">read_hisadd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;optimization history (SOL200) table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>

        <span class="n">result_name</span> <span class="o">=</span> <span class="s1">&#39;responses.convergence_data&#39;</span>
        <span class="n">is_saved_result</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">is_saved</span><span class="p">(</span><span class="n">result_name</span><span class="p">)</span>
        <span class="c1">#read_mode = self.read_mode</span>
        <span class="k">if</span> <span class="n">is_saved_result</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">_found_result</span><span class="p">(</span><span class="n">result_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skip_table</span><span class="p">(</span><span class="s1">&#39;HISADD&#39;</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">is_not_saved_result</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">is_saved_result</span>

        <span class="c1">#slot = op2.get_result(result_name)</span>

        <span class="n">responses</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">responses</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">is_not_saved_result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">is_saved_result</span> <span class="ow">and</span> <span class="n">responses</span><span class="o">.</span><span class="n">convergence_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
                <span class="n">ndvs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">7</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">convergence_data</span> <span class="o">=</span> <span class="n">Convergence</span><span class="p">(</span><span class="n">ndvs</span><span class="p">)</span>
            <span class="c1">#elif is_not_saved_result:</span>
                <span class="c1">#self._skip_record()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">convergence_data</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;_read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="c1">#self.log.info(&#39;----marker1----&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>  <span class="c1"># ()102, 303, 0, 0, 0, 0, 0) date???</span>
        <span class="c1">#print(&#39;hisadd data1&#39;)</span>
        <span class="c1">#self.show_data(data)</span>

        <span class="c1">#self.log.info(&#39;----marker2----&#39;)</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---marker0 = </span><span class="si">%s</span><span class="s1">---</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>  <span class="c1"># (&#39;HISADD&#39;, )</span>
        <span class="c1">#print(&#39;hisadd data2&#39;)</span>
        <span class="c1">#self.show_data(data)</span>

        <span class="c1">#self.log.info(&#39;----marker3----&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="n">mapfmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;3i3fi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="p">(</span><span class="n">design_iter</span><span class="p">,</span> <span class="n">iconvergence</span><span class="p">,</span> <span class="n">conv_result</span><span class="p">,</span> <span class="n">obj_intial</span><span class="p">,</span> <span class="n">obj_final</span><span class="p">,</span>
         <span class="n">constraint_max</span><span class="p">,</span> <span class="n">row_constraint_max</span><span class="p">)</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">28</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">iconvergence</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">iconvergence</span> <span class="o">=</span> <span class="s1">&#39;soft&#39;</span>
        <span class="k">elif</span> <span class="n">iconvergence</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">iconvergence</span> <span class="o">=</span> <span class="s1">&#39;hard&#39;</span>
        <span class="k">elif</span> <span class="n">iconvergence</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;HISADD iconverge=6&#39;</span><span class="p">)</span>
            <span class="n">iconvergence</span> <span class="o">=</span> <span class="s1">&#39;???&#39;</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;iconvergence=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">iconvergence</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifs&#39;</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">conv_result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">conv_result</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
        <span class="k">elif</span> <span class="n">conv_result</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">conv_result</span> <span class="o">=</span> <span class="s1">&#39;soft&#39;</span>
        <span class="k">elif</span> <span class="n">conv_result</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">conv_result</span> <span class="o">=</span> <span class="s1">&#39;hard&#39;</span>
        <span class="k">elif</span> <span class="n">conv_result</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
            <span class="c1">#self.log.warning(&#39;HISADD conv_result=%s&#39; % conv_result)</span>
            <span class="c1"># not sure why this happens, but the field is wrong</span>
            <span class="c1"># it seems to apply to one step before this one</span>
            <span class="n">conv_result</span> <span class="o">=</span> <span class="s1">&#39;best_design&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;design_iter=</span><span class="si">%s</span><span class="s1"> iconvergence=</span><span class="si">%s</span><span class="s1"> conv_result=</span><span class="si">%s</span><span class="s1"> obj_intial=</span><span class="si">%s</span><span class="s1"> &#39;</span>
                           <span class="s1">&#39;obj_final=</span><span class="si">%s</span><span class="s1"> constraint_max=</span><span class="si">%s</span><span class="s1"> row_constraint_max=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                               <span class="n">design_iter</span><span class="p">,</span> <span class="n">iconvergence</span><span class="p">,</span> <span class="n">conv_result</span><span class="p">,</span> <span class="n">obj_intial</span><span class="p">,</span>
                               <span class="n">obj_final</span><span class="p">,</span> <span class="n">constraint_max</span><span class="p">,</span> <span class="n">row_constraint_max</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;conv_result=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">conv_result</span><span class="p">)</span>
        <span class="c1">#self.log.debug(&#39;design_iter=%s iconvergence=%s conv_result=%s obj_intial=%s &#39;</span>
                       <span class="c1">#&#39;obj_final=%s constraint_max=%s row_constraint_max=%s&#39; % (</span>
                           <span class="c1">#design_iter, iconvergence, conv_result, obj_intial,</span>
                           <span class="c1">#obj_final, constraint_max, row_constraint_max))</span>

        <span class="n">ndvs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">7</span>
        <span class="n">desvar_values</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">f&#39;</span> <span class="o">%</span> <span class="n">ndvs</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">28</span><span class="p">:])</span>

        <span class="n">responses</span><span class="o">.</span><span class="n">convergence_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">design_iter</span><span class="p">,</span> <span class="n">iconvergence</span><span class="p">,</span> <span class="n">conv_result</span><span class="p">,</span> <span class="n">obj_intial</span><span class="p">,</span>
            <span class="n">obj_final</span><span class="p">,</span> <span class="n">constraint_max</span><span class="p">,</span> <span class="n">row_constraint_max</span><span class="p">,</span> <span class="n">desvar_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="OP2Reader.read_ibulk"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_ibulk">[docs]</a>    <span class="k">def</span> <span class="nf">read_ibulk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        tested by TestOP2.test_ibulk</span>

<span class="sd">        read_mode = 1 (array sizing)</span>
<span class="sd">        read_mode = 1 (reading)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#op2.log.debug(&#39;table_name = %r&#39; % op2.table_name)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#print(self.show_data(data))</span>

        <span class="n">unused_markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dump_deck</span><span class="p">:</span>
            <span class="n">write_deck</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">bulk_filename</span> <span class="o">=</span> <span class="s1">&#39;bulk.test_op2.bdf&#39;</span>
            <span class="n">save_lines</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_deck_section</span><span class="p">(</span><span class="n">bulk_filename</span><span class="p">,</span> <span class="n">save_lines</span><span class="p">,</span>
                                    <span class="n">write_deck</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                    <span class="n">read_mode</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">save_lines</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">write_deck</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">bulk_filename</span> <span class="o">=</span> <span class="s1">&#39;bulk.test_op2.bdf&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_deck_section</span><span class="p">(</span><span class="n">bulk_filename</span><span class="p">,</span> <span class="n">save_lines</span><span class="p">,</span>
                                    <span class="n">write_deck</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
                                    <span class="n">read_mode</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_read_deck_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deck_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">save_lines</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                           <span class="n">write_deck</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">read_mode</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;helper for ``read_ibulk`` and ``read_icase``&quot;&quot;&quot;</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">save_lines</span> <span class="ow">and</span> <span class="n">write_deck</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;save_lines=</span><span class="si">{</span><span class="n">save_lines</span><span class="si">}</span><span class="s1"> write_deck=</span><span class="si">{</span><span class="n">write_deck</span><span class="si">}</span><span class="s1">; &#39;</span>
                               <span class="s1">&#39;one or more must be False&#39;</span><span class="p">)</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
        <span class="k">if</span> <span class="n">write_deck</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="n">read_mode</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">deck_filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span> <span class="k">as</span> <span class="n">bdf_file</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">marker</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">nfields</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># we&#39;re not reading the record because the IBULK/ICASE</span>
                        <span class="c1"># table is literally just an unsorted echo of the</span>
                        <span class="c1"># BULK/CASE data table in the BDF</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">reshape_bytes_block_size</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
                        <span class="n">bdf_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">nfields</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1">#op2.show_ndata(100, types=&#39;ifs&#39;)</span>
                        <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;nfields=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nfields</span><span class="p">)</span>
                    <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="n">save_lines</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="n">read_mode</span><span class="p">:</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">marker</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nfields</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># we&#39;re not reading the record because the IBULK</span>
                    <span class="c1"># table is literally just an unsorted echo of the</span>
                    <span class="c1"># BULK data table in the BDF</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">reshape_bytes_block_size</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">nfields</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#op2.show_ndata(100, types=&#39;ifs&#39;)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;nfields=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nfields</span><span class="p">)</span>
                <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">marker</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nfields</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># we&#39;re not reading the record because the IBULK</span>
                    <span class="c1"># table is literally just an unsorted echo of the</span>
                    <span class="c1"># BULK data table in the BDF</span>
                    <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">nfields</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#op2.show_ndata(100, types=&#39;ifs&#39;)</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;nfields=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">nfields</span><span class="p">)</span>
                <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="c1">#print(&quot;marker = &quot;, marker)</span>
        <span class="n">unused_marker_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines</span>

<div class="viewcode-block" id="OP2Reader.read_icase"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_icase">[docs]</a>    <span class="k">def</span> <span class="nf">read_icase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        tested by ???</span>

<span class="sd">        read_mode = 1 (array sizing)</span>
<span class="sd">        read_mode = 1 (reading)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="n">unused_markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">save_lines</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">write_deck</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">bulk_filename</span> <span class="o">=</span> <span class="s1">&#39;bulk.test_op2.bdf&#39;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_deck_section</span><span class="p">(</span><span class="n">bulk_filename</span><span class="p">,</span> <span class="n">save_lines</span><span class="p">,</span>
                                        <span class="n">write_deck</span><span class="o">=</span><span class="n">write_deck</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                                        <span class="n">read_mode</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dump_deck</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bulk_filename</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bdf_file</span><span class="p">:</span>
                <span class="n">bdf_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_case_control_lines</span> <span class="o">=</span> <span class="n">lines</span></div>

<div class="viewcode-block" id="OP2Reader.read_cddata"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_cddata">[docs]</a>    <span class="k">def</span> <span class="nf">read_cddata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cambell diagram summary&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#(101, 15, 5, 7, 0, 2, 0)</span>
        <span class="c1">#(101, 118, 4, 7, 0, 2, 0)</span>

        <span class="c1"># CDDATA, 2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">cddata</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8si&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">marker</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="n">cddata_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1">#print(f&#39;read marker={marker}...&#39;)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">marker</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nfields</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="c1">#print(nfields)</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata4</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">continue</span>
                <span class="c1">#self.show_data(data, types=&#39;if&#39;, endian=None)</span>
                <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="c1">#self.show(200)</span>

        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">marker</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nfields</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="k">continue</span>

                <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span>
                <span class="n">nints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>
                <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">fdtype</span><span class="p">)</span> <span class="c1"># .reshape(nints//7, 7)</span>

                <span class="c1"># 1 NVAL I Number of values</span>
                <span class="c1"># 2 NCRV I Number of sections/solution (i.e., number of curves)</span>
                <span class="c1"># 3 KEYW I Keyword=10000+(SOLN*10)+DATTYP,</span>
                <span class="c1"># where:</span>
                <span class="c1">#   SOLN=solution number</span>
                <span class="c1">#   DATTYP=1 for list of rotor speeds in user-defined units</span>
                <span class="c1">#   DATTYP=2 for list of eigenfrequencies in the analysis system</span>
                <span class="c1">#   DATTYP=3 for list of Lehr damping values</span>
                <span class="c1">#   DATTYP=4 for list of real part of eigenvalues</span>
                <span class="c1">#   DATTYP=5 for list of imaginary part of eigenvalues</span>
                <span class="c1">#   DATTYP=6 for list of whirl direction codes (2.0=backwards, 3.0=forward, 4.0=linear)</span>
                <span class="c1">#   DATTYP=7 for list of converted frequencies in analysis system</span>
                <span class="c1">#   DATTYP=8 for list of whirl directions codes for converted solution (2.0=backwards, 3.0=forward, 4.0=linear)</span>
                <span class="c1"># 4 VALS(NVAL) RS List of values</span>
                <span class="c1"># Words 14 repeat for NCRV curves. For DATTYP1, NVAL and NCRV=0</span>

                <span class="n">dict_map</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;RPM&#39;</span><span class="p">,</span>
                    <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;eigenfreq&#39;</span><span class="p">,</span>
                    <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;Lehr&#39;</span><span class="p">,</span>
                    <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;real eig&#39;</span><span class="p">,</span>
                    <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;imag eig&#39;</span><span class="p">,</span>
                    <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;whirl_dir&#39;</span><span class="p">,</span>
                    <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;converted_freq&#39;</span><span class="p">,</span>
                    <span class="mi">8</span><span class="p">:</span> <span class="s1">&#39;whirl_code&#39;</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">data_out</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nints</span><span class="p">:</span>
                    <span class="n">nvalues</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="c1">#ncurves = ints[i+1]</span>
                    <span class="n">keyword</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># 10000+(SOLN*10)+DATTYP</span>
                    <span class="n">base</span> <span class="o">=</span> <span class="n">keyword</span> <span class="o">-</span> <span class="mi">10000</span> <span class="c1"># (SOLN*10)+DATTYP</span>
                    <span class="c1">#solution = base // 10</span>
                    <span class="n">datatype</span> <span class="o">=</span> <span class="n">base</span> <span class="o">%</span> <span class="mi">10</span>
                    <span class="k">assert</span> <span class="n">datatype</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="n">datatype</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="o">+</span><span class="n">nvalues</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">datatype</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">]:</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
                    <span class="c1">#print(f&#39;{nvalues}, {ncurves}, {solution}, {datatype}, {dict_map[datatype]:14s} {values}&#39;)</span>
                    <span class="n">data_out</span><span class="p">[</span><span class="n">datatype</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">nvalues</span>
                <span class="n">marker</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">cddata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_out</span><span class="p">)</span>
                <span class="c1">#import matplotlib.pyplot as plt</span>

                <span class="c1">#dict_map = {</span>
                    <span class="c1">#1: &#39;RPM&#39;,</span>
                    <span class="c1">#2: &#39;eigenfreq&#39;,</span>
                    <span class="c1">#3: &#39;Lehr&#39;,</span>
                    <span class="c1">#4: &#39;real eig&#39;,</span>
                    <span class="c1">#5: &#39;imag eig&#39;,</span>
                    <span class="c1">#6: &#39;whirl_dir&#39;,</span>
                    <span class="c1">#7: &#39;converted_freq&#39;,</span>
                    <span class="c1">#8: &#39;whirl_code&#39;,</span>
                <span class="c1">#}</span>

                <span class="c1">#plt.figure(2)</span>
                <span class="c1">#plt.plot(data_out[1], data_out[2]) # RPM vs. eigenfreq</span>
                <span class="c1">#plt.grid(True)</span>

                <span class="c1">#plt.figure(3)</span>
                <span class="c1">#plt.plot(data_out[1], data_out[3]) # RPM vs. Lehr</span>
                <span class="c1">#plt.grid(True)</span>

                <span class="c1">#plt.figure(4)</span>
                <span class="c1">#plt.plot(data_out[1], data_out[4]) # RPM vs. real_eig</span>
                <span class="c1">#plt.grid(True)</span>

                <span class="c1">#plt.figure(5)</span>
                <span class="c1">#plt.plot(data_out[1], data_out[5]) # RPM vs. imag_eig</span>
                <span class="c1">#plt.grid(True)</span>

                <span class="c1">#plt.figure(7)</span>
                <span class="c1">#plt.plot(data_out[1], data_out[7]) # RPM vs. converted_freq</span>
                <span class="c1">#plt.grid(True)</span>

            <span class="c1">#print(&#39;------------------------------------&#39;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;CDDATA method=</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1">#plt.grid(True)</span>
            <span class="c1">#plt.show()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">cddata</span> <span class="o">=</span> <span class="n">cddata_list</span>
        <span class="n">nfields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.read_stdisp"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_stdisp">[docs]</a>    <span class="k">def</span> <span class="nf">read_stdisp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the STDISP table&quot;&quot;&quot;</span>
        <span class="c1">#C:\NASA\m4\formats\git\examples\backup\aeroelasticity\loadf.op2</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">#(101, 1, 27, 0, 3, 1, 0)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data, types=&#39;ifs&#39;, endian=None)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">Struct</span><span class="p">(</span><span class="s1">&#39;8s&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;STDISP  &#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">,</span> <span class="n">b5</span><span class="p">,</span> <span class="n">b6</span><span class="p">,</span> <span class="n">b7</span><span class="p">,</span> <span class="n">b8</span><span class="p">,</span> <span class="n">b9</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="s1">&#39;64s 5i 12s 3i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#a 345 0 0 0 0 b&#39;DISPSTWING  &#39; 1 0 123</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">,</span> <span class="n">b5</span><span class="p">,</span> <span class="n">b6</span><span class="p">,</span> <span class="n">b7</span><span class="p">,</span> <span class="n">b8</span><span class="p">,</span> <span class="n">b9</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">b1</span> <span class="o">==</span> <span class="mi">345</span><span class="p">,</span> <span class="n">out</span>
        <span class="k">assert</span> <span class="n">b2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span>
        <span class="k">assert</span> <span class="n">b3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span>
        <span class="k">assert</span> <span class="n">b4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span>
        <span class="k">assert</span> <span class="n">b5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span>
        <span class="k">assert</span> <span class="n">b6</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;DISPSTWING  &#39;</span><span class="p">,</span> <span class="n">out</span>
        <span class="k">assert</span> <span class="n">b7</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out</span>
        <span class="k">assert</span> <span class="n">b8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span>
        <span class="k">assert</span> <span class="n">b9</span> <span class="o">==</span> <span class="mi">123</span><span class="p">,</span> <span class="n">out</span>
        <span class="c1">#print(a, b1, b2, b3, b4, b5, b6, b7, b8, b9)</span>
        <span class="c1">#&#39;STWING  COMPLETE STRUCTURAL WING                                &#39;</span>
        <span class="c1">#(345, 0, 0, 0, 0, 1347635524, 1230459987, 538986318, 1, 0, 123)</span>
        <span class="c1">#(4.834479701920619e-43, 0.0, 0.0, 0.0, 0.0, 14179176448.0, 881989.1875, 1.35761196e-19, 1.4012e-45, 0.0, 1.72359)</span>
        <span class="c1">#self.show_data(data[96:], types=&#39;ifs&#39;, endian=None)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="OP2Reader.read_omm2"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_omm2">[docs]</a>    <span class="k">def</span> <span class="nf">read_omm2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the OMM2 table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="c1">#op2.log.debug(&quot;table_name = %r&quot; % op2.table_name)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
            <span class="n">subtable_name</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s5i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="p">(</span>
                    <span class="n">subtable_name</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_month</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_subtables</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_read_pcompts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the PCOMPTS table (poorly).</span>
<span class="sd">        The PCOMPTS table stores information about the PCOMP cards???</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skip_pcompts</span><span class="p">()</span>
        <span class="k">return</span>
        <span class="c1">#if self.read_mode == 1:</span>
            <span class="c1">#return</span>
        <span class="c1">#op2.log.debug(&quot;table_name = %r&quot; % op2.table_name)</span>
        <span class="c1">#table_name = self._read_table_name(rewind=False)</span>

        <span class="c1">#self.read_markers([-1])</span>
        <span class="c1">#data = self._read_record()</span>

        <span class="c1">#self.read_3_markers([-2, 1, 0])</span>
        <span class="c1">#data = self._read_record()</span>
        <span class="c1">#table_name, = op2.struct_8s.unpack(data)</span>
        <span class="c1">##print &quot;table_name = %r&quot; % table_name</span>

        <span class="c1">#self.read_3_markers([-3, 1, 0])</span>
        <span class="c1">#markers = self.get_nmarkers(1, rewind=True)</span>
        <span class="c1">#if markers != [-4]:</span>
            <span class="c1">#data = self._read_record()</span>

        <span class="c1">#self.read_3_markers([-4, 1, 0])</span>
        <span class="c1">#markers = self.get_nmarkers(1, rewind=True)</span>
        <span class="c1">#if markers != [0]:</span>
            <span class="c1">#data = self._read_record()</span>
        <span class="c1">#else:</span>
            <span class="c1">#self.read_markers([0])</span>
            <span class="c1">#return</span>

        <span class="c1">#self.read_3_markers([-5, 1, 0])</span>
        <span class="c1">#data = self._read_record()</span>

        <span class="c1">#self.read_3_markers([-6, 1, 0])</span>
        <span class="c1">#self.read_markers([0])</span>

    <span class="k">def</span> <span class="nf">_skip_pcompts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the PCOMPTS table (poorly).</span>
<span class="sd">        The PCOMPTS table stores information about the PCOMP cards???</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;table_name = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1">#read_record = self._skip_record if self.read_mode == 2 else self._read_record</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># (104, 0,   1,   3, 0, 0,   0) - tpl\qrcomp.op2 PCOMPTS (length 3?)</span>
        <span class="c1"># (104, 8,   0,   0, 0, 0,   0) - tpl\lmtas1.op2 PCOMPTS (return after -4)</span>
        <span class="c1"># (104, 0, 103, 412, 0, 0, 103) - output.op2     PCOMPT  (return at end)</span>
        <span class="n">data_header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data_header, types=&#39;ifsd&#39;, endian=None)</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">bi</span><span class="p">,</span> <span class="n">n4a</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">n4b</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&lt;7i&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data_header</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;a=</span><span class="si">%s</span><span class="s1"> b=</span><span class="si">%s</span><span class="s1"> n4a=</span><span class="si">%s</span><span class="s1"> n5=</span><span class="si">%s</span><span class="s1"> e=</span><span class="si">%s</span><span class="s1"> f=</span><span class="si">%s</span><span class="s1"> n4b=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">bi</span><span class="p">,</span> <span class="n">n4a</span><span class="p">,</span> <span class="n">n5</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">n4b</span><span class="p">))</span>
        <span class="c1">#assert n4a == n4b, &#39;n4a=%s n4b=%s&#39; % (n4a, n4b)</span>

        <span class="k">if</span> <span class="n">table_name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;PCOMPT&#39;</span><span class="p">:</span>
            <span class="n">n4words</span> <span class="o">=</span> <span class="n">n4a</span> <span class="o">*</span> <span class="mi">4</span>
            <span class="n">n5words</span> <span class="o">=</span> <span class="n">n5</span> <span class="o">*</span> <span class="mi">32</span>
        <span class="k">elif</span> <span class="n">table_name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;PCOMPTS&#39;</span><span class="p">:</span>
            <span class="n">n4words</span> <span class="o">=</span> <span class="n">n4a</span> <span class="o">*</span> <span class="mi">3</span>
            <span class="n">n5words</span> <span class="o">=</span> <span class="n">n5</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1"># &#39;IPCOMPT &#39;</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#table_name, = op2.struct_8s.unpack(data)</span>

        <span class="n">isubtable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">isubtable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">markers</span> <span class="o">!=</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markers</span> <span class="o">!=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="c1"># n4a=0</span>
            <span class="c1">#self.show_data(data_header, types=&#39;ifsd&#39;)</span>
            <span class="c1"># (1, 4, 0, &#39;    &#39;)</span>
            <span class="c1">#(421, 4, 128, &#39;    &#39;)</span>
            <span class="c1">#(814, 4, 256, &#39;    &#39;)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">n4words</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;n4words=</span><span class="si">%s</span><span class="s1"> len(data)=</span><span class="si">%s</span><span class="s1"> n4words*4=</span><span class="si">%s</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">n4words</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">n4words</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">table_name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;PCOMPTS&#39;</span><span class="p">:</span>
                <span class="c1"># (11, 3, 0)</span>
                <span class="k">pass</span>
                <span class="c1">#self.show_data(data, types=&#39;ifs&#39;, endian=None)</span>
            <span class="k">elif</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># pramga: no cover</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&lt; 3i 4s&#39;</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">datai</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">16</span><span class="p">]</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">datai</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">16</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j (-4) = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">j</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;-4&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">assert</span> <span class="n">n4a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n4a</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">n5words</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;n5words=</span><span class="si">%s</span><span class="s1"> len(data)=</span><span class="si">%s</span><span class="s1"> n5words*4=</span><span class="si">%s</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="p">(</span><span class="n">n5words</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">n5words</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">table_name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;PCOMPTS&#39;</span><span class="p">:</span>
            <span class="c1"># (101, 102, 103)</span>
            <span class="k">pass</span>
            <span class="c1">#self.show_data(data, types=&#39;ifs&#39;, endian=None)</span>
        <span class="k">elif</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># pramga: no cover</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nbytes</span> <span class="o">=</span> <span class="mi">128</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&lt; 6i fi 96s&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">datai</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">nbytes</span><span class="p">]</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">blank</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">datai</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">blank</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()))</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="n">nbytes</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j (-5) = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="s1">&#39;-5&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

<div class="viewcode-block" id="OP2Reader.read_meff"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_meff">[docs]</a>    <span class="k">def</span> <span class="nf">read_meff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the MEFF table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;table_name = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---marker0 = </span><span class="si">%s</span><span class="s1">---</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1">#print(&#39;markers =&#39;, markers)</span>
            <span class="n">nbytes</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">12</span>
            <span class="n">unused_data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nbytes</span><span class="p">)</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">nbytes</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="OP2Reader.read_intmod"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_intmod">[docs]</a>    <span class="k">def</span> <span class="nf">read_intmod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reads the INTMOD table</span>

<span class="sd">        tested by TestNastranGUI.test_femap_rougv1_01</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1">#op2.log.debug(&#39;table_name = %r&#39; % op2.table_name)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#print(&#39;intmod data1&#39;)</span>
        <span class="c1">#self.show_data(data)</span>

        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---marker0 = </span><span class="si">%s</span><span class="s1">---</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#print(&#39;intmod data2&#39;)</span>
        <span class="c1">#self.show_data(data)</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1">#print(&#39;markers =&#39;, markers)</span>
            <span class="n">nbytes</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">12</span>
            <span class="n">unused_data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nbytes</span><span class="p">)</span>
            <span class="c1">#print(&#39;intmod data%i&#39; % n)</span>
            <span class="c1">#self.show_data(data)</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">nbytes</span>

        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>
        <span class="c1">#self.show(50)</span>
        <span class="c1">#raise NotImplementedError(op2.table_name)</span>

<div class="viewcode-block" id="OP2Reader.read_r1tabrg"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_r1tabrg">[docs]</a>    <span class="k">def</span> <span class="nf">read_r1tabrg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the R1TABRG design response optimization table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>

        <span class="c1"># TODO: I think this is used to handle optimization</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">read_record_ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_skip_read_record_ndata</span><span class="p">()</span>

        <span class="c1"># (101, 221355, 0, 0, 0, 0, 0)</span>
        <span class="c1"># (???, nvalues,?, ?, ?, ?, ?)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">mapfmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">unused_nvalues</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#print(values)</span>
        <span class="c1">#self.show_data(data, types=&#39;i&#39;, endian=None)</span>

        <span class="c1">#&#39;R1TAB   &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="n">read_record_ndata</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">ndata</span>

        <span class="n">itable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">stop_marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stop_marker</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="n">read_record_ndata</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_r1tabrg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)</span>
            <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">stop_marker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.get_skip_read_record_ndata"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_skip_read_record_ndata">[docs]</a>    <span class="k">def</span> <span class="nf">get_skip_read_record_ndata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;selects the read_record or skip_record depending on read_mode&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">read_record_ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">read_record_ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record_ndata</span>
        <span class="k">return</span> <span class="n">read_record_ndata</span></div>

    <span class="k">def</span> <span class="nf">_read_r1tabrg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Design Responses:</span>
<span class="sd">          - Weight</span>
<span class="sd">          - Flutter Speed</span>
<span class="sd">          - Stress</span>
<span class="sd">          - Strain</span>
<span class="sd">          - Displacement</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">result_name</span> <span class="o">=</span> <span class="s1">&#39;responses&#39;</span>
        <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">_results</span><span class="o">.</span><span class="n">is_not_saved</span><span class="p">(</span><span class="n">result_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ndata</span>

        <span class="c1">#op2._results._found_result(result_name)</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">op2_results</span><span class="o">.</span><span class="n">responses</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">response_type</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response_type</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_q</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">24</span><span class="p">])</span>

            <span class="c1">#assert response_type in [1, 6, 10, 84], response_type</span>
            <span class="k">if</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">responses</span><span class="o">.</span><span class="n">weight_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">weight_response</span> <span class="o">=</span> <span class="n">WeightResponse</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">weight_response</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="c1">#TYPE =4 EIGN or FREQ</span>
                <span class="c1">#8 MODE I Mode number</span>
                <span class="c1">#9 APRX I Approximation code</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="c1">#TYPE =5 DISP</span>
                <span class="c1">#8 COMP I Displacement component</span>
                <span class="c1">#9 UNDEF None</span>
                <span class="c1">#10 GRID I Grid identification number</span>
                <span class="k">if</span> <span class="n">responses</span><span class="o">.</span><span class="n">displacement_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">displacement_response</span> <span class="o">=</span> <span class="n">DisplacementResponse</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">displacement_response</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">responses</span><span class="o">.</span><span class="n">stress_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">stress_response</span> <span class="o">=</span> <span class="n">StressResponse</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">stress_response</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">responses</span><span class="o">.</span><span class="n">strain_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">strain_response</span> <span class="o">=</span> <span class="n">StrainResponse</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">strain_response</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">responses</span><span class="o">.</span><span class="n">force_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">force_response</span> <span class="o">=</span> <span class="n">ForceResponse</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">force_response</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
                <span class="c1"># CEIG</span>
                <span class="c1">#8 MODE I Mode number</span>
                <span class="c1">#9 ICODE I 1: Real component or 2: Imaginary component</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">23</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">responses</span><span class="o">.</span><span class="n">flutter_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">fractional_mass_response</span> <span class="o">=</span> <span class="n">FractionalMassResponse</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">fractional_mass_response</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">84</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">responses</span><span class="o">.</span><span class="n">flutter_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">flutter_response</span> <span class="o">=</span> <span class="n">FlutterResponse</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">responses</span><span class="o">.</span><span class="n">flutter_response</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">ndata</span>
            <span class="c1">#else: # response not added...</span>
                <span class="c1">#pass</span>

        <span class="n">read_r1tabrg</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">read_r1tabrg</span><span class="p">:</span>
            <span class="c1">#self.show_data(data, types=&#39;ifs&#39;, endian=None)</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;3i 8s 4i i 5i&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="sa">b</span><span class="s1">&#39;3q 16s 4q q 5q&#39;</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="c1"># per the R1TAB DMAP page:</span>
            <span class="c1">#   all indicies are downshift by 1</span>
            <span class="c1">#   indices above out[3] are off by +2 because of the 2 field response_label</span>
            <span class="n">internal_id</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dresp_id</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">response_type</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">response_label</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># -1 for 2 field wide response_label</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">type_flag</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>  <span class="c1"># no meaning per MSC DMAP 2005</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>

            <span class="n">response_label</span> <span class="o">=</span> <span class="n">response_label</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">weight_response</span><span class="o">.</span><span class="n">add_from_op2</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># DISP</span>
                <span class="c1"># out = (1, 101, 5, &#39;DISP1   &#39;, 101, 1, 3, 0, 1, 0, 0, 0, 0, 0)</span>
                <span class="n">comp</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">nid</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="c1">#msg = f&#39;DISP - label={response_label!r} region={region} subcase={subcase} nid={nid}&#39;</span>
                <span class="c1">#print(msg)</span>
                <span class="c1">#print(out[6:])</span>
                <span class="c1"># (3,   0,  1,    0,   0,   0,   0,   0)</span>
                <span class="c1"># (???, NA, comp, ???, ???, ???, ???, ???)</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">displacement_response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">internal_id</span><span class="p">,</span> <span class="n">dresp_id</span><span class="p">,</span> <span class="n">response_label</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
                    <span class="n">subcase</span><span class="p">,</span> <span class="n">type_flag</span><span class="p">,</span> <span class="n">seid</span><span class="p">,</span>
                    <span class="n">nid</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>  <span class="c1"># STRESS</span>
                <span class="c1">#                              -----   STRESS RESPONSES   -----</span>
                <span class="c1">#  -------------------------------------------------------------------------------------------</span>
                <span class="c1">#   INTERNAL  DRESP1  RESPONSE  ELEMENT   VIEW   COMPONENT  LOWER   INPUT    OUTPUT    UPPER</span>
                <span class="c1">#      ID       ID     LABEL       ID    ELM ID     NO.     BOUND   VALUE     VALUE    BOUND</span>
                <span class="c1">#  -------------------------------------------------------------------------------------------</span>
                <span class="c1">#         21      209  S09L      144747             17       N/A   4.85E+04  5.00E+04  5.00E+04</span>
                <span class="c1"># (21, 209, 6, &#39;S09L    &#39;, 30, 1011, 17, 0, 144747, 0, 0, 0, 0, 0)</span>
                <span class="n">stress_code</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">pid</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="c1">#msg = (&#39;STRESS - response_type=%r label=%r region=%s subcase=%s &#39;</span>
                       <span class="c1">#&#39;stress_code=%s pid=%s&#39; % (</span>
                           <span class="c1">#response_type, response_label, region, subcase,</span>
                           <span class="c1">#stress_code, pid))</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">stress_response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">internal_id</span><span class="p">,</span> <span class="n">dresp_id</span><span class="p">,</span> <span class="n">response_label</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
                    <span class="n">subcase</span><span class="p">,</span> <span class="n">type_flag</span><span class="p">,</span> <span class="n">seid</span><span class="p">,</span>
                    <span class="n">stress_code</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># STRAIN</span>
                <span class="n">strain_code</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">pid</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">strain_response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">internal_id</span><span class="p">,</span> <span class="n">dresp_id</span><span class="p">,</span> <span class="n">response_label</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
                    <span class="n">subcase</span><span class="p">,</span> <span class="n">type_flag</span><span class="p">,</span> <span class="n">seid</span><span class="p">,</span>
                    <span class="n">strain_code</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>  <span class="c1"># FORCE</span>
                <span class="c1">#print(&#39;internal_id=%s dresp_id=%s response_type=%s response_label=%s&#39;</span>
                      <span class="c1">#&#39; region=%s subcase=%s type_flag=%s seid=%s&#39; % (</span>
                    <span class="c1">#internal_id, dresp_id, response_type, response_label,</span>
                    <span class="c1">#region, subcase, type_flag, seid</span>
                <span class="c1">#))</span>
                <span class="n">force_code</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">pid</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="c1">#msg = &#39;FORCE - label=%r region=%s subcase=%s force_code=%s pid=%s&#39; % (</span>
                    <span class="c1">#response_label, region, subcase, force_code, pid)</span>
                <span class="c1">#print(msg)</span>
                <span class="c1">#print(out)</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">force_response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">internal_id</span><span class="p">,</span> <span class="n">dresp_id</span><span class="p">,</span> <span class="n">response_label</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
                    <span class="n">subcase</span><span class="p">,</span> <span class="n">type_flag</span><span class="p">,</span> <span class="n">seid</span><span class="p">,</span>
                    <span class="n">force_code</span><span class="p">,</span> <span class="n">pid</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># CSTRESS</span>
                <span class="n">stress_code</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="c1">#ply = out[7]</span>
                <span class="c1">#pid = out[8]  # is this element id?</span>
                <span class="c1">#msg = &#39;CSTRESS - label=%r region=%s subcase=%s stress_code=%s ply=%s pid=%s&#39; % (</span>
                    <span class="c1">#response_label, region, subcase, stress_code, ply, pid)</span>
                <span class="c1">#print(msg)</span>
            <span class="c1">#elif response_type == 10:  # CSTRAIN</span>
                <span class="c1">#pass</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">23</span><span class="p">:</span>  <span class="c1"># fractional mass response</span>
                <span class="c1">#msg = f&#39;??? - label={response_label!r} region={region} subcase={subcase}&#39;</span>
                <span class="c1">#print(msg)</span>
                <span class="c1">#print(out[6:])</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">fractional_mass_response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">internal_id</span><span class="p">,</span> <span class="n">dresp_id</span><span class="p">,</span> <span class="n">response_label</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
                    <span class="n">subcase</span><span class="p">,</span> <span class="n">type_flag</span><span class="p">,</span> <span class="n">seid</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>  <span class="c1"># FRSTRE</span>
                <span class="c1">#8 ICODE I Stress item code</span>
                <span class="c1">#9 UNDEF None</span>
                <span class="c1">#10 ELID I Element identification number</span>
                <span class="c1">#11 FREQ RS Frequency</span>
                <span class="c1">#12 IFLAG I Integrated response flag. See Remark 20 of DRESP1.</span>
                <span class="c1">#Value is -1 to -6, for SUM, AVG, SSQ,</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>  <span class="c1"># RMSACCL</span>
                <span class="c1">#8 COMP I RMS Acceleration component</span>
                <span class="c1">#9 RANDPS I RANDPS entry identification number</span>
                <span class="c1">#10 GRID I Grid identification number</span>
                <span class="c1">#11 DMFREQ RS Dummy frequency for internal use</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">84</span><span class="p">:</span>
                <span class="c1"># FLUTTER  (iii, label, mode, (Ma, V, rho), flutter_id, fff)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;iii 8s iii fff i fff&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="n">mode</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">mach</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
                <span class="n">velocity</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">density</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
                <span class="n">flutter_id</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
                <span class="c1">#msg = (&#39;FLUTTER - _count=%s label=%r region=%s subcase=%s mode=%s &#39;</span>
                       <span class="c1">#&#39;mach=%s velocity=%s density=%s flutter_id=%s&#39; % (</span>
                           <span class="c1">#op2._count, response_label, region, subcase, mode,</span>
                           <span class="c1">#mach, velocity, density, flutter_id))</span>
                <span class="n">responses</span><span class="o">.</span><span class="n">flutter_response</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">internal_id</span><span class="p">,</span> <span class="n">dresp_id</span><span class="p">,</span> <span class="n">response_label</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span>
                    <span class="n">subcase</span><span class="p">,</span> <span class="n">type_flag</span><span class="p">,</span> <span class="n">seid</span><span class="p">,</span>
                    <span class="n">mode</span><span class="p">,</span> <span class="n">mach</span><span class="p">,</span> <span class="n">velocity</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">flutter_id</span><span class="p">)</span>
                <span class="c1">#print(msg)</span>
                <span class="c1">#self.log.debug(msg)</span>
            <span class="c1">#else:</span>
                <span class="c1">#self.log.debug(&#39;R1TABRG response response_type=%s not supported&#39; % response_type)</span>
                <span class="c1">#raise NotImplementedError(response_type)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">14</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="c1">#self.response1_table[self._count] = out</span>
        <span class="k">return</span> <span class="n">ndata</span>

<div class="viewcode-block" id="OP2Reader.read_sdf"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_sdf">[docs]</a>    <span class="k">def</span> <span class="nf">read_sdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads the SDF table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;table_name = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
            <span class="n">subtable_name</span><span class="p">,</span> <span class="n">dummy_a</span><span class="p">,</span> <span class="n">dummy_b</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8sii&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="p">(</span>
                    <span class="n">subtable_name</span><span class="p">,</span> <span class="n">dummy_a</span><span class="p">,</span> <span class="n">dummy_b</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">dummy_a</span> <span class="o">==</span> <span class="mi">170</span><span class="p">,</span> <span class="n">dummy_a</span>
                <span class="k">assert</span> <span class="n">dummy_b</span> <span class="o">==</span> <span class="mi">170</span><span class="p">,</span> <span class="n">dummy_b</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strings</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(data) = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ndata</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;strings  = </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">strings</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;ints     = </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;floats   = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">floats</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">unused_markers0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">unused_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block</span><span class="p">()</span>

        <span class="c1">#data = self._read_record()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span></div>
        <span class="c1">#self._read_subtables()</span>

<div class="viewcode-block" id="OP2Reader.read_tol"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_tol">[docs]</a>    <span class="k">def</span> <span class="nf">read_tol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is probably broken for MSC Nastran</span>

<span class="sd">        TOL</span>
<span class="sd">        ---</span>
<span class="sd">        -2 - nitimes?</span>
<span class="sd">        -3 - list of times?</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unused_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stop_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#self.show_data(data)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1">#op2.show_ndata(440, types=&#39;if&#39;)</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="c1">#print(&#39;----&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1">#op2.show_ndata(440, types=&#39;if&#39;)</span>
        <span class="c1">#print(&#39;----&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span></div>
        <span class="c1">#data = self._read_record()</span>


        <span class="c1">#op2.show_ndata(440, types=&#39;ifs&#39;)</span>

        <span class="c1">#self.show_data(data)</span>

    <span class="k">def</span> <span class="nf">_get_matrix_row_fmt_nterms_nfloats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="n">tout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        +------+---------------------------+</span>
<span class="sd">        | Type | Meaning                   |</span>
<span class="sd">        +------+---------------------------+</span>
<span class="sd">        |  1   | Real, single precision    |</span>
<span class="sd">        |  2   | Real, double precision    |</span>
<span class="sd">        |  3   | Complex, single precision |</span>
<span class="sd">        |  4   | Complex, double precision |</span>
<span class="sd">        +------+---------------------------+</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nfloats</span> <span class="o">=</span> <span class="n">nvalues</span>
            <span class="n">nterms</span> <span class="o">=</span> <span class="n">nvalues</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;i </span><span class="si">%i</span><span class="s1">f&#39;</span> <span class="o">%</span> <span class="n">nfloats</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">nfloats</span> <span class="o">=</span> <span class="n">nvalues</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">nterms</span> <span class="o">=</span> <span class="n">nvalues</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;i </span><span class="si">%i</span><span class="s1">d&#39;</span> <span class="o">%</span> <span class="n">nfloats</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">nfloats</span> <span class="o">=</span> <span class="n">nvalues</span>
            <span class="n">nterms</span> <span class="o">=</span> <span class="n">nvalues</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;i </span><span class="si">%i</span><span class="s1">f&#39;</span> <span class="o">%</span> <span class="n">nfloats</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">nfloats</span> <span class="o">=</span> <span class="n">nvalues</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">nterms</span> <span class="o">=</span> <span class="n">nvalues</span> <span class="o">//</span> <span class="mi">4</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;i </span><span class="si">%i</span><span class="s1">d&#39;</span> <span class="o">%</span> <span class="n">nfloats</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;tout = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tout</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">nfloats</span><span class="p">,</span> <span class="n">nterms</span>

    <span class="k">def</span> <span class="nf">_read_matrix_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a matrix in &quot;standard&quot; form.  The forms are::</span>
<span class="sd">            standard:</span>
<span class="sd">                Return a matrix that looks similar to a matrix found</span>
<span class="sd">                in the OP4.  Created by:</span>
<span class="sd">                ``ASSIGN output2=&#39;model.op2&#39;, UNIT=12,UNFORMATTED,DELETE``</span>
<span class="sd">                ``OUTPUT2 KGG//0/12``</span>
<span class="sd">            matpool:</span>
<span class="sd">                Return a matrix that looks similar to a DMIG matrix</span>
<span class="sd">                (e.g., it contains the node id and DOF).  Created by:</span>
<span class="sd">                ``ASSIGN output2=&#39;model.op2&#39;, UNIT=12,UNFORMATTED,DELETE``</span>
<span class="sd">                ``TODO: add the magic keyword...``</span>
<span class="sd">                ``OUTPUT2 KGG//0/12``</span>

<span class="sd">        Matrix Trailer:</span>
<span class="sd">        +------+---------------------------------------------------+</span>
<span class="sd">        | Word | Contents                                          |</span>
<span class="sd">        +======+===================================================+</span>
<span class="sd">        |  1   | Number of columns in matrix                       |</span>
<span class="sd">        |  2   | Number of rows in matrix                          |</span>
<span class="sd">        |  3   | Form of the matrix                                |</span>
<span class="sd">        |  4   | Type of matrix                                    |</span>
<span class="sd">        |  5   | Largest number of nonzero words among all columns |</span>
<span class="sd">        |  6   | Density of the matrix multiplied by 10000         |</span>
<span class="sd">        |  7   | Size in blocks                                    |</span>
<span class="sd">        |  8   | Maximum string length over all strings            |</span>
<span class="sd">        |  9   | Number of strings                                 |</span>
<span class="sd">        |  10  | Average bandwidth                                 |</span>
<span class="sd">        |  11  | Maximum bandwidth                                 |</span>
<span class="sd">        |  12  | Number of null columns                            |</span>
<span class="sd">        +------+---------------------------------------------------+</span>

<span class="sd">        +------+--------------------------------+</span>
<span class="sd">        | Form | Meaning                        |</span>
<span class="sd">        +======+================================+</span>
<span class="sd">        |  1   | Square                         |</span>
<span class="sd">        |  2   | Rectangular                    |</span>
<span class="sd">        |  3   | Diagonal                       |</span>
<span class="sd">        |  4   | Lower triangular factor        |</span>
<span class="sd">        |  5   | Upper triangular factor        |</span>
<span class="sd">        |  6   | Symmetric                      |</span>
<span class="sd">        |  8   | Identity                       |</span>
<span class="sd">        |  9   | Pseudo identity                |</span>
<span class="sd">        |  10  | Cholesky factor                |</span>
<span class="sd">        |  11  | Trapezoidal factor             |</span>
<span class="sd">        |  13  | Sparse lower triangular factor |</span>
<span class="sd">        |  15  | Sparse upper triangular factor |</span>
<span class="sd">        +------+--------------------------------+</span>

<span class="sd">        +------+---------------------------+</span>
<span class="sd">        | Type | Meaning                   |</span>
<span class="sd">        +======+===========================+</span>
<span class="sd">        |  1   | Real, single precision    |</span>
<span class="sd">        |  2   | Real, double precision    |</span>
<span class="sd">        |  3   | Complex, single precision |</span>
<span class="sd">        |  4   | Complex, double precision |</span>
<span class="sd">        +------+---------------------------+</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">allowed_forms</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
        <span class="c1">#self.log.debug(&#39;----------------------------------------------------------------&#39;)</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stop_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="c1"># old-bad</span>
        <span class="c1">#matrix_num, form, mrows, ncols, tout, nvalues, g = unpack(self._endian + b&#39;7i&#39;, data)</span>

        <span class="n">fmt1</span> <span class="o">=</span> <span class="n">mapfmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;7i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="c1">#           good   good   good  good  ???    ???</span>
        <span class="n">matrix_num</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt1</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="c1">#print(&#39;g =&#39;, g)</span>

        <span class="n">utable_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">utable_name</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">matrices</span><span class="p">[</span><span class="n">utable_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>

        <span class="c1"># matrix_num is a counter (101, 102, 103, ...)</span>
        <span class="c1"># 101 will be the first matrix &#39;A&#39; (matrix_num=101),</span>
        <span class="c1"># then we&#39;ll read a new matrix &#39;B&#39; (matrix_num=102),</span>
        <span class="c1"># etc.</span>
        <span class="c1">#</span>
        <span class="c1"># the matrix is Mrows x Ncols</span>
        <span class="c1">#</span>
        <span class="c1"># it has nvalues in it</span>
        <span class="c1">#</span>
        <span class="c1"># tout is the precision of the matrix</span>
        <span class="c1"># 0 - set precision by cell</span>
        <span class="c1"># 1 - real, single precision (float32)</span>
        <span class="c1"># 2 - real, double precision (float64)</span>
        <span class="c1"># 3 - complex, single precision (complex64)</span>
        <span class="c1"># 4 - complex, double precision (complex128)</span>

        <span class="c1"># form (bad name)</span>
        <span class="c1"># 1 - column matrix</span>
        <span class="c1"># 2 - factor matrix</span>
        <span class="c1"># 3 - factor matrix</span>
        <span class="k">if</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float32&#39;</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;complex64&#39;</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;complex128&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;???&#39;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;unexpected tout for </span><span class="si">%s</span><span class="s1">: matrix_num=</span><span class="si">%s</span><span class="s1"> form=</span><span class="si">%s</span><span class="s1"> &#39;</span>
                   <span class="s1">&#39;mrows=</span><span class="si">%s</span><span class="s1"> ncols=</span><span class="si">%s</span><span class="s1"> tout=</span><span class="si">%s</span><span class="s1"> nvalues=</span><span class="si">%s</span><span class="s1"> g=</span><span class="si">%s</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="p">(</span>
                       <span class="n">table_name</span><span class="p">,</span> <span class="n">matrix_num</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1">#self.log.error(&#39;name=%r matrix_num=%s form=%s mrows=%s &#39;</span>
        <span class="c1">#               &#39;ncols=%s tout=%s nvalues=%s g=%s&#39; % (</span>
        <span class="c1">#                   table_name, matrix_num, form, mrows, ncols, tout, nvalues, g))</span>
        <span class="k">if</span> <span class="n">form</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ncols</span> <span class="o">!=</span> <span class="n">mrows</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;unexpected size for </span><span class="si">%s</span><span class="s1">; form=</span><span class="si">%s</span><span class="s1"> mrows=</span><span class="si">%s</span><span class="s1"> ncols=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">table_name</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">form</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allowed_forms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;name=</span><span class="si">%r</span><span class="s1"> matrix_num=</span><span class="si">%s</span><span class="s1"> form=</span><span class="si">%s</span><span class="s1"> mrows=</span><span class="si">%s</span><span class="s1"> &#39;</span>
                           <span class="s1">&#39;ncols=</span><span class="si">%s</span><span class="s1"> tout=</span><span class="si">%s</span><span class="s1"> nvalues=</span><span class="si">%s</span><span class="s1"> g=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                               <span class="n">table_name</span><span class="p">,</span> <span class="n">matrix_num</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span>
                               <span class="n">tout</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;form=</span><span class="si">%s</span><span class="s1">; allowed=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">form</span><span class="p">,</span> <span class="n">allowed_forms</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;name=</span><span class="si">%r</span><span class="s1"> matrix_num=</span><span class="si">%s</span><span class="s1"> form=</span><span class="si">%s</span><span class="s1"> mrows=</span><span class="si">%s</span><span class="s1"> ncols=</span><span class="si">%s</span><span class="s1"> tout=</span><span class="si">%s</span><span class="s1"> &#39;</span>
                           <span class="s1">&#39;nvalues=</span><span class="si">%s</span><span class="s1"> g=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                               <span class="n">table_name</span><span class="p">,</span> <span class="n">matrix_num</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#if tout == 1:</span>
                <span class="c1">#tout = 2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;name=</span><span class="si">%r</span><span class="s1"> matrix_num=</span><span class="si">%s</span><span class="s1"> form=</span><span class="si">%s</span><span class="s1"> mrows=</span><span class="si">%s</span><span class="s1"> ncols=</span><span class="si">%s</span><span class="s1"> tout=</span><span class="si">%s</span><span class="s1"> &#39;</span>
                          <span class="s1">&#39;nvalues=</span><span class="si">%s</span><span class="s1"> g=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                              <span class="n">table_name</span><span class="p">,</span> <span class="n">matrix_num</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="n">g</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">unused_name</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">bi</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s 2i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">ai</span> <span class="o">==</span> <span class="mi">170</span><span class="p">,</span> <span class="n">ai</span>
                <span class="k">assert</span> <span class="n">bi</span> <span class="o">==</span> <span class="mi">170</span><span class="p">,</span> <span class="n">bi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;unexpected matrix length=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="c1">#self.log.warning(self.show_data(data, types=&#39;if&#39;))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">unused_name</span><span class="p">,</span> <span class="n">ai</span><span class="p">,</span> <span class="n">bi</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s 2q&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                <span class="c1"># name isn&#39;t mapped</span>
                <span class="k">assert</span> <span class="n">ai</span> <span class="o">==</span> <span class="mi">170</span><span class="p">,</span> <span class="n">ai</span>
                <span class="k">assert</span> <span class="n">bi</span> <span class="o">==</span> <span class="mi">170</span><span class="p">,</span> <span class="n">bi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;unexpected matrix length=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="c1">#self.log.warning(self.show_data(data, types=&#39;ifsqd&#39;, endian=None))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

        <span class="n">itable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="n">unused_j</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">niter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">niter_max</span> <span class="o">=</span> <span class="mi">100000000</span>

        <span class="n">GCi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">GCj</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">jj</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">niter</span> <span class="o">&lt;</span> <span class="n">niter_max</span><span class="p">:</span>
            <span class="c1">#nvalues = self.get_marker1(rewind=True)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">one</span><span class="p">:</span>  <span class="c1"># if keep going</span>
                <span class="n">nvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="k">while</span> <span class="n">nvalues</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">fmt</span><span class="p">,</span> <span class="n">unused_nfloats</span><span class="p">,</span> <span class="n">nterms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_matrix_row_fmt_nterms_nfloats</span><span class="p">(</span>
                        <span class="n">nvalues</span><span class="p">,</span> <span class="n">tout</span><span class="p">)</span>
                    <span class="n">GCjj</span> <span class="o">=</span> <span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="o">*</span> <span class="n">nterms</span>
                    <span class="n">GCj</span> <span class="o">+=</span> <span class="n">GCjj</span>

                    <span class="c1">#-----------</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block</span><span class="p">()</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="c1">#self.log.warning(&#39;skipping matrix&#39;)</span>
                        <span class="c1">#self.show_data(data, types=&#39;ifqd&#39;)</span>
                        <span class="n">fmt</span> <span class="o">=</span> <span class="n">mapfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
                        <span class="c1">#self.log.warning(fmt)</span>
                        <span class="c1">#print(&#39;***itable=%s nvalues=%s fmt=%r&#39; % (itable, nvalues, fmt))</span>
                        <span class="c1">#continue</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="c1">#print(out)</span>
                    <span class="n">ii</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

                    <span class="c1">#list(range(2, 10))</span>
                    <span class="c1">#[2, 3, 4, 5, 6, 7, 8, 9]</span>
                    <span class="n">GCii</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">ii</span> <span class="o">+</span> <span class="n">nterms</span><span class="p">))</span>
                    <span class="n">GCi</span> <span class="o">+=</span> <span class="n">GCii</span>
                    <span class="n">reals</span> <span class="o">+=</span> <span class="n">values</span>
                    <span class="n">nvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_file</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  GCi = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">GCii</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  GCj = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">GCjj</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  reals/imags = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">GCi</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">GCj</span><span class="p">),</span> <span class="s1">&#39;nGCi=</span><span class="si">%s</span><span class="s1"> nGCj=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">GCi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">GCj</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tout</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">GCi</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">reals</span><span class="p">),</span> <span class="s1">&#39;tout=</span><span class="si">%s</span><span class="s1"> nGCi=</span><span class="si">%s</span><span class="s1"> nreals=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">GCi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reals</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">GCi</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">reals</span><span class="p">),</span> <span class="s1">&#39;tout=</span><span class="si">%s</span><span class="s1"> nGCi=</span><span class="si">%s</span><span class="s1"> nreals=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tout</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">GCi</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">reals</span><span class="p">))</span>
                <span class="n">jj</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">nvalues</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nvalues</span>

                <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cast_matrix_mat</span><span class="p">(</span><span class="n">GCi</span><span class="p">,</span> <span class="n">GCj</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">reals</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">DENSE_MATRICES</span><span class="p">:</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
                <span class="n">m</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">matrix</span>
                <span class="k">if</span> <span class="n">matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">op2</span><span class="o">.</span><span class="n">matrices</span><span class="p">[</span><span class="n">table_name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">m</span>
                <span class="c1">#nvalues = self.get_marker1(rewind=True)</span>
                <span class="k">return</span>
            <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">niter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;MaxIteration: this should never happen; n=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">niter_max</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cast_matrix_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">GCi</span><span class="p">,</span> <span class="n">GCj</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">reals</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;helper method for _read_matrix_mat&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="c1">#assert max(GCi) &lt;= mrows, &#39;GCi=%s GCj=%s mrows=%s&#39; % (GCi, GCj, mrows)</span>
        <span class="c1">#assert max(GCj) &lt;= ncols, &#39;GCi=%s GCj=%s ncols=%s&#39; % (GCi, GCj, ncols)</span>

        <span class="c1"># we subtract 1 to the indicides to account for Fortran</span>
        <span class="n">GCi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">GCi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">GCj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">GCj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;???&#39;</span><span class="p">:</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;what is the dtype?&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tout</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="c1"># real</span>
                <span class="n">real_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">real_array</span><span class="p">,</span> <span class="p">(</span><span class="n">GCi</span><span class="p">,</span> <span class="n">GCj</span><span class="p">)),</span>
                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="c1">#self.log.info(&#39;created %s (real)&#39; % self.table_name)</span>
            <span class="k">elif</span> <span class="n">tout</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
                <span class="c1"># complex</span>
                <span class="n">real_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="n">nvalues_matrix</span> <span class="o">=</span> <span class="n">real_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="n">real_complex</span> <span class="o">=</span> <span class="n">real_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nvalues_matrix</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">real_imag</span> <span class="o">=</span> <span class="n">real_complex</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">real_complex</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="p">:</span>
                    <span class="c1">#self.binary_debug.write(&#39;reals = %s&#39; % real_complex[:, 0])</span>
                    <span class="c1">#self.binary_debug.write(&#39;imags = %s&#39; % real_complex[:, 1])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;real_imag = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">real_imag</span><span class="p">)</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">real_imag</span><span class="p">,</span> <span class="p">(</span><span class="n">GCi</span><span class="p">,</span> <span class="n">GCj</span><span class="p">)),</span>
                    <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="c1">#msg = &#39;created %s (complex)&#39; % self.table_name</span>
                <span class="c1">#self.log.debug(msg)</span>
                <span class="c1">#raise RuntimeError(msg)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;this should never happen&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;shape=(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;cant make a coo/sparse matrix...trying dense&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;???&#39;</span><span class="p">:</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;what is the dtype?&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">real_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reals</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;shape=</span><span class="si">%s</span><span class="s1"> mrows=</span><span class="si">%s</span><span class="s1"> ncols=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">real_array</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reals</span><span class="p">)</span> <span class="o">==</span> <span class="n">mrows</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">:</span>
                    <span class="n">real_array</span> <span class="o">=</span> <span class="n">real_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;created </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;cant reshape because invalid sizes : created </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                                     <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

                <span class="n">matrix</span> <span class="o">=</span> <span class="n">real_array</span>
        <span class="k">return</span> <span class="n">matrix</span>

    <span class="k">def</span> <span class="nf">_skip_matrix_mat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a matrix in &quot;standard&quot; form.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        see read_matrix_mat</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unused_table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stop_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>

        <span class="n">itable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="n">niter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">niter_max</span> <span class="o">=</span> <span class="mi">100000000</span>

        <span class="c1">#jj = 1</span>
        <span class="k">while</span> <span class="n">niter</span> <span class="o">&lt;</span> <span class="n">niter_max</span><span class="p">:</span>
            <span class="c1">#nvalues = self.get_marker1(rewind=True)</span>
            <span class="c1">#print(&#39;nvalues4a =&#39;, nvalues)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="n">itable</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">one</span><span class="p">:</span>  <span class="c1"># if keep going</span>
                <span class="n">nvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">nvalues</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block</span><span class="p">()</span>
                    <span class="n">nvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1">#jj += 1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nvalues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">nvalues</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nvalues</span>
                <span class="k">return</span>
            <span class="n">itable</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">niter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;this should never happen; n=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">niter_max</span><span class="p">)</span>

<div class="viewcode-block" id="OP2Reader.read_matrix"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">read_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General method for reading matrices and MATPOOL matrices</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        Matrices are read on read_mode = 1</span>

<span class="sd">        .. todo:: Doesn&#39;t support checking matrices vs. MATPOOLs</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">read_mode_to_read_matrix</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="c1"># if we skip on read_mode=1, we don&#39;t get debugging</span>
        <span class="c1"># if we just use read_mode=2, some tests fail</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">!=</span> <span class="n">read_mode_to_read_matrix</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_file</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_matrix_mat</span><span class="p">()</span>  <span class="c1"># doesn&#39;t work for matpools</span>
            <span class="k">except</span> <span class="ne">MemoryError</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">except</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_goto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_table</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_matrix_mat</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">MemoryError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="c1"># read matpool matrix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_goto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_read_matrix_matpool</span><span class="p">()</span>
            <span class="k">except</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="c1">#raise</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_goto</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skip_table</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_read_matrix_matpool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a MATPOOL matrix</span>

<span class="sd">        MATPOOL matrices are always sparse</span>

<span class="sd">        +------+-----------------+</span>
<span class="sd">        | Form | Meaning         |</span>
<span class="sd">        +======+=================+</span>
<span class="sd">        |  1   | Square          |</span>
<span class="sd">        |  2   | Rectangular     |</span>
<span class="sd">        |  6   | Symmetric       |</span>
<span class="sd">        |  9   | Pseudo identity |</span>
<span class="sd">        +------+-----------------+</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#print(&#39;-------------------------------------&#39;)</span>

        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stop_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">utable_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="c1">#print(utable_name)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#self.show_data(data)</span>
        <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">table_name2</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">utable_name2</span> <span class="o">=</span> <span class="n">table_name2</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">assert</span> <span class="n">utable_name</span> <span class="o">==</span> <span class="n">utable_name2</span><span class="p">,</span> <span class="n">utable_name2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="c1">#self.show(100, types=&#39;iq&#39;)</span>
        <span class="c1">#if utable_name == &#39;DELTAK&#39;:</span>
            <span class="c1">#pass</span>
            <span class="c1">##self.read_markers([1])</span>
            <span class="c1">#self.show(200)</span>
        <span class="c1">#else:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">#self.show(340, types=&#39;ifqd&#39;)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="c1">#self.show(36)</span>

        <span class="c1">#if utable_name == &#39;DELTAK&#39;:</span>
            <span class="c1">#self.show_data(data)</span>

        <span class="c1">#nvalues = len(data) // 4</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.</span>

        <span class="n">header</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;3i 8s 7i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[:</span><span class="mi">48</span><span class="p">])</span> <span class="c1"># 48=4*12</span>
        <span class="k">assert</span> <span class="n">header</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="s1">&#39;header[:3]=</span><span class="si">%s</span><span class="s1"> header=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">header</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">header</span><span class="p">)</span>

        <span class="c1"># ncols_gset is needed for form=9</span>
        <span class="c1">#  list of header values:</span>
        <span class="c1">#    4:5   matrix name</span>
        <span class="c1">#    6     placeholder</span>
        <span class="c1">#    7     matrix shape (1=square, 2 or 9 = rectangular, 6=symmetric)</span>
        <span class="c1">#    8     input type flag (1=single, 2=double, 3=complex single,</span>
        <span class="c1">#                           4=complex double)</span>
        <span class="c1">#    9     output type flag (0=precision set by system cell,</span>
        <span class="c1">#                            1=single, 2=double, 3=complex single,</span>
        <span class="c1">#                            4=complex double)</span>
        <span class="c1">#   10     complex flag (0=real/imaginary, &gt;0=magnitude/phase)</span>
        <span class="c1">#   11     placeholder</span>
        <span class="c1">#   12     number of columns in the G set</span>
        <span class="c1">#          (only necessary for matrix shape 9)</span>
        <span class="n">matrix_name</span><span class="p">,</span> <span class="n">junk1</span><span class="p">,</span> <span class="n">matrix_shape</span><span class="p">,</span> <span class="n">tin</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span> <span class="n">is_phase</span><span class="p">,</span> <span class="n">junk2</span><span class="p">,</span> <span class="n">ncols_gset</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">matrix_name</span> <span class="o">=</span> <span class="n">matrix_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="c1">#self.log.debug(&#39;matrix_name=%s, junk1=%s, matrix_shape=%s, tin=%s, tout=%s, &#39;</span>
                       <span class="c1">#&#39;is_phase=%s, junk2=%s, ncols_gset=%s&#39; % (</span>
                           <span class="c1">#matrix_name, junk1, matrix_shape, tin, tout,</span>
                           <span class="c1">#is_phase, junk2, ncols_gset))</span>

        <span class="n">is_complex</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">tin</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">tout</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">is_complex</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">assert</span> <span class="n">is_phase</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;is_phase=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">is_phase</span>
            <span class="n">imags</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float32&#39;</span>
            <span class="n">fdtype</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">fdtype</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span>
            <span class="n">fdtype</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">double_dtype</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;complex64&#39;</span>
            <span class="n">fdtype</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">fdtype</span>
        <span class="k">elif</span> <span class="n">tout</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;complex128&#39;</span>
            <span class="n">fdtype</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">double_dtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;???&#39;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;matrix_name=</span><span class="si">%s</span><span class="s1">, junk1=</span><span class="si">%s</span><span class="s1">, matrix_shape=</span><span class="si">%s</span><span class="s1">, tin=</span><span class="si">%s</span><span class="s1">, tout=</span><span class="si">%s</span><span class="s1">, &#39;</span>
                   <span class="s1">&#39;is_phase=</span><span class="si">%s</span><span class="s1">, junk2=</span><span class="si">%s</span><span class="s1">, ncols_gset=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                       <span class="n">matrix_name</span><span class="p">,</span> <span class="n">junk1</span><span class="p">,</span> <span class="n">matrix_shape</span><span class="p">,</span> <span class="n">tin</span><span class="p">,</span> <span class="n">tout</span><span class="p">,</span>
                       <span class="n">is_phase</span><span class="p">,</span> <span class="n">junk2</span><span class="p">,</span> <span class="n">ncols_gset</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">is_symmetric</span> <span class="o">=</span> <span class="n">matrix_shape</span> <span class="o">==</span> <span class="mi">6</span>
        <span class="c1">#is_phase_flag = is_phase &gt; 0</span>

        <span class="k">if</span> <span class="n">tout</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="c1"># works for float32, complex64</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">48</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">48</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">fdtype</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">temp_ints</span> <span class="o">=</span> <span class="n">ints</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># works for float64, complex128</span>
            <span class="n">temp_ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">48</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">op2</span><span class="o">.</span><span class="n">idtype</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># find the first index with ()-1,-1)</span>
        <span class="n">iminus1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">temp_ints</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">double_minus1</span> <span class="o">=</span> <span class="p">(</span><span class="n">iminus1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">iminus1</span><span class="p">[</span><span class="mi">1</span><span class="p">:])[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># the field after our stop</span>
        <span class="c1"># we&#39;ll handle the off by 1 later with arange</span>
        <span class="n">istop</span> <span class="o">=</span> <span class="n">iminus1</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="n">double_minus1</span><span class="p">]</span>

        <span class="c1"># 2 fields after is the start position</span>
        <span class="c1"># add on a 0 to the beginning to account for the starting position</span>
        <span class="c1"># istart defines icol</span>
        <span class="n">istart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">istop</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>

        <span class="n">col_nids_short</span> <span class="o">=</span> <span class="n">temp_ints</span><span class="p">[</span><span class="n">istart</span><span class="p">]</span>
        <span class="n">col_dofs_short</span> <span class="o">=</span> <span class="n">temp_ints</span><span class="p">[</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#nj2 = len(istart)  ## TODO: why is this wrong???</span>

        <span class="n">row_nids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">row_dofs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">col_nids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">col_dofs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">imags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col_nidi</span><span class="p">,</span> <span class="n">col_dofi</span><span class="p">,</span> <span class="n">istarti</span><span class="p">,</span> <span class="n">istopi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="n">col_nids_short</span><span class="p">,</span> <span class="n">col_dofs_short</span><span class="p">,</span> <span class="n">istart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">istop</span><span class="p">):</span>

            <span class="c1">## TODO: preallocate arrays</span>
            <span class="n">imag</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># The float32/complex64 blocks are really simple</span>
            <span class="c1"># because we can just use the data is from the temp_ints block.</span>
            <span class="c1"># We calculate istart/istop and directly access the float data.</span>
            <span class="c1">#</span>
            <span class="c1"># The float64/complex128 blocks are more complicated.</span>
            <span class="c1"># It&#39;s easier to just use istart/istop to calculate datai</span>
            <span class="c1"># case that, and then slice it.</span>
            <span class="c1">#</span>
            <span class="c1"># In all cases, we use istart/istop to calculate row/col nid/dof</span>
            <span class="c1"># because they are always int32.  Only the real/imag types change.</span>
            <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;float32&#39;</span><span class="p">:</span>
                <span class="n">irow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">istarti</span><span class="p">,</span> <span class="n">istopi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
                <span class="n">real</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">irow</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;complex64&#39;</span><span class="p">:</span>
                <span class="n">irow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">istarti</span><span class="p">,</span> <span class="n">istopi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
                <span class="n">real</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">irow</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">imag</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">irow</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span>

            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;float64&#39;</span><span class="p">:</span>
                <span class="n">datai</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">48</span><span class="o">+</span><span class="p">(</span><span class="n">istarti</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span> <span class="p">:</span> <span class="mi">48</span><span class="o">+</span><span class="p">(</span><span class="n">istopi</span><span class="o">*</span><span class="mi">4</span><span class="p">)]</span>
                <span class="n">irow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">istarti</span><span class="p">,</span> <span class="n">istopi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">datai</span><span class="p">)</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">datai</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span>
                <span class="n">real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">datai</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">fdtype</span><span class="p">)[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="k">elif</span> <span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;complex128&#39;</span><span class="p">:</span>
                <span class="n">datai</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">48</span><span class="o">+</span><span class="p">(</span><span class="n">istarti</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span> <span class="p">:</span> <span class="mi">48</span><span class="o">+</span><span class="p">(</span><span class="n">istopi</span><span class="o">*</span><span class="mi">4</span><span class="p">)]</span>

                <span class="c1"># iword</span>
                <span class="c1"># -----</span>
                <span class="c1">#   0    1    3     5   &lt;---- iword</span>
                <span class="c1">#   1    1    2     2   &lt;---- nwords</span>
                <span class="c1"># (nid, dof, real, imag)</span>
                <span class="n">irow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">istarti</span><span class="p">,</span> <span class="n">istopi</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">datai</span><span class="p">)</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">datai</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span>
                <span class="n">floats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">datai</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">fdtype</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

                <span class="c1"># ndoubles</span>
                <span class="c1"># --------</span>
                <span class="c1">#  &lt;---0---&gt;   1     2    &lt;----- iword</span>
                <span class="c1">#      1       1     1    &lt;----- nwords</span>
                <span class="c1"># (nid, dof, real, imag)</span>
                <span class="n">real</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">imag</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="mi">2</span><span class="p">::</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is not supported&#39;</span> <span class="o">%</span> <span class="n">dtype</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">irow</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">real</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;nrow=</span><span class="si">%s</span><span class="s1"> nreal=</span><span class="si">%s</span><span class="s1"> nimag=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irow</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">real</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">imag</span><span class="p">))</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="c1"># the row index; [1, 2, ..., 43]</span>
            <span class="n">row_nid</span> <span class="o">=</span> <span class="n">temp_ints</span><span class="p">[</span><span class="n">irow</span><span class="p">]</span>

            <span class="c1"># the dof; [0, 0, ..., 0.]</span>
            <span class="n">row_dof</span> <span class="o">=</span> <span class="n">temp_ints</span><span class="p">[</span><span class="n">irow</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">urow_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">row_dof</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">udofi</span> <span class="ow">in</span> <span class="n">urow_dof</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">udofi</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;udofi=</span><span class="si">%s</span><span class="s1"> is invalid; must be in [0, 1, 2, 3, 4, 5, 6]; dofs=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">udofi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">urow_dof</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">ni</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">irow</span><span class="p">)</span>
            <span class="n">col_nid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">col_nidi</span>
            <span class="n">col_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">col_dofi</span>

            <span class="n">row_nids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_nid</span><span class="p">)</span>
            <span class="n">row_dofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_dof</span><span class="p">)</span>
            <span class="n">col_nids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_nid</span><span class="p">)</span>
            <span class="n">col_dofs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_dof</span><span class="p">)</span>
            <span class="n">reals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">real</span><span class="p">)</span>
            <span class="n">imags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imag</span><span class="p">)</span>

        <span class="n">row_nids_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">row_nids</span><span class="p">)</span>
        <span class="n">row_dofs_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">row_dofs</span><span class="p">)</span>

        <span class="n">col_nids_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">col_nids</span><span class="p">)</span>
        <span class="n">col_dofs_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">col_dofs</span><span class="p">)</span>
        <span class="n">real_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">reals</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_complex</span><span class="p">:</span>
            <span class="n">complex_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">imags</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_array</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">complex_array</span><span class="p">)</span>
            <span class="n">real_imag_array</span> <span class="o">=</span> <span class="n">real_array</span> <span class="o">+</span> <span class="mf">1.</span><span class="n">j</span> <span class="o">*</span> <span class="n">complex_array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">real_imag_array</span> <span class="o">=</span> <span class="n">real_array</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cast_matrix_matpool</span><span class="p">(</span><span class="n">utable_name</span><span class="p">,</span> <span class="n">real_imag_array</span><span class="p">,</span>
                                  <span class="n">col_nids_array</span><span class="p">,</span> <span class="n">col_dofs_array</span><span class="p">,</span>
                                  <span class="n">row_nids_array</span><span class="p">,</span> <span class="n">row_dofs_array</span><span class="p">,</span>
                                  <span class="n">matrix_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">is_symmetric</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cast_matrix_matpool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">real_imag_array</span><span class="p">,</span>
                             <span class="n">col_nids_array</span><span class="p">,</span> <span class="n">col_dofs_array</span><span class="p">,</span>
                             <span class="n">row_nids_array</span><span class="p">,</span> <span class="n">row_dofs_array</span><span class="p">,</span>
                             <span class="n">matrix_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">is_symmetric</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;helper method for _read_matpool_matrix&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">make_matrix_symmetric</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">apply_symmetry</span> <span class="ow">and</span> <span class="n">matrix_shape</span> <span class="o">==</span> <span class="s1">&#39;symmetric&#39;</span>

        <span class="c1"># TODO: this is way slower than it should be</span>
        <span class="c1">#       because we didn&#39;t preallocate the data and the</span>
        <span class="c1">#       grids_comp_array_to_index function needs work</span>
        <span class="n">grids1</span> <span class="o">=</span> <span class="n">col_nids_array</span>
        <span class="n">comps1</span> <span class="o">=</span> <span class="n">col_dofs_array</span>
        <span class="n">grids2</span> <span class="o">=</span> <span class="n">row_nids_array</span>
        <span class="n">comps2</span> <span class="o">=</span> <span class="n">row_dofs_array</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">grids1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps1</span><span class="p">),</span> <span class="s1">&#39;ngrids1=</span><span class="si">%s</span><span class="s1"> ncomps1=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grids1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps1</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">grids1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">grids2</span><span class="p">),</span> <span class="s1">&#39;ngrids1=</span><span class="si">%s</span><span class="s1"> ngrids2=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">grids1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">grids2</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps2</span><span class="p">),</span> <span class="s1">&#39;ncomps1=</span><span class="si">%s</span><span class="s1"> ncomps2=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comps1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps2</span><span class="p">))</span>

        <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">nj1</span><span class="p">,</span> <span class="n">nj2</span><span class="p">,</span> <span class="n">nj</span> <span class="o">=</span> <span class="n">grids_comp_array_to_index</span><span class="p">(</span>
            <span class="n">grids1</span><span class="p">,</span> <span class="n">comps1</span><span class="p">,</span> <span class="n">grids2</span><span class="p">,</span> <span class="n">comps2</span><span class="p">,</span> <span class="n">make_matrix_symmetric</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">j1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">j2</span><span class="p">),</span> <span class="s1">&#39;nj1=</span><span class="si">%s</span><span class="s1"> nj2=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">j2</span><span class="p">))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">grids1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_imag_array</span><span class="p">),</span> <span class="s1">&#39;ngrids1=</span><span class="si">%s</span><span class="s1"> nreals=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">j1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_imag_array</span><span class="p">))</span>

        <span class="c1"># not 100% on these, they might be flipped</span>
        <span class="c1">#ncols = len(np.unique(j1))</span>
        <span class="c1">#mrows = len(np.unique(j2))</span>

        <span class="k">if</span> <span class="n">is_symmetric</span><span class="p">:</span>
            <span class="n">mrows</span> <span class="o">=</span> <span class="n">nj</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">nj</span>
            <span class="c1">#print(&#39;  j1 =&#39;, j1)</span>
            <span class="c1">#print(&#39;  j2 =&#39;, j2)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">nj1</span>
            <span class="n">mrows</span> <span class="o">=</span> <span class="n">nj2</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span>
                <span class="p">(</span><span class="n">real_imag_array</span><span class="p">,</span> <span class="p">(</span><span class="n">j2</span><span class="p">,</span> <span class="n">j1</span><span class="p">)),</span>
                <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Passed all the checks; cannot build MATPOOL sparse matrix...</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">spaces</span> <span class="o">=</span> <span class="s1">&#39;                                          &#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">name=</span><span class="si">%s</span><span class="s1"> dtype=</span><span class="si">%s</span><span class="s1"> nrows=</span><span class="si">%s</span><span class="s1"> ncols=</span><span class="si">%s</span><span class="s1"> nj1=</span><span class="si">%s</span><span class="s1"> nj2=</span><span class="si">%s</span><span class="s1"> nj=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">spaces</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nj1</span><span class="p">,</span> <span class="n">nj2</span><span class="p">,</span> <span class="n">nj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">raise</span>


        <span class="c1"># enforce symmetry if necessary</span>
        <span class="k">if</span> <span class="n">make_matrix_symmetric</span><span class="p">:</span>
            <span class="c1"># get the upper and lower triangular matrices</span>
            <span class="n">upper_tri</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
            <span class="n">lower_tri</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>

            <span class="c1"># extracts a [1, 2, 3, ..., n] off the diagonal of the matrix</span>
            <span class="c1"># and make it a diagonal matrix</span>
            <span class="n">diagi</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">diagional</span><span class="p">(</span><span class="n">upper_tri</span><span class="p">))</span>

            <span class="c1"># Check to see which triangle is populated.</span>
            <span class="c1"># If they both are, make sure they&#39;re equal</span>
            <span class="c1"># or average them and throw a warning</span>
            <span class="n">lnnz</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower_tri</span> <span class="o">-</span> <span class="n">diagi</span><span class="p">)</span><span class="o">.</span><span class="n">nnz</span>
            <span class="n">unnz</span> <span class="o">=</span> <span class="p">(</span><span class="n">upper_tri</span> <span class="o">-</span> <span class="n">diagi</span><span class="p">)</span><span class="o">.</span><span class="n">nnz</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lnnz</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">lnnz</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unnz</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">unnz</span><span class="p">)</span>

            <span class="c1"># both upper and lower triangle are populated</span>
            <span class="k">if</span> <span class="n">lnnz</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">unnz</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">upper_tri_t</span> <span class="o">=</span> <span class="n">upper_tri</span><span class="o">.</span><span class="n">T</span>
                <span class="k">if</span> <span class="n">lower_tri</span> <span class="o">==</span> <span class="n">upper_tri_t</span><span class="p">:</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="n">upper_tri</span> <span class="o">+</span> <span class="n">upper_tri_t</span> <span class="o">-</span> <span class="n">diagi</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s1">&#39;Matrix </span><span class="si">%r</span><span class="s1"> marked as symmetric does not contain &#39;</span>
                        <span class="s1">&#39;symmetric data.  Data will be symmetrized by averaging.&#39;</span> <span class="o">%</span> <span class="n">table_name</span><span class="p">)</span>
                    <span class="n">matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">matrix</span> <span class="o">+</span> <span class="n">matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="k">elif</span> <span class="n">lnnz</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#  lower triangle is populated</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="n">lower_tri</span> <span class="o">+</span> <span class="n">lower_tri</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">diagi</span>
            <span class="k">elif</span> <span class="n">unnz</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#  upper triangle is populated</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="n">upper_tri</span> <span class="o">+</span> <span class="n">upper_tri_t</span> <span class="o">-</span> <span class="n">diagi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># matrix is diagonal (or null)</span>
                <span class="n">matrix</span> <span class="o">=</span> <span class="n">diagi</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">matrix</span>

            <span class="c1"># matrix is symmetric, but is not stored as symmetric</span>
            <span class="n">matrix_shape</span> <span class="o">=</span> <span class="s1">&#39;rectangular&#39;</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">is_matpool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">matrix_shape</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">matrix</span>
        <span class="n">m</span><span class="o">.</span><span class="n">col_nid</span> <span class="o">=</span> <span class="n">col_nids_array</span>
        <span class="n">m</span><span class="o">.</span><span class="n">col_dof</span> <span class="o">=</span> <span class="n">col_dofs_array</span>
        <span class="n">m</span><span class="o">.</span><span class="n">row_nid</span> <span class="o">=</span> <span class="n">row_nids_array</span>
        <span class="n">m</span><span class="o">.</span><span class="n">row_dof</span> <span class="o">=</span> <span class="n">row_dofs_array</span>
        <span class="n">m</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">matrix_shape</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">matrices</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;failed on _read_matpool_matrix&#39;</span><span class="p">)</span>

    <span class="c1">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_get_marker_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nmarkers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets N markers</span>

<span class="sd">        A marker is a flag that is used.  It&#39;s a series of 3 ints (4, n, 4)</span>
<span class="sd">        where n changes from marker to marker.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nmarkers : int</span>
<span class="sd">            the number of markers to read</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        markers : List[int, int, int]</span>
<span class="sd">            a list of nmarker integers</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">struc</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="s1">&#39;3i&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">unused_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmarkers</span><span class="p">):</span>
            <span class="n">block</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">marker</span> <span class="o">=</span> <span class="n">struc</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">markers</span>

<div class="viewcode-block" id="OP2Reader.get_nmarkers"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_nmarkers">[docs]</a>    <span class="k">def</span> <span class="nf">get_nmarkers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers4</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="n">rewind</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers8</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="n">rewind</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.get_nmarkers4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_nmarkers4">[docs]</a>    <span class="k">def</span> <span class="nf">get_nmarkers4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets n markers, so if n=2, it will get 2 markers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            number of markers to get</span>
<span class="sd">        rewind : bool</span>
<span class="sd">            should the file be returned to the starting point</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        markers : List[int]</span>
<span class="sd">            list of [1, 2, 3, ...] markers</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block4</span><span class="p">()</span>
            <span class="n">marker</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rewind</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">ni</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
            <span class="c1">#for i in range(n):</span>
                <span class="c1">#self.binary_debug.write(&#39;get_nmarkers- [4, %i, 4]; macro_rewind=%s\n&#39; % (</span>
                    <span class="c1">#i, macro_rewind or rewind))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#if not macro_rewind:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;get_nmarkers- [4, </span><span class="si">%i</span><span class="s1">, 4]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span> <span class="n">macro_rewind</span> <span class="ow">or</span> <span class="n">rewind</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">markers</span></div>

<div class="viewcode-block" id="OP2Reader.get_nmarkers8"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_nmarkers8">[docs]</a>    <span class="k">def</span> <span class="nf">get_nmarkers8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets n markers, so if n=2, it will get 2 markers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            number of markers to get</span>
<span class="sd">        rewind : bool</span>
<span class="sd">            should the file be returned to the starting point</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        markers : List[int]</span>
<span class="sd">            list of [1, 2, 3, ...] markers</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block8</span><span class="p">()</span>
            <span class="n">marker</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_q</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rewind</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">ni</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
            <span class="c1">#for i in range(n):</span>
                <span class="c1">#self.binary_debug.write(&#39;get_nmarkers- [4, %i, 4]; macro_rewind=%s\n&#39; % (</span>
                    <span class="c1">#i, macro_rewind or rewind))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#if not macro_rewind:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;get_nmarkers- [8, </span><span class="si">%i</span><span class="s1">, 8]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">i</span><span class="p">,</span> <span class="n">macro_rewind</span> <span class="ow">or</span> <span class="n">rewind</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">markers</span></div>

<div class="viewcode-block" id="OP2Reader.read_markers"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_markers">[docs]</a>    <span class="k">def</span> <span class="nf">read_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_markers4</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_markers8</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.read_markers4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_markers4">[docs]</a>    <span class="k">def</span> <span class="nf">read_markers4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets specified markers, where a marker has the form of [4, value, 4].</span>
<span class="sd">        The &quot;marker&quot; corresponds to the value, so 3 markers takes up 9 integers.</span>
<span class="sd">        These are used to indicate position in the file as well as the number</span>
<span class="sd">        of bytes to read.</span>

<span class="sd">        Because we&#39;re checking the markers vs. what we expect, we just throw</span>
<span class="sd">        the data away.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        markers : List[int]</span>
<span class="sd">            markers to get; markers = [-10, 1]</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FortranMarkerError</span>
<span class="sd">            if the expected table number is not found</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">markers</span><span class="p">):</span>
            <span class="c1">#self.log.debug(&#39;markers[%i] = %s&#39; % (i, marker))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block4</span><span class="p">()</span>
            <span class="n">imarker</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">marker</span> <span class="o">!=</span> <span class="n">imarker</span><span class="p">:</span>
                <span class="c1">#self.show_data(data)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;marker=</span><span class="si">%r</span><span class="s1"> imarker=</span><span class="si">%r</span><span class="s1">; markers=</span><span class="si">%s</span><span class="s1">; i=</span><span class="si">%s</span><span class="s1">; table_name=</span><span class="si">%r</span><span class="s1">; iloc=</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">marker</span><span class="p">,</span> <span class="n">imarker</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span>
                    <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">op2_filename</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">FortranMarkerError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  read_markers -&gt; [4, </span><span class="si">%i</span><span class="s1">, 4]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">marker</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.read_markers8"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_markers8">[docs]</a>    <span class="k">def</span> <span class="nf">read_markers8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets specified markers, where a marker has the form of [4, value, 4].</span>
<span class="sd">        The &quot;marker&quot; corresponds to the value, so 3 markers takes up 9 integers.</span>
<span class="sd">        These are used to indicate position in the file as well as the number</span>
<span class="sd">        of bytes to read.</span>

<span class="sd">        Because we&#39;re checking the markers vs. what we expect, we just throw</span>
<span class="sd">        the data away.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        markers : List[int]</span>
<span class="sd">            markers to get; markers = [-10, 1]</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FortranMarkerError</span>
<span class="sd">            if the expected table number is not found</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">markers</span><span class="p">):</span>
            <span class="c1">#self.log.debug(&#39;markers[%i] = %s&#39; % (i, marker))</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block8</span><span class="p">()</span>
            <span class="n">imarker</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_q</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">marker</span> <span class="o">!=</span> <span class="n">imarker</span><span class="p">:</span>
                <span class="c1">#self.show_data(data)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;marker=</span><span class="si">%r</span><span class="s1"> imarker=</span><span class="si">%r</span><span class="s1">; markers=</span><span class="si">%s</span><span class="s1">; i=</span><span class="si">%s</span><span class="s1">; table_name=</span><span class="si">%r</span><span class="s1">; iloc=</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">marker</span><span class="p">,</span> <span class="n">imarker</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span>
                    <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">op2_filename</span><span class="p">))</span>
                <span class="k">raise</span> <span class="n">FortranMarkerError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  read_markers -&gt; [8, </span><span class="si">%i</span><span class="s1">, 8]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">marker</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_skip_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;bypasses the next table as quickly as possible&quot;&quot;&quot;</span>
        <span class="c1">#if table_name in [&#39;DIT&#39;, &#39;DITS&#39;]:  # tables</span>
            <span class="c1">#self._read_dit()</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PCOMPTS&#39;</span><span class="p">,</span> <span class="s1">&#39;PCOMPTS&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_pcompts</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_skip_table_helper</span><span class="p">(</span><span class="n">warn</span><span class="o">=</span><span class="n">warn</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_month</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the self.date attribute from the 2-digit year.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        month : int</span>
<span class="sd">            the month (integer &lt;= 12)</span>
<span class="sd">        day :  int</span>
<span class="sd">            the day (integer &lt;= 31)</span>
<span class="sd">        year : int</span>
<span class="sd">            the day (integer &lt;= 99)</span>
<span class="sd">        zero : int</span>
<span class="sd">            a dummy integer (???)</span>
<span class="sd">        one : int</span>
<span class="sd">            a dummy integer (???)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="c1"># would you believe they changed the date format?</span>
            <span class="n">month</span><span class="p">,</span> <span class="n">day</span> <span class="o">=</span> <span class="n">day</span><span class="p">,</span> <span class="n">month</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">+=</span> <span class="mi">2000</span>
        <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_op2_date</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>

        <span class="c1">#self.log.debug(&quot;%s/%s/%4i zero=%s one=%s&quot; % (month, day, year, zero, one))</span>
        <span class="c1">#if self.is_debug_file:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  [subtable_name, month=</span><span class="si">%i</span><span class="s1">, day=</span><span class="si">%i</span><span class="s1">, year=</span><span class="si">%i</span><span class="s1">, &#39;</span>
                                    <span class="s1">&#39;zero=</span><span class="si">%i</span><span class="s1">, one=</span><span class="si">%i</span><span class="s1">]</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">))</span>
        <span class="c1">#assert zero == 0, zero  # is this the RTABLE indicator???</span>
        <span class="k">assert</span> <span class="n">one</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">one</span>  <span class="c1"># 0, 50</span>

    <span class="k">def</span> <span class="nf">_set_op2_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets the date the job was run&quot;&quot;&quot;</span>
        <span class="n">date</span> <span class="o">=</span> <span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="k">return</span> <span class="n">date</span>

    <span class="c1">#----------------------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_read_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a record.</span>

<span class="sd">        A record is defined N blocks.  Blocks are split every 2^12 bytes,</span>
<span class="sd">        which is an oddity of the OP2, which is a &quot;Fortran formatted&quot; file.</span>
<span class="sd">        You can think of a block as a partial result.  A record is a full</span>
<span class="sd">        result.</span>

<span class="sd">        If a block is small enough, it will fit into 2^12 bytes and a record</span>
<span class="sd">        is a block.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata4</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata8</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_read_record_ndata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata4</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata8</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_record_ndata4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;reads a record and the length of the record&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">markers0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers4</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - marker = [4, </span><span class="si">%i</span><span class="s1">, 4]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">markers0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">macro_rewind</span><span class="p">))</span>
        <span class="n">record</span><span class="p">,</span> <span class="n">nrecord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_block_ndata4</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;read_record - record = [</span><span class="si">%i</span><span class="s1">, recordi, </span><span class="si">%i</span><span class="s1">]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">nrecord</span><span class="p">,</span> <span class="n">nrecord</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markers0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FortranMarkerError</span><span class="p">(</span><span class="s1">&#39;markers0=</span><span class="si">%s</span><span class="s1">*4 len(record)=</span><span class="si">%s</span><span class="s1">; table_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">markers0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">))</span>

        <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers4</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#nloop = 0</span>
            <span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="n">record</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - markers1 = [4, </span><span class="si">%i</span><span class="s1">, 4]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">recordi</span><span class="p">,</span> <span class="n">nrecordi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_block_ndata</span><span class="p">()</span>
                <span class="n">nrecord</span> <span class="o">+=</span> <span class="n">nrecordi</span>
                <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recordi</span><span class="p">)</span>
                <span class="c1">#record += recordi</span>
                <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - markers1 = [4, </span><span class="si">%i</span><span class="s1">, 4]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1">#nloop += 1</span>

            <span class="c1"># if nloop == 0:</span>
                <span class="c1"># record = records[0]</span>
            <span class="c1"># elif nloop == 1:</span>
                <span class="c1"># record = records[0] + records[1]</span>
            <span class="c1"># else:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">record</span><span class="p">,</span> <span class="n">nrecord</span>

    <span class="k">def</span> <span class="nf">_read_record_ndata8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;reads a record and the length of the record&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">markers0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers8</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - marker = [8, </span><span class="si">%i</span><span class="s1">, 8]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">markers0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">macro_rewind</span><span class="p">))</span>
        <span class="n">record</span><span class="p">,</span> <span class="n">nrecord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_block_ndata8</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;read_record - record = [</span><span class="si">%i</span><span class="s1">, recordi, </span><span class="si">%i</span><span class="s1">]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">nrecord</span><span class="p">,</span> <span class="n">nrecord</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markers0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifsqd&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FortranMarkerError</span><span class="p">(</span><span class="s1">&#39;markers0=</span><span class="si">%s</span><span class="s1">*8 len(record)=</span><span class="si">%s</span><span class="s1">; table_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">markers0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="p">),</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">))</span>

        <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers8</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1">#nloop = 0</span>
            <span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="n">record</span><span class="p">]</span>
            <span class="k">while</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers8</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - markers1 = [8, </span><span class="si">%i</span><span class="s1">, 8]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">recordi</span><span class="p">,</span> <span class="n">nrecordi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_block_ndata8</span><span class="p">()</span>
                <span class="n">nrecord</span> <span class="o">+=</span> <span class="n">nrecordi</span>
                <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recordi</span><span class="p">)</span>
                <span class="c1">#record += recordi</span>
                <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers8</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - markers1 = [8, </span><span class="si">%i</span><span class="s1">, 8]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="c1">#nloop += 1</span>

            <span class="c1"># if nloop == 0:</span>
                <span class="c1"># record = records[0]</span>
            <span class="c1"># elif nloop == 1:</span>
                <span class="c1"># record = records[0] + records[1]</span>
            <span class="c1"># else:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">record</span><span class="p">,</span> <span class="n">nrecord</span>

    <span class="k">def</span> <span class="nf">_read_block_ndata4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a block following a pattern of:</span>
<span class="sd">            [nbytes, data, nbytes]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : bytes</span>
<span class="sd">            the data in binary</span>
<span class="sd">        ndata : int</span>
<span class="sd">            len(data)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ndata</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">data_out</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">ndata</span>
        <span class="k">return</span> <span class="n">data_out</span><span class="p">,</span> <span class="n">ndata</span>

    <span class="k">def</span> <span class="nf">_read_block_ndata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_block_ndata4</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_block_ndata8</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_read_block_ndata8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ndata</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">data_out</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">ndata</span>
        <span class="k">return</span> <span class="n">data_out</span><span class="p">,</span> <span class="n">ndata</span>
    <span class="c1">#------------------------------------------------------------------</span>
<div class="viewcode-block" id="OP2Reader.unpack_table_name"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.unpack_table_name">[docs]</a>    <span class="k">def</span> <span class="nf">unpack_table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_table_name4</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_table_name8</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.unpack_table_name4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.unpack_table_name4">[docs]</a>    <span class="k">def</span> <span class="nf">unpack_table_name4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;table names can apparently be 8 or 32 characters&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="c1"># &#39;GEOM4   &#39;</span>
            <span class="n">structi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span>
            <span class="n">table_name</span><span class="p">,</span> <span class="o">=</span> <span class="n">structi</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
            <span class="c1"># &#39;GEOM1   20140   0   _y\xfe\xffGEOM1   &#39;</span>
            <span class="c1"># [&#39;GEOM1   &#39;, &#39;20140   &#39;, &#39;0   &#39;, -10000, &#39; GEOM1   &#39;]</span>
            <span class="n">structi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span>
            <span class="n">table_name</span><span class="p">,</span> <span class="o">=</span> <span class="n">structi</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;data=</span><span class="si">{</span><span class="n">data</span><span class="si">!r}</span><span class="s1">; n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="OP2Reader.unpack_table_name8"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.unpack_table_name8">[docs]</a>    <span class="k">def</span> <span class="nf">unpack_table_name8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;table names can apparently be 8 or 32 characters&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="c1"># &#39;GEOM4   &#39;</span>
            <span class="n">structi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span>
            <span class="n">table_name</span><span class="p">,</span> <span class="o">=</span> <span class="n">structi</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
            <span class="c1"># &#39;GEOM4   &#39;</span>
            <span class="c1">#b&#39;PVT0            &#39;</span>
            <span class="n">structi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_16s</span>
            <span class="n">table_name</span><span class="p">,</span> <span class="o">=</span> <span class="n">structi</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1">#elif len(data) == 32:</span>
            <span class="c1"># &#39;GEOM1   20140   0   _y\xfe\xffGEOM1   &#39;</span>
            <span class="c1"># [&#39;GEOM1   &#39;, &#39;20140   &#39;, &#39;0   &#39;, -10000, &#39; GEOM1   &#39;]</span>
            <span class="c1">#structi = self.op2.struct_8s</span>
            <span class="c1">#table_name, = structi.unpack(data[:8])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;data=</span><span class="si">{</span><span class="n">data</span><span class="si">!r}</span><span class="s1">; n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">table_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_read_table_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_table_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">rewind</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">stop_on_failure</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the next OP2 table name (e.g. OUG1, OES1X1)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        last_table_name : bytes; default=Noen</span>
<span class="sd">            the last table name</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        table_name : bytes</span>
<span class="sd">            the table name</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">table_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;_read_table_name - rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rewind</span><span class="p">)</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
        <span class="k">if</span> <span class="n">stop_on_failure</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">rewind</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_table_name</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rewind</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;marker = [4, 2, 4]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;table_header = [8, </span><span class="si">%r</span><span class="s1">, 8]</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">table_name</span><span class="p">)</span>
            <span class="n">table_name</span> <span class="o">=</span> <span class="n">table_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">(</span><span class="n">macro_rewind</span><span class="o">=</span><span class="n">rewind</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unpack_table_name</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">MemoryError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">except</span><span class="p">:</span> <span class="c1"># struct_error:</span>
                <span class="c1"># we&#39;re done reading</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">ni</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># we have a trailing 0 marker</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">rewind</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span> <span class="c1">#struct_error:</span>
                    <span class="c1"># if we hit this block, we have a FATAL error</span>
                    <span class="n">is_special_nastran</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;imat&#39;</span><span class="p">,</span> <span class="s1">&#39;autodesk&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_special_nastran</span> <span class="ow">and</span> <span class="n">op2</span><span class="o">.</span><span class="n">post</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">4</span><span class="p">:</span>
                        <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">last_table_name</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;finished table_name = </span><span class="si">{</span><span class="n">last_table_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="k">raise</span> <span class="n">FatalError</span><span class="p">(</span><span class="s1">&#39;There was a Nastran FATAL Error.  Check the F06.</span><span class="se">\n</span><span class="s1">&#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;last table=</span><span class="si">{</span><span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="si">!r}</span><span class="s1">; post=</span><span class="si">{</span><span class="n">op2</span><span class="o">.</span><span class="n">post</span><span class="si">}</span><span class="s1"> &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;version=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">_nastran_format</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">table_name</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># we&#39;re done reading, so we&#39;re going to ignore the rewind</span>
                <span class="n">rewind</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">rewind</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">ni</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">table_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;table_name=</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s1">; n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="c1">#if self.size == 8:</span>
            <span class="c1">#print(table_name)</span>
        <span class="k">return</span> <span class="n">table_name</span>

<div class="viewcode-block" id="OP2Reader.read_block"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_block">[docs]</a>    <span class="k">def</span> <span class="nf">read_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block4</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block8</span><span class="p">()</span></div>

<div class="viewcode-block" id="OP2Reader.read_string_block"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_string_block">[docs]</a>    <span class="k">def</span> <span class="nf">read_string_block</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">block</span>
        <span class="k">return</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">block</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.read_block4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_block4">[docs]</a>    <span class="k">def</span> <span class="nf">read_block4</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a block following a pattern of:</span>
<span class="sd">            [nbytes, data, nbytes]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : bytes</span>
<span class="sd">            the data in binary</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        see read_3_blocks</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ndata</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">data_out</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">ndata</span>
        <span class="k">return</span> <span class="n">data_out</span></div>

<div class="viewcode-block" id="OP2Reader.read_block8"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_block8">[docs]</a>    <span class="k">def</span> <span class="nf">read_block8</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a block following a pattern of:</span>
<span class="sd">            [nbytes, data, nbytes]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : bytes</span>
<span class="sd">            the data in binary</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        see read_3_blocks</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ndata</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">ndata</span>
        <span class="k">return</span> <span class="n">data_out</span></div>

<div class="viewcode-block" id="OP2Reader.read_3_blocks4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_3_blocks4">[docs]</a>    <span class="k">def</span> <span class="nf">read_3_blocks4</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a block following a pattern of:</span>
<span class="sd">            [nbytes, data, nbytes]</span>
<span class="sd">            [nbytes, data, nbytes]</span>
<span class="sd">            [nbytes, data, nbytes]</span>

<span class="sd">        This is intended to be used for reading marker triples</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data : bytes</span>
<span class="sd">            the data in binary</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">data_out</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">unused_i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">ndata</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">data_out</span> <span class="o">+=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">ndata</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">ndata</span>
        <span class="k">return</span> <span class="n">data_out</span></div>

<div class="viewcode-block" id="OP2Reader.read_3_markers"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_3_markers">[docs]</a>    <span class="k">def</span> <span class="nf">read_3_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Micro-optimizes ``read_markers`` for 3 markers.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers4</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_markers8</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.read_3_markers4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_3_markers4">[docs]</a>    <span class="k">def</span> <span class="nf">read_3_markers4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Micro-optimizes ``read_markers`` for 3 markers.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        markers : List[int, int, int]</span>
<span class="sd">            markers to get; markers = [-10, 1, 0]</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        FortranMarkerError</span>
<span class="sd">            if the expected table number is not found</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#data1 = self.read_block4()</span>
        <span class="c1">#data2 = self.read_block4()</span>
        <span class="c1">#data3 = self.read_block4()</span>
        <span class="c1">#data = data1 + data2 + data3</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_3_blocks4</span><span class="p">()</span>
        <span class="n">markers_actual</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_3i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">imarker</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">marker_actual</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">(),</span> <span class="n">markers</span><span class="p">,</span> <span class="n">markers_actual</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">marker</span> <span class="o">!=</span> <span class="n">marker_actual</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FortranMarkerError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;imarker=</span><span class="si">{</span><span class="n">imarker</span><span class="si">}</span><span class="s1">; markers=</span><span class="si">{</span><span class="n">markers</span><span class="si">}</span><span class="s1">; &#39;</span>
                                         <span class="sa">f</span><span class="s1">&#39;marker_actual=</span><span class="si">{</span><span class="n">markers_actual</span><span class="si">}</span><span class="s1"> table_name=</span><span class="si">{</span><span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  read_markers -&gt; [4, </span><span class="si">%i</span><span class="s1">, 4]</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">marker</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.get_marker1"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_marker1">[docs]</a>    <span class="k">def</span> <span class="nf">get_marker1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_4</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="n">rewind</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_8</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="n">rewind</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.get_marker1_4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_marker1_4">[docs]</a>    <span class="k">def</span> <span class="nf">get_marker1_4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets 1 marker</span>
<span class="sd">        See get_n_markers(...)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rewind : bool</span>
<span class="sd">            should the file be returned to the starting point</span>
<span class="sd">        macro_rewind : bool</span>
<span class="sd">            ???</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        markers : int</span>
<span class="sd">            a single marker</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block4</span><span class="p">()</span>
        <span class="n">marker</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rewind</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">ni</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;get_marker - [4, </span><span class="si">%i</span><span class="s1">, 4]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">marker</span><span class="p">,</span> <span class="n">macro_rewind</span> <span class="ow">or</span> <span class="n">rewind</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">marker</span></div>

<div class="viewcode-block" id="OP2Reader.get_marker1_8"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_marker1_8">[docs]</a>    <span class="k">def</span> <span class="nf">get_marker1_8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets 1 marker</span>
<span class="sd">        See get_n_markers(...)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rewind : bool</span>
<span class="sd">            should the file be returned to the starting point</span>
<span class="sd">        macro_rewind : bool</span>
<span class="sd">            ???</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        markers : int</span>
<span class="sd">            a single marker</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">ni</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_block8</span><span class="p">()</span>
        <span class="n">marker</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_q</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rewind</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">ni</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;get_marker - [8, </span><span class="si">%i</span><span class="s1">, 8]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">marker</span><span class="p">,</span> <span class="n">macro_rewind</span> <span class="ow">or</span> <span class="n">rewind</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">marker</span></div>

    <span class="c1">#------------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_debug_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;interface to the op2 object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">is_debug_file</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">binary_debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;interface to the op2 object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">binary_debug</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;interface to the op2 object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">log</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_endian</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;interface to the op2 object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">_endian</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_uendian</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;interface to the op2 object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">_uendian</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;interface to the op2 object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">_encoding</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">read_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;interface to the op2 object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">read_mode</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">debug_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;interface to the op2 object&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">debug_file</span>

    <span class="c1">#------------------------------------------------------------------</span>
    <span class="c1"># skip methods</span>

<span class="c1">#class OP2Skip:</span>
    <span class="c1">#def __init__(self, op2):</span>
        <span class="c1">#self.op2 = op2</span>

    <span class="c1">#@property</span>
    <span class="c1">#def is_debug_file(self):</span>
        <span class="c1">#return self.op2.is_debug_file</span>

    <span class="c1">#@property</span>
    <span class="c1">#def binary_debug(self):</span>
        <span class="c1">#return self.op2.binary_debug</span>

    <span class="c1">#@property</span>
    <span class="c1">#def log(self):</span>
        <span class="c1">#return self.op2.log</span>

    <span class="k">def</span> <span class="nf">_skip_table_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Skips the majority of geometry/result tables as they follow a very standard format.</span>
<span class="sd">        Other tables don&#39;t follow this format.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;skipping table...</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">warn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;    skipping table_helper = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_skip_subtables</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_skip_subtables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;skips a set of subtables&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">unused_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;skipping table_name = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
            <span class="c1">#if len(data) == 584:</span>
                <span class="c1">#self._parse_results_table3(data)</span>
            <span class="c1">#else:</span>
                <span class="c1">#data = self._parse_results_table4(data)</span>

            <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_skip_record</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the skip version of ``_read_record``</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        record : None</span>
<span class="sd">            a record of None indicates a skipped block</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unused_markers0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block</span><span class="p">()</span>

        <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># handling continuation blocks</span>
        <span class="k">while</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block</span><span class="p">()</span>
            <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">record</span>

    <span class="k">def</span> <span class="nf">_skip_record_ndata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record_ndata4</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record_ndata8</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_skip_record_ndata4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the skip version of ``_read_record_ndata``&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">marker0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_4</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - marker = [4, </span><span class="si">%i</span><span class="s1">, 4]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">marker0</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="p">))</span>
        <span class="n">record</span><span class="p">,</span> <span class="n">nrecord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block_ndata</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - record = [</span><span class="si">%i</span><span class="s1">, recordi, </span><span class="si">%i</span><span class="s1">]; &#39;</span>
                                    <span class="s1">&#39;macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrecord</span><span class="p">,</span> <span class="n">nrecord</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">marker0</span><span class="o">*</span><span class="mi">4</span> <span class="o">!=</span> <span class="n">nrecord</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;marker0=</span><span class="si">%s</span><span class="s1">*4 len(record)=</span><span class="si">%s</span><span class="s1">; table_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">marker0</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">nrecord</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FortranMarkerError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">marker1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_4</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">marker1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">marker1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">marker1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_4</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;read_record - marker1 = [4, </span><span class="si">{</span><span class="n">marker1</span><span class="si">}</span><span class="s1">, 4]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">unused_recordi</span><span class="p">,</span> <span class="n">nrecordi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block_ndata</span><span class="p">()</span>
                <span class="n">nrecord</span> <span class="o">+=</span> <span class="n">nrecordi</span>

                <span class="n">marker1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_4</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;read_record - marker1 = [4, </span><span class="si">{</span><span class="n">marker1</span><span class="si">}</span><span class="s1">, 4]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">record</span><span class="p">,</span> <span class="n">nrecord</span>

    <span class="k">def</span> <span class="nf">_skip_record_ndata8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the skip version of ``_read_record_ndata``&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">marker0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_8</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="o">=</span><span class="n">macro_rewind</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - marker = [8, </span><span class="si">%i</span><span class="s1">, 8]; macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">marker0</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="p">))</span>
        <span class="n">record</span><span class="p">,</span> <span class="n">nrecord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block_ndata</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_record - record = [</span><span class="si">%i</span><span class="s1">, recordi, </span><span class="si">%i</span><span class="s1">]; &#39;</span>
                                    <span class="s1">&#39;macro_rewind=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nrecord</span><span class="p">,</span> <span class="n">nrecord</span><span class="p">,</span> <span class="n">macro_rewind</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">marker0</span><span class="o">*</span><span class="mi">8</span> <span class="o">!=</span> <span class="n">nrecord</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;marker0=</span><span class="si">%s</span><span class="s1">*8 len(record)=</span><span class="si">%s</span><span class="s1">; table_name=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">marker0</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span> <span class="n">nrecord</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">FortranMarkerError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">marker1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_8</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">marker1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">marker1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">marker1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_8</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;read_record - marker1 = [8, </span><span class="si">{</span><span class="n">marker1</span><span class="si">}</span><span class="s1">, 8]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">unused_recordi</span><span class="p">,</span> <span class="n">nrecordi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block_ndata</span><span class="p">()</span>
                <span class="n">nrecord</span> <span class="o">+=</span> <span class="n">nrecordi</span>

                <span class="n">marker1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker1_8</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span> <span class="ow">and</span> <span class="n">debug</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;read_record - marker1 = [8, </span><span class="si">{</span><span class="n">marker1</span><span class="si">}</span><span class="s1">, 8]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">record</span><span class="p">,</span> <span class="n">nrecord</span>

    <span class="k">def</span> <span class="nf">_get_record_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The record length helps us figure out data block size, which is used</span>
<span class="sd">        to quickly size the arrays.  We just need a bit of meta data and can</span>
<span class="sd">        jump around quickly.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        record_length : int</span>
<span class="sd">            the length of the data block</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;_get_record_length</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">len_record</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n0</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
        <span class="n">markers0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  markers0=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers0</span><span class="p">)</span>

        <span class="n">n</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
        <span class="n">unused_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block</span><span class="p">()</span>
        <span class="n">len_record</span> <span class="o">+=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">8</span>  <span class="c1"># -8 is for the block</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  len_record=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">len_record</span><span class="p">)</span>

        <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># handling continuation blocks</span>
        <span class="k">while</span> <span class="n">markers1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  markers1=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers1</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
            <span class="n">unused_record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block</span><span class="p">()</span>
            <span class="n">len_record</span> <span class="o">+=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">8</span>  <span class="c1"># -8 is for the block</span>
            <span class="n">markers1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_goto</span><span class="p">(</span><span class="n">n0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">len_record</span>

    <span class="k">def</span> <span class="nf">_skip_block</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Skips a block following a pattern of:</span>
<span class="sd">            [nbytes, data, nbytes]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data :  since data can never be None, a None value</span>
<span class="sd">                indicates something bad happened.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_block_ndata</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_skip_block_ndata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Skips a block following a pattern of:</span>
<span class="sd">            [nbytes, data, nbytes]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data :  since data can never be None, a None value</span>
<span class="sd">                indicates something bad happened.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">ndata</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_i</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">ndata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_goto</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ndata</span>

    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_goto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Jumps to position n in the file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            the position to goto</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<div class="viewcode-block" id="OP2Reader.is_valid_subcase"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.is_valid_subcase">[docs]</a>    <span class="k">def</span> <span class="nf">is_valid_subcase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lets the code check whether or not to read a subcase</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        is_valid : bool</span>
<span class="sd">            should this subcase defined by self.isubcase be read?</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op2</span><span class="o">.</span><span class="n">is_all_subcases</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="s1">&#39;isubcase&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">op2</span><span class="o">.</span><span class="n">isubcase</span> <span class="ow">in</span> <span class="n">op2</span><span class="o">.</span><span class="n">valid_subcases</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="OP2Reader.read_results_table"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_results_table">[docs]</a>    <span class="k">def</span> <span class="nf">read_results_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a results table&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_results_table4</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_results_table8</span><span class="p">()</span></div>

<div class="viewcode-block" id="OP2Reader.read_results_table4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_results_table4">[docs]</a>    <span class="k">def</span> <span class="nf">read_results_table4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a results table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_results_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1">#self.binary_debug.write(&#39;marker = [4, -1, 4]\n&#39;)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-2, 1, 0]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata4</span><span class="p">()</span>

        <span class="n">subtable_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subtable_name4</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_subtables</span><span class="p">()</span></div>

<div class="viewcode-block" id="OP2Reader.read_results_table8"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_results_table8">[docs]</a>    <span class="k">def</span> <span class="nf">read_results_table8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a results table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_results_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers8</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-1]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1">#self.binary_debug.write(&#39;marker = [4, -1, 4]\n&#39;)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers8</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-2, 1, 0]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata8</span><span class="p">()</span>

        <span class="n">subtable_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subtable_name8</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)</span>
        <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">subtable_name</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_subtables</span><span class="p">()</span></div>

<div class="viewcode-block" id="OP2Reader.get_subtable_name8"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_subtable_name8">[docs]</a>    <span class="k">def</span> <span class="nf">get_subtable_name8</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">ndata</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span> <span class="c1"># 8*2</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_16s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">subtable_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span> <span class="c1"># 16*2</span>
            <span class="c1">#(name1, name2, 170, 170)</span>
            <span class="n">subtable_name</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_16s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">16</span><span class="p">])</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">subtable_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">subtable_name</span><span class="p">)</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">subtable_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">56</span><span class="p">:</span> <span class="c1"># 28*2</span>
            <span class="n">subtable_name</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;16s5q&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">subtable_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="p">(</span>
                    <span class="n">subtable_name</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_month</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;ifsqd&#39;</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">subtable_name</span></div>

<div class="viewcode-block" id="OP2Reader.get_subtable_name4"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.get_subtable_name4">[docs]</a>    <span class="k">def</span> <span class="nf">get_subtable_name4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">ndata</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">subtable_name</span><span class="p">,</span> <span class="n">unused_ten</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8si&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>  <span class="c1"># type: Tuple[bytes, int]</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>
            <span class="c1">#assert ten == 10, self.show_data(data, types=&#39;ifs&#39;, endian=None)</span>
            <span class="k">assert</span> <span class="n">subtable_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;GPL&#39;</span><span class="p">,</span> <span class="s1">&#39;GPLS&#39;</span><span class="p">],</span> <span class="n">subtable_name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
            <span class="n">subtable_name</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s5i&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  recordi = [</span><span class="si">%r</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">, </span><span class="si">%i</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span>  <span class="o">%</span> <span class="p">(</span>
                    <span class="n">subtable_name</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;  subtable_name=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_print_month</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">612</span><span class="p">:</span> <span class="c1"># ???</span>
            <span class="n">strings</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(data) = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ndata</span>
            <span class="c1">#msg += &#39;strings  = %r\n&#39; % strings</span>
            <span class="c1">#msg += &#39;ints     = %r\n&#39; % str(ints)</span>
            <span class="c1">#msg += &#39;floats   = %r&#39; % str(floats)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">subtable_name</span><span class="p">,</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;subtable_name = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">subtable_name</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">24</span> <span class="ow">and</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;ICASE&#39;</span><span class="p">:</span>
            <span class="n">subtable_name</span> <span class="o">=</span> <span class="s1">&#39;CASE CONTROL SECTION&#39;</span>
            <span class="c1">#strings = &#39;CASE CONTROL SECTION\xff\xff\xff\xff&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strings</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(data) = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ndata</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;strings  = </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">strings</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;ints     = </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;floats   = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">floats</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;subtable_name&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;the file hasnt been cleaned up; subtable_name_old=</span><span class="si">%s</span><span class="s1"> new=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">subtable_name</span><span class="p">,</span> <span class="n">subtable_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">subtable_name</span></div>

<div class="viewcode-block" id="OP2Reader.generic_stop_table"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.generic_stop_table">[docs]</a>    <span class="k">def</span> <span class="nf">generic_stop_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="sd">&quot;&quot;&quot;print table data when things get weird&quot;&quot;&quot;</span>
        <span class="n">strings</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Unhandled table length error</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;table_name = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">table_name</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;len(data) = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ndata</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;strings  = </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">strings</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;ints     = </span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;floats   = </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">floats</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="OP2Reader.read_geom_table"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.read_geom_table">[docs]</a>    <span class="k">def</span> <span class="nf">read_geom_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads a geometry table&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_table_name</span><span class="p">(</span><span class="n">rewind</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read_geom_table - </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">()</span> <span class="c1"># length=28</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">subtable_name</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_8s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">28</span><span class="p">:</span>
                <span class="c1"># date = august 2, 2019</span>
                <span class="c1">#(b&#39;OGPFB1  &#39;, 8, 2, 19, 0, 1)</span>
                <span class="c1">#(b&#39;OGPFB1  &#39;, 8, 2, 19, 1, 1)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endian</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;8s 3i 2i&#39;</span>
                <span class="n">subtable_name</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span> <span class="o">=</span> <span class="n">Struct</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">zero</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">one</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  subtable_name=</span><span class="si">{</span><span class="n">subtable_name</span><span class="si">}</span><span class="s1"> possible error; zero=</span><span class="si">{</span><span class="n">zero</span><span class="si">}</span><span class="s1"> one=</span><span class="si">{</span><span class="n">one</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="c1">#self.generic_stop_table(data, ndata)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_op2_date</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generic_stop_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ndata</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
                <span class="n">subtable_name</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">struct_16s</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generic_stop_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">subtable_name</span> <span class="o">=</span> <span class="n">subtable_name</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_subtables</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_read_subtables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;reads a series of subtables&quot;&quot;&quot;</span>
        <span class="c1"># this parameters is used for numpy streaming</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">_table4_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">is_table_1</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">_data_factor</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1">#nstart = op2.n</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;***isubtable = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---markers = [-3, 1, 0]---</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># get the parsing functions (table3_parser, table4_parser)</span>
        <span class="c1"># or find out we&#39;re going to be skipping the tables</span>
        <span class="c1">#</span>
        <span class="c1"># table3 - the table with the meta data (e.g. subcase_id, time, is_stress/strain)</span>
        <span class="c1"># table4 - the actual results data</span>
        <span class="c1">#</span>
        <span class="c1"># we indicate table3/4 by isubtable, which starts from -3 (so table3) and counts</span>
        <span class="c1"># down (yes down) to 4 to indicate table4.  If we count down again, we end up</span>
        <span class="c1"># back at table 3 (with isubtable=-5), which will occur in the case of multiple</span>
        <span class="c1"># times/element types/results in a single macro table (e.g. OUG, OES).</span>
        <span class="n">table_mapper</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">_get_table_mapper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="ow">in</span> <span class="n">table_mapper</span><span class="p">:</span>
            <span class="c1">#if self.read_mode == 2:</span>
                <span class="c1">#self.log.debug(&quot;table_name = %r&quot; % op2.table_name)</span>

            <span class="n">table3_parser</span><span class="p">,</span> <span class="n">table4_parser</span> <span class="o">=</span> <span class="n">table_mapper</span><span class="p">[</span><span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">]</span>
            <span class="n">passer</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;skipping table_name = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>
                    <span class="c1">#raise NotImplementedError(op2.table_name)</span>
            <span class="n">table3_parser</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">table4_parser</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">passer</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># we need to check the marker, so we read it and rewind, so we don&#39;t</span>
        <span class="c1"># screw up our positioning in the file</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1">#if markers[0] == 0:</span>
            <span class="c1">#self.log.debug(&#39;    returning early&#39;)</span>
            <span class="c1">#return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;---marker0 = </span><span class="si">%s</span><span class="s1">---</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">markers</span><span class="p">)</span>

        <span class="c1"># while the subtables aren&#39;t done</span>
        <span class="k">while</span> <span class="n">markers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">is_start_of_subtable</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;***isubtable = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_read_subtable_3_4</span><span class="p">(</span><span class="n">table3_parser</span><span class="p">,</span> <span class="n">table4_parser</span><span class="p">,</span> <span class="n">passer</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;failed reading </span><span class="si">%s</span><span class="s1"> isubtable=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span><span class="p">))</span>
                <span class="k">raise</span>
            <span class="c1">#force_table4 = self._read_subtable_3_4(table3_parser, table4_parser, passer)</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span> <span class="o">-=</span> <span class="mi">1</span>

            <span class="n">iloc</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">read_3_markers</span><span class="p">([</span><span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                <span class="c1">#self.log.debug(&#39;markers=%s&#39; % [op2.isubtable, 1, 0])</span>
            <span class="k">except</span> <span class="n">FortranMarkerError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;isubtable=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span><span class="p">)</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">iloc</span><span class="p">)</span>
                <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">iloc</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

                <span class="n">marker0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1">#print(&#39;marker0 =&#39;, marker0)</span>
                <span class="k">if</span> <span class="n">marker0</span> <span class="o">&lt;</span> <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;marker0 &lt; isubtable; marker0=</span><span class="si">%s</span><span class="s1"> isubtable=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">marker0</span><span class="p">,</span> <span class="n">op2</span><span class="o">.</span><span class="n">isubtable</span><span class="p">))</span>
                    <span class="c1">#self.read_3_markers([marker0, 1, 0])</span>
                    <span class="c1">##self.log.debug(&#39;markers=%s&#39; % [marker0, 1, 0])</span>
                    <span class="c1">#self.show(200)</span>
                    <span class="c1">#break</span>
                <span class="k">raise</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nmarkers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rewind</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;breaking on marker=</span><span class="si">%r</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">markers</span><span class="p">))</span>

        <span class="c1"># we&#39;ve finished reading all subtables, but have one last marker to read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_markers</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">_finish</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_read_subtable_3_4</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table3_parser</span><span class="p">,</span> <span class="n">table4_parser</span><span class="p">,</span> <span class="n">passer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a series of subtable 3/4</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        table3_parser : bool / function</span>
<span class="sd">            None : just to break the code if we&#39;re on the array sizing step</span>
<span class="sd">            function : the table 3 reading function</span>
<span class="sd">        table4_parser :bool / function</span>
<span class="sd">            None : just to break the code if we&#39;re on the array sizing step</span>
<span class="sd">            function : the table 4 reading function</span>
<span class="sd">        passer : bool</span>
<span class="sd">            flag to see if we&#39;re skipping tables</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        flag : bool</span>
<span class="sd">            True : ???</span>
<span class="sd">            False : failed???</span>
<span class="sd">            None : passed???</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># this is the length of the current record inside table3/table4</span>
        <span class="n">record_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_record_length</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;record_length = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">record_len</span><span class="p">)</span>

        <span class="n">oes_nl</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;OESNLXD&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;OESNL1X&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;OESNLXR&#39;</span><span class="p">]</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
        <span class="k">if</span> <span class="n">record_len</span> <span class="o">==</span> <span class="mi">584</span> <span class="o">*</span> <span class="n">factor</span><span class="p">:</span>  <span class="c1"># table3 has a length of 584</span>
            <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="ow">in</span> <span class="n">oes_nl</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="s1">&#39;num_wide&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">op2</span><span class="o">.</span><span class="n">num_wide</span> <span class="o">==</span> <span class="mi">146</span><span class="p">:</span>
                <span class="n">data_code_old</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">data_code</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_as_h5</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5_file</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">data_code</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;_encoding&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">,</span>
                <span class="s1">&#39;load_as_h5&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_as_h5</span><span class="p">,</span>
                <span class="s1">&#39;h5_file&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">h5_file</span><span class="p">,</span>
                <span class="s1">&#39;size&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">op2</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">passer</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">table3_parser</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">SortCodeError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_debug_file</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">binary_debug</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;except SortCodeError!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">op2</span><span class="o">.</span><span class="n">table_name</span> <span class="ow">in</span> <span class="n">oes_nl</span><span class="p">:</span>
                        <span class="n">update_op2_datacode</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="n">data_code_old</span><span class="p">)</span>

                        <span class="n">n</span> <span class="o">=</span> <span class="n">table4_parser</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)</span>
                        <span class="c1">#print(data_code_old)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">):</span>
                            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;n is not an integer; table_name=</span><span class="si">%s</span><span class="s1"> n=</span><span class="si">%s</span><span class="s1"> table4_parser=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">table_name</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">table4_parser</span><span class="p">)</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">IS_TESTING</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_run_checks</span><span class="p">(</span><span class="n">table4_parser</span><span class="p">)</span>

                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="c1">#op2_reader._goto(n)</span>
                            <span class="c1">#n = op2_reader._skip_record()</span>
                            <span class="c1">#if hasattr(self.op2, &#39;table_name&#39;):</span>
                                <span class="c1">#print(&#39;***_init_vector_counter&#39;, self.op2.table_name)</span>
                            <span class="c1">#print(&#39;record_len&#39;, record_len)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">_init_vector_counter</span><span class="p">(</span><span class="n">record_len</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">_reset_vector_counter</span><span class="p">()</span>

                        <span class="c1">#print(&#39;except...&#39;)</span>
                        <span class="k">return</span> <span class="kc">False</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">code_information</span><span class="p">())</span>
                <span class="c1">#if hasattr(op2, &#39;isubcase&#39;):</span>
                    <span class="c1">#print(&quot;code = &quot;, op2._get_code())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">passer</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_subcase</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_record</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="s1">&#39;num_wide&#39;</span><span class="p">):</span>
                    <span class="c1"># num_wide is the result size and is usually found in</span>
                    <span class="c1"># table3, but some B-list tables don&#39;t have it</span>
                    <span class="n">unused_n</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">_read_subtable_results</span><span class="p">(</span><span class="n">table4_parser</span><span class="p">,</span> <span class="n">record_len</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record_ndata</span><span class="p">()</span>
                    <span class="n">unused_n</span> <span class="o">=</span> <span class="n">table4_parser</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ndata</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">IS_TESTING</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_run_checks</span><span class="p">(</span><span class="n">table4_parser</span><span class="p">)</span>
                <span class="c1">#del n</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_run_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table4_parser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;helper method&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">table4_parser</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">_table_passer</span><span class="p">:</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op2</span><span class="o">.</span><span class="n">code_information</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">):</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">get_stats</span><span class="p">())</span>

<div class="viewcode-block" id="OP2Reader.show"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.show">[docs]</a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;ifs&#39;</span><span class="p">,</span> <span class="n">endian</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        shows the next N bytes</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int</span>
<span class="sd">            the number of bytes to show</span>
<span class="sd">        types : str; default=&#39;ifs&#39;</span>
<span class="sd">            the data types to show</span>
<span class="sd">        endian : str; default=None -&gt; active endian</span>
<span class="sd">            the data endian</span>
<span class="sd">        force : bool; default=False</span>
<span class="sd">            overwrite the n=2000 limiter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="k">assert</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">strings</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="n">endian</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strings</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span></div>

<div class="viewcode-block" id="OP2Reader.show_data"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.show_data">[docs]</a>    <span class="k">def</span> <span class="nf">show_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;ifs&#39;</span><span class="p">,</span> <span class="n">endian</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shows a data block as various types</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : bytes</span>
<span class="sd">            the binary string bytes</span>
<span class="sd">        types : str; default=&#39;ifs&#39;</span>
<span class="sd">            i - int</span>
<span class="sd">            f - float</span>
<span class="sd">            s - string</span>
<span class="sd">            d - double (float64; 8 bytes)</span>
<span class="sd">            q - long long (int64; 8 bytes)</span>

<span class="sd">            l - long (int; 4 bytes)</span>
<span class="sd">            I - unsigned int (int; 4 bytes)</span>
<span class="sd">            L - unsigned long (int; 4 bytes)</span>
<span class="sd">            Q - unsigned long long (int; 8 bytes)</span>
<span class="sd">        endian : str; default=None -&gt; auto determined somewhere else in the code</span>
<span class="sd">            the big/little endian {&gt;, &lt;}</span>
<span class="sd">        force : bool; default=False</span>
<span class="sd">            overwrite the n=2000 limiter</span>

<span class="sd">        .. warning:: &#39;s&#39; is apparently not Python 3 friendly</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#ifsdqlILQ</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="n">endian</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;ifs&#39;</span><span class="p">,</span>
                    <span class="n">endian</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Useful function for seeing what&#39;s going on locally when debugging.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : bytes</span>
<span class="sd">            the binary string bytes</span>
<span class="sd">        types : str; default=&#39;ifs&#39;</span>
<span class="sd">            i - int</span>
<span class="sd">            f - float</span>
<span class="sd">            s - string</span>
<span class="sd">            d - double (float64; 8 bytes)</span>
<span class="sd">            q - long long (int64; 8 bytes)</span>

<span class="sd">            l - long (int; 4 bytes)</span>
<span class="sd">            I - unsigned int (int; 4 bytes)</span>
<span class="sd">            L - unsigned long (int; 4 bytes)</span>
<span class="sd">            Q - unsigned long long (int; 8 bytes)</span>
<span class="sd">        endian : str; default=None -&gt; auto determined somewhere else in the code</span>
<span class="sd">            the big/little endian {&gt;, &lt;}</span>
<span class="sd">        force : bool; default=False</span>
<span class="sd">            overwrite the n=2000 limiter</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;limiting n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> to 2000&#39;</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="mi">2000</span>
        <span class="n">nints</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">4</span>
        <span class="n">ndoubles</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">8</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">ints</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">floats</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">longs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">endian</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">endian</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uendian</span>
            <span class="k">assert</span> <span class="n">endian</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">endian</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ndata = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">typei</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">typei</span> <span class="ow">in</span> <span class="s1">&#39;sifdq lILQ&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;type=</span><span class="si">{</span><span class="n">typei</span><span class="si">!r}</span><span class="s1"> is invalid; use sifdq lILQ&#39;</span>

        <span class="n">data4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">nints</span> <span class="o">*</span> <span class="mi">4</span><span class="p">]</span>
        <span class="c1">#data8 = data[:ndoubles * 8]</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">data</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  strings = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">strings</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;i&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">ints</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">i&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">nints</span><span class="p">),</span> <span class="n">data4</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  ints    = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ints</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;f&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">floats</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">f&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">nints</span><span class="p">),</span> <span class="n">data4</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  floats  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">floats</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;d&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">doubles</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">d&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">ndoubles</span><span class="p">),</span> <span class="n">data</span><span class="p">[:</span><span class="n">ndoubles</span><span class="o">*</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  doubles (float64) = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">doubles</span><span class="p">))</span>

        <span class="k">if</span> <span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">longs</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">l&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">nints</span><span class="p">),</span> <span class="n">data4</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  long  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">longs</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;I&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">ints2</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">I&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">nints</span><span class="p">),</span> <span class="n">data4</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  unsigned int = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">ints2</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;L&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">longs2</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">L&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">nints</span><span class="p">),</span> <span class="n">data4</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  unsigned long = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">longs2</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;q&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">longs</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">q&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">ndoubles</span><span class="p">),</span> <span class="n">data</span><span class="p">[:</span><span class="n">ndoubles</span><span class="o">*</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  long long (int64) = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">longs</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;Q&#39;</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="n">longs</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%i</span><span class="s1">q&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">endian</span><span class="p">,</span> <span class="n">ndoubles</span><span class="p">),</span> <span class="n">data</span><span class="p">[:</span><span class="n">ndoubles</span><span class="o">*</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;  unsigned long long (int64) = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">longs</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strings</span><span class="p">,</span> <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span>

<div class="viewcode-block" id="OP2Reader.show_ndata"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.OP2Reader.show_ndata">[docs]</a>    <span class="k">def</span> <span class="nf">show_ndata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;ifs&#39;</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_ndata</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_write_ndata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;ifs&#39;</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="sd">&quot;&quot;&quot;Useful function for seeing what&#39;s going on locally when debugging.&quot;&quot;&quot;</span>
        <span class="n">op2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op2</span>
        <span class="n">nold</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">n</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">nold</span>
        <span class="n">op2</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">op2</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_data</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="n">types</span><span class="p">)</span></div>

<div class="viewcode-block" id="grids_comp_array_to_index"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.grids_comp_array_to_index">[docs]</a><span class="k">def</span> <span class="nf">grids_comp_array_to_index</span><span class="p">(</span><span class="n">grids1</span><span class="p">,</span> <span class="n">comps1</span><span class="p">,</span> <span class="n">grids2</span><span class="p">,</span> <span class="n">comps2</span><span class="p">,</span>
                              <span class="n">make_matrix_symmetric</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maps the dofs</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ja : ???</span>
<span class="sd">        ???</span>
<span class="sd">    jb : ???</span>
<span class="sd">        ???</span>
<span class="sd">    nja : ???</span>
<span class="sd">        ???</span>
<span class="sd">    njb : ???</span>
<span class="sd">        ???</span>
<span class="sd">    nj : ???</span>
<span class="sd">        ???</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#from pyNastran.femutils.utils import unique2d</span>
    <span class="n">ai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">grids1</span><span class="p">,</span> <span class="n">comps1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">bi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">grids2</span><span class="p">,</span> <span class="n">comps2</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
    <span class="c1">#print(&#39;grids2 =&#39;, grids2)</span>
    <span class="c1">#print(&#39;comps2 =&#39;, comps2)</span>
    <span class="c1">#c = np.vstack([a, b])</span>
    <span class="c1">#assert c.shape[1] == 2, c.shape</span>
    <span class="c1">#urows = unique2d(c)</span>
    <span class="c1">#urows = c</span>

    <span class="n">nid_comp_to_dof_index</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">a_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">nid_dof</span> <span class="ow">in</span> <span class="n">ai</span><span class="p">:</span>
        <span class="c1">#nid_dof = (int(nid), int(dof))</span>
        <span class="n">nid_dof</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">nid_dof</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nid_dof</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a_keys</span><span class="p">:</span>
            <span class="n">a_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nid_dof</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nid_dof</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nid_comp_to_dof_index</span><span class="p">:</span>
                <span class="n">nid_comp_to_dof_index</span><span class="p">[</span><span class="n">nid_dof</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">nja</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_keys</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">a_keys</span>

    <span class="n">b_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">nid_dof</span> <span class="ow">in</span> <span class="n">bi</span><span class="p">:</span>
        <span class="n">nid_dof</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">nid_dof</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nid_dof</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b_keys</span><span class="p">:</span>
            <span class="n">b_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nid_dof</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nid_dof</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nid_comp_to_dof_index</span><span class="p">:</span>
            <span class="n">nid_comp_to_dof_index</span><span class="p">[</span><span class="n">nid_dof</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">njb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_keys</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">b_keys</span>


    <span class="n">nj</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nid_comp_to_dof_index</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">make_matrix_symmetric</span><span class="p">:</span>
        <span class="n">ja</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nj</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nid_dof</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">(),</span> <span class="n">ai</span><span class="p">):</span>
            <span class="n">j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid_comp_to_dof_index</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">nid_dof</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nid_dof</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">(),</span> <span class="n">bi</span><span class="p">):</span>
            <span class="n">j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid_comp_to_dof_index</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">nid_dof</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">nj</span><span class="p">,</span> <span class="n">nj</span><span class="p">,</span> <span class="n">nj</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ja</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">grids1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nid_dof</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">(),</span> <span class="n">ai</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span>
            <span class="n">ja</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid_comp_to_dof_index</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">nid_dof</span><span class="p">)]</span>

        <span class="n">jb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">grids2</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nid_dof</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">(),</span> <span class="n">bi</span><span class="o">.</span><span class="n">tolist</span><span class="p">()):</span>
            <span class="n">jb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid_comp_to_dof_index</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">nid_dof</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">ja</span><span class="p">,</span> <span class="n">jb</span><span class="p">,</span> <span class="n">nja</span><span class="p">,</span> <span class="n">njb</span><span class="p">,</span> <span class="n">nj</span></div>

<div class="viewcode-block" id="eqexin_to_nid_dof_doftype"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.eqexin_to_nid_dof_doftype">[docs]</a><span class="k">def</span> <span class="nf">eqexin_to_nid_dof_doftype</span><span class="p">(</span><span class="n">eqexin1</span><span class="p">,</span> <span class="n">eqexin2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;assemble dof table&quot;&quot;&quot;</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">eqexin2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">10</span>
    <span class="n">doftype</span> <span class="o">=</span> <span class="n">eqexin2</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">dof</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">eqexin2</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># eqexin is in external sort, so sort it</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">eqexin1</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">dof</span> <span class="o">=</span> <span class="n">dof</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">doftype</span> <span class="o">=</span> <span class="n">doftype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">nid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">nid</span><span class="p">,</span> <span class="n">dof</span><span class="p">,</span> <span class="n">doftype</span></div>

<div class="viewcode-block" id="get_table_size_from_ncolumns"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.get_table_size_from_ncolumns">[docs]</a><span class="k">def</span> <span class="nf">get_table_size_from_ncolumns</span><span class="p">(</span><span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ncolumns</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="n">nvalues</span> <span class="o">//</span> <span class="n">ncolumns</span>
    <span class="k">if</span> <span class="n">nvalues</span> <span class="o">%</span> <span class="n">ncolumns</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;table=</span><span class="si">%s</span><span class="s1">: nrows=nvalues/ncolumns=</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">; nrows=</span><span class="si">%s</span><span class="s1"> must be an int&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">table_name</span><span class="p">,</span> <span class="n">nvalues</span><span class="p">,</span> <span class="n">ncolumns</span><span class="p">,</span> <span class="n">nrows</span><span class="p">,</span> <span class="n">nvalues</span> <span class="o">/</span> <span class="n">ncolumns</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nrows</span></div>

<div class="viewcode-block" id="dscmcol_dresp1"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.dscmcol_dresp1">[docs]</a><span class="k">def</span> <span class="nf">dscmcol_dresp1</span><span class="p">(</span><span class="n">responses</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                   <span class="n">nresponses_dresp1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;helper for DSCMCOL&quot;&quot;&quot;</span>
    <span class="n">idata</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">nresponses_dresp1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">iresp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nresponses_dresp1</span><span class="p">):</span>
        <span class="c1"># Record  Type 1 Responses</span>
        <span class="c1">#   1 IRID  I Internal response identification number</span>
        <span class="c1">#   2 RID   I External response identification number</span>
        <span class="c1">#   3 RTYPE I Response Type</span>
        <span class="c1"># RTYPE=3 Buckling</span>
        <span class="c1">#   4 MODE    I Mode number</span>
        <span class="c1">#   5 UNDEF None</span>
        <span class="c1">#   6 SUBCASE I Subcase identification number</span>
        <span class="c1">#   7 UNDEF(2) None</span>
        <span class="c1">#   9 SEID    I Superelement identification number</span>
        <span class="c1"># RTYPE=8 Static force</span>
        <span class="c1"># 4 EID I Element identification number</span>
        <span class="c1"># 5 COMP I Force component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 UNDEF None</span>
        <span class="c1"># 8 VIEWID I View element identification number</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=10 Composite stress</span>
        <span class="c1"># 4 EID I Element identification number</span>
        <span class="c1"># 5 COMP I Stress component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 UNDEF None</span>
        <span class="c1"># 8 PLY I Ply number</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=13 Static SPC force</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I SPC force component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 UNDEF(2) None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=14 Element static strain energy</span>
        <span class="c1"># 4 EID I Element identification number</span>
        <span class="c1"># 5 COMP I Strain energy component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 UNDEF(2) None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=17 Compliance</span>
        <span class="c1"># 4 UNDEF(2) None</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 UNDEF(3) None</span>
        <span class="c1"># RTYPE=21 Frequency response velocity</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I Velocity component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 FREQ RS Frequency</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=22 Frequency response acceleration</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I Acceleration component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 FREQ RS Frequency</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=23 Frequency response SPC Force</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I SPC Force component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 FREQ RS Frequency</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=24 Frequency response stress</span>
        <span class="c1"># 4 EID I Element identification number</span>
        <span class="c1"># 5 COMP I Stress component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 FREQ RS Frequency</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=25 Frequency response force</span>
        <span class="c1"># 4 EID I Element identification number</span>
        <span class="c1"># 5 COMP I Force component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 FREQ RS Frequency</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=26 RMS displacement</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I RMS displacement component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 UNDEF None</span>
        <span class="c1"># 8 RANDPS I RANDPS ID</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=27 RMS velocity</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I RMS velocity component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 UNDEF None</span>
        <span class="c1"># 8 RANDPS I RANDPS ID</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=28 RMS acceleration</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I RMS acceleration component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 UNDEF None</span>
        <span class="c1"># 8 RANDPS I RANDPS ID</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=30 PSD velocity</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I PSD velocity component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 FREQ RS Frequency</span>
        <span class="c1"># 8 RANDPS I RANDPS ID</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=60 Transient response displacement</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I Displacement component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 TIME RS Time</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=61 Transient response velocity</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I Velocity component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 TIME RS Time</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=62 Transient response acceleration</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I Acceleration component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 TIME RS Time</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=63 Transient response SPC Force</span>
        <span class="c1"># 4 GRID I Grid identification number</span>
        <span class="c1"># 5 COMP I SPC force component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 TIME RS Time</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=64 Transient response stress</span>
        <span class="c1"># 4 EID I Element identification number</span>
        <span class="c1"># 5 COMP I Stress component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 TIME RS Time</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=65 Transient response force</span>
        <span class="c1"># 4 EID I Element identification number</span>
        <span class="c1"># 5 COMP I Force component number</span>
        <span class="c1"># 6 SUBCASE I Subcase identification number</span>
        <span class="c1"># 7 TIME RS Time</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=81 Aeroelastic divergence</span>
        <span class="c1"># 4 SUBCASE I Subcase identification number</span>
        <span class="c1"># 5 UNDEF None</span>
        <span class="c1"># 6 ROOT I Root</span>
        <span class="c1"># 7 MACH RS Mach number</span>
        <span class="c1"># 8 UNDEF None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=82 Aeroelastic trim</span>
        <span class="c1"># 4 SUBCASE I Subcase identification number</span>
        <span class="c1"># 5 UNDEF None</span>
        <span class="c1"># 6 XID I XID</span>
        <span class="c1"># 7 UNDEF(2) None</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=83 Aeroelastic stability derivative</span>
        <span class="c1"># 4 SUBCASE I Subcase identification number</span>
        <span class="c1"># 5 RU I R/U</span>
        <span class="c1"># 6 COMP I Component number</span>
        <span class="c1"># 7 UNDEF None</span>
        <span class="c1"># 8 XID I XID</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># RTYPE=84 Aeroelastic flutter damping</span>
        <span class="c1"># 4 SUBCASE I Subcase identification number</span>
        <span class="c1"># 5 MODE I Mode number</span>
        <span class="c1"># 6 DENSITY RS Density</span>
        <span class="c1"># 7 MACH RS Mach number</span>
        <span class="c1"># 8 VEL RS Velocity</span>
        <span class="c1"># 9 SEID I Superelement identification number</span>
        <span class="c1"># End RTYPE</span>

        <span class="n">internal_response_id</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="p">]</span>
        <span class="n">external_response_id</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">response_type</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1">#print(f&#39;internal_response_id={internal_response_id} &#39;</span>
              <span class="c1">#f&#39;external_response_id={external_response_id} response_type={response_type}&#39;)</span>

        <span class="k">if</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># RTYPE=1 Weight</span>
            <span class="c1">#   4 UNDEF(5) None</span>
            <span class="c1">#   9 SEID I Superelement identification number</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  seid={seid} (weight)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># RTYPE=2 Volume</span>
            <span class="c1">#   4 UNDEF(5) None</span>
            <span class="c1">#   9 SEID I Superelement identification number</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  seid={seid} (volume)&#39;)</span>

        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1"># RTYPE=4 Normal modes</span>
            <span class="c1">#   4 MODE    I Mode number</span>
            <span class="c1">#   5 UNDEF None</span>
            <span class="c1">#   6 SUBCASE I Subcase identification number</span>
            <span class="c1">#   7 UNDEF(2) None</span>
            <span class="c1">#   9 SEID    I Superelement identification number</span>
            <span class="n">mode_num</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="c1"># blank</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;normal modes&#39;</span><span class="p">,</span> <span class="s1">&#39;mode_num&#39;</span><span class="p">:</span> <span class="n">mode_num</span><span class="p">,</span> <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  mode_num={mode_num} subcase={subcase} seid={seid} (normal modes)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="c1"># RTYPE=5 Static displacement</span>
            <span class="c1">#   4 GRID    I Grid identification number</span>
            <span class="c1">#   5 COMP    I Displacement component number</span>
            <span class="c1">#   6 SUBCASE I Subcase identification number</span>
            <span class="c1">#   7 UNDEF(2) None</span>
            <span class="c1">#   9 SEID    I Superelement identification number</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;static displacement&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  grid={grid} comp={comp} subcase={subcase} seid={seid} (static displacement)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="c1"># RTYPE=6 Static stress</span>
            <span class="c1"># 4 EID     I Element identification number</span>
            <span class="c1"># 5 COMP    I Stress component number</span>
            <span class="c1"># 6 SUBCASE I Subcase identification number</span>
            <span class="c1"># 7 UNDEF(2) None</span>
            <span class="c1"># 9 SEID    I Superelement identification number</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;static stress&#39;</span><span class="p">,</span> <span class="s1">&#39;eid&#39;</span><span class="p">:</span> <span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  eid={eid} comp={comp} subcase={subcase} seid={seid} (static stress)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="c1"># RTYPE=7 Static strain</span>
            <span class="c1"># 4 EID     I Element identification number</span>
            <span class="c1"># 5 COMP    I Strain component number</span>
            <span class="c1"># 6 SUBCASE I Subcase identification number</span>
            <span class="c1"># 7 UNDEF None</span>
            <span class="c1"># 8 VIEWID  I View element identification number</span>
            <span class="c1"># 9 SEID    I Superelement identification number</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">view_id</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;static strain&#39;</span><span class="p">,</span> <span class="s1">&#39;eid&#39;</span><span class="p">:</span> <span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;view id&#39;</span><span class="p">:</span> <span class="n">view_id</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  eid={eid} comp={comp} subcase={subcase} view_id={view_id} seid={seid} (static strain)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
            <span class="c1"># RTYPE=9 Composite failure</span>
            <span class="c1">#   4 EID     I Element identification number</span>
            <span class="c1">#   5 COMP    I Failure component number</span>
            <span class="c1">#   6 SUBCASE I Subcase identification number</span>
            <span class="c1">#   7 UNDEF None</span>
            <span class="c1">#   8 PLY     I Ply number</span>
            <span class="c1">#   9 SEID    I Superelement identification number</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">ply</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;composite failure&#39;</span><span class="p">,</span> <span class="s1">&#39;eid&#39;</span><span class="p">:</span> <span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;ply&#39;</span><span class="p">:</span> <span class="n">ply</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  eid={eid} comp={comp} subcase={subcase} ply={ply} seid={seid} (composite failure)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="c1"># RTYPE=11 Composite strain</span>
            <span class="c1">#   4 EID     I Element identification number</span>
            <span class="c1">#   5 COMP    I Strain component number</span>
            <span class="c1">#   6 SUBCASE I Subcase identification number</span>
            <span class="c1">#   7 UNDEF None</span>
            <span class="c1">#   8 PLY     I Ply number</span>
            <span class="c1">#   9 SEID    I Superelement identification number</span>
            <span class="n">eid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">ply</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;composite strain&#39;</span><span class="p">,</span> <span class="s1">&#39;eid&#39;</span><span class="p">:</span> <span class="n">eid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;ply&#39;</span><span class="p">:</span> <span class="n">ply</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  eid={eid} comp={comp} subcase={subcase} ply={ply} seid={seid} (composite strain)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
            <span class="c1"># CEIG</span>
            <span class="n">mode_num</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">idata</span><span class="o">+</span><span class="mi">9</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">floats</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">:</span><span class="n">idata</span><span class="o">+</span><span class="mi">9</span><span class="p">])</span>
            <span class="c1">#print(f&#39;internal_response_id={internal_response_id} &#39;</span>
                  <span class="c1">#f&#39;external_response_id={external_response_id} response_type={response_type}&#39;)</span>
            <span class="c1">#print(f&#39;  mode_num={mode_num} subcase={subcase} seid={seid} (CEIG)&#39;)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ceig&#39;</span><span class="p">,</span> <span class="s1">&#39;mode_num&#39;</span><span class="p">:</span> <span class="n">mode_num</span><span class="p">,</span> <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>

        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">19</span><span class="p">:</span>
            <span class="c1"># RTYPE=19 Equivalent radiated power</span>
            <span class="c1"># 4 PANEL      I Element identification number</span>
            <span class="c1"># 5 FLAG       I A subcase ID based code. +: magnitude; :density</span>
            <span class="c1"># 6 SUBCASE    I Subcase identification number</span>
            <span class="c1"># 7 FREQUENCY RS Frequency</span>
            <span class="c1"># 8 UNDEF None</span>
            <span class="c1"># 9 SEID       I Superelement identification number</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;equivalent radiated power&#39;</span><span class="p">,</span> <span class="s1">&#39;panel&#39;</span><span class="p">:</span> <span class="n">panel</span><span class="p">,</span> <span class="s1">&#39;flag&#39;</span><span class="p">:</span> <span class="n">flag</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  panel={panel} flag={flag} subcase={subcase} freq={freq} seid={seid} &#39;</span>
                  <span class="c1">#&#39;(equivalent radiated power)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">20</span><span class="p">:</span>
            <span class="c1"># RTYPE=20 Frequency response displacement</span>
            <span class="c1"># 4 GRID    I Grid identification number</span>
            <span class="c1"># 5 COMP    I Displacement component number</span>
            <span class="c1"># 6 SUBCASE I Subcase identification number</span>
            <span class="c1"># 7 FREQ    RS Frequency</span>
            <span class="c1"># 8 UNDEF None</span>
            <span class="c1"># 9 SEID    I Superelement identification number</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">ply</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">unused_freq8</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="c1"># also freq despite DMAP saying this is unused...</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;frequency response displacement&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;ply&#39;</span><span class="p">:</span> <span class="n">ply</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  grid={grid} comp={comp} subcase={subcase} freq={freq} &#39;</span>
                  <span class="c1">#f&#39;ply={ply} seid={seid} (frequency response displacement)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">21</span><span class="p">:</span>
            <span class="c1"># RTYPE=21 frequency response stress???</span>
            <span class="c1"># 4 GRID    I Grid identification number</span>
            <span class="c1"># 5 COMP    I Displacement component number</span>
            <span class="c1"># 6 SUBCASE I Subcase identification number</span>
            <span class="c1"># 7 FREQ    RS Frequency</span>
            <span class="c1"># 8 UNDEF None</span>
            <span class="c1"># 9 SEID    I Superelement identification number</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span>
            <span class="c1">#sixI = ints[idata+6]</span>
            <span class="n">ply</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;frequency response stress?&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;ply&#39;</span><span class="p">:</span> <span class="n">ply</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  grid={grid} comp={comp} subcase={subcase} freq={freq} &#39;</span>
                  <span class="c1">#f&#39;ply={ply} seid={seid} (frequency response stress?)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">29</span><span class="p">:</span>
            <span class="c1"># RTYPE=29 PSD displacement</span>
            <span class="c1"># 4 GRID    I Grid identification number</span>
            <span class="c1"># 5 COMP    I PSD displacement component number</span>
            <span class="c1"># 6 SUBCASE I Subcase identification number</span>
            <span class="c1"># 7 FREQ    RS Frequency</span>
            <span class="c1"># 8 RANDPS  I RANDPS ID</span>
            <span class="c1"># 9 SEID I   Superelement identification number</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">randps</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;psd displacement&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;randps&#39;</span><span class="p">:</span> <span class="n">randps</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  grid={grid} comp={comp} subcase={subcase} freq={freq} &#39;</span>
                  <span class="c1">#f&#39;randps={randps} seid={seid} (PSD displacement)&#39;)</span>
        <span class="k">elif</span> <span class="n">response_type</span> <span class="o">==</span> <span class="mi">31</span><span class="p">:</span>
            <span class="c1"># RTYPE=31 PSD acceleration</span>
            <span class="c1"># 4 GRID    I Grid identification number</span>
            <span class="c1"># 5 COMP    I PSD acceleration component number</span>
            <span class="c1"># 6 SUBCASE I Subcase identification number</span>
            <span class="c1"># 7 FREQ   RS Frequency</span>
            <span class="c1"># 8 RANDPS  I RANDPS ID</span>
            <span class="c1"># 9 SEID    I Superelement identification number</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">comp</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">randps</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;psd acceleration&#39;</span><span class="p">,</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span> <span class="n">grid</span><span class="p">,</span> <span class="s1">&#39;component&#39;</span><span class="p">:</span> <span class="n">comp</span><span class="p">,</span>
                        <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freq</span><span class="p">,</span> <span class="s1">&#39;randps&#39;</span><span class="p">:</span> <span class="n">randps</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
            <span class="c1">#print(f&#39;  grid={grid} comp={comp} subcase={subcase} freq={freq} &#39;</span>
                  <span class="c1">#f&#39;randps={randps} seid={seid} (PSD acceleration)&#39;)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;internal_response_id=</span><span class="si">{</span><span class="n">internal_response_id</span><span class="si">}</span><span class="s1"> &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;external_response_id=</span><span class="si">{</span><span class="n">external_response_id</span><span class="si">}</span><span class="s1"> response_type=</span><span class="si">{</span><span class="n">response_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">response_type</span><span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;internal_response_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">internal_response_id</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;external_response_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">external_response_id</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;response_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">response_type</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;iresponse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iresp</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;response_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">responses</span><span class="p">[</span><span class="n">iresp</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>
        <span class="n">idata</span> <span class="o">+=</span> <span class="mi">9</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="dscmcol_dresp2"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.dscmcol_dresp2">[docs]</a><span class="k">def</span> <span class="nf">dscmcol_dresp2</span><span class="p">(</span><span class="n">responses</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                   <span class="n">nresponses_dresp2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">ints</span><span class="p">,</span> <span class="n">floats</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;helper for DSCMCOL&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nresponses_dresp2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">nresponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses</span><span class="p">)</span>

    <span class="n">idata</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">iresp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nresponses_dresp2</span><span class="p">):</span>
        <span class="c1"># Word Name Type Description</span>
        <span class="c1"># 1 IRID      I Internal response identification number</span>
        <span class="c1"># 2 RID       I External response identification number</span>
        <span class="c1"># 3 SUBCASE   I Subcase identification number</span>
        <span class="c1"># 4 DFLAG     I Dynamic response flag (See Note)</span>
        <span class="c1"># 5 FREQTIME RS Frequency or time step</span>
        <span class="c1"># 6 SEID      I Superelement identification number</span>
        <span class="n">internal_response_id</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="p">]</span>
        <span class="n">external_response_id</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">subcase</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">dflag</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">freqtime</span> <span class="o">=</span> <span class="n">floats</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">seid</span> <span class="o">=</span> <span class="n">ints</span><span class="p">[</span><span class="n">idata</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">iresp2</span> <span class="o">=</span> <span class="n">iresp</span> <span class="o">+</span> <span class="n">nresponses</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;iresponse&#39;</span><span class="p">:</span> <span class="n">iresp2</span><span class="p">,</span>
            <span class="s1">&#39;response_number&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;internal_response_id&#39;</span><span class="p">:</span> <span class="n">internal_response_id</span><span class="p">,</span>
            <span class="s1">&#39;external_response_id&#39;</span><span class="p">:</span> <span class="n">external_response_id</span><span class="p">,</span>
            <span class="s1">&#39;subcase&#39;</span><span class="p">:</span> <span class="n">subcase</span><span class="p">,</span> <span class="s1">&#39;dflag&#39;</span><span class="p">:</span> <span class="n">dflag</span><span class="p">,</span>
            <span class="s1">&#39;freq&#39;</span><span class="p">:</span> <span class="n">freqtime</span><span class="p">,</span> <span class="s1">&#39;seid&#39;</span><span class="p">:</span> <span class="n">seid</span><span class="p">}</span>
        <span class="n">responses</span><span class="p">[</span><span class="n">iresp2</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span>
        <span class="c1">#print(f&#39;internal_response_id={internal_response_id} &#39;</span>
              <span class="c1">#f&#39;external_response_id={external_response_id} &#39;</span>
              <span class="c1">#f&#39;subcase={subcase} dflag={dflag} freq/time={freqtime} seid={seid}&#39;)</span>
        <span class="n">idata</span> <span class="o">+=</span> <span class="mi">6</span>
    <span class="k">return</span></div>

<span class="k">def</span> <span class="nf">_parse_nastran_version</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;parses a Nastran version string&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
        <span class="n">MSC_LONG_VERSION</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">b</span><span class="s1">&#39;XXXXXXXX20140&#39;</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;XXXXXXXX20141&#39;</span><span class="p">,</span>
            <span class="sa">b</span><span class="s1">&#39;XXXXXXXX20182&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1">#self.show_data(data[:16], types=&#39;ifsdqlILQ&#39;, endian=None)</span>
        <span class="c1">#self.show_data(data[16:], types=&#39;ifsdqlILQ&#39;, endian=None)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="n">MSC_LONG_VERSION</span><span class="p">:</span>
            <span class="c1"># &#39;XXXXXXXX20140   0   \x00\x00\x00\x00        &#39;</span>
            <span class="c1"># &#39;XXXXXXXX20141   0   \x00\x00\x00\x00        &#39;</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;msc&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;check=</span><span class="si">{</span><span class="n">data</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s1"> data=</span><span class="si">{</span><span class="n">data</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">_parse_nastran_version_8</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">_parse_nastran_version_16</span><span class="p">(</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">encoding</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;version=</span><span class="si">{</span><span class="n">version</span><span class="si">!r}</span><span class="s1">; n=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mode</span>

<span class="k">def</span> <span class="nf">_parse_nastran_version_16</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;parses an 8 character version string&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;NX20    19.0&#39;</span><span class="p">,</span>
                   <span class="sa">b</span><span class="s1">&#39;NX20    19.1&#39;</span><span class="p">,</span>
                   <span class="sa">b</span><span class="s1">&#39;NX20    19.2&#39;</span><span class="p">]:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;nx&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;unknown version=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">version</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mode</span>

<span class="k">def</span> <span class="nf">_parse_nastran_version_8</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;parses an 8 character version string&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;NX&#39;</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;nx&#39;</span>
        <span class="n">version_str</span> <span class="o">=</span> <span class="n">version</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">version_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">NX_VERSIONS</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;nx version=</span><span class="si">%r</span><span class="s1"> is not supported&#39;</span> <span class="o">%</span> <span class="n">version_str</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;MODEP&#39;</span><span class="p">):</span>
        <span class="c1"># TODO: why is this separate?</span>
        <span class="c1"># F:\work\pyNastran\pyNastran\master2\pyNastran\bdf\test\nx_spike\out_ac11103.op2</span>
        <span class="c1">#print(&#39;found NX table?...&#39;)</span>
        <span class="c1">#log.warning(&#39;Assuming NX Nastran&#39;)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;nx&#39;</span>
    <span class="k">elif</span> <span class="n">version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;AEROFREQ&#39;</span><span class="p">):</span>
        <span class="c1"># TODO: why is this separate?</span>
        <span class="c1"># C:\Users\Steve\Dropbox\pyNastran_examples\move_tpl\loadf.op2</span>
        <span class="c1">#print(&#39;found MSC table?...&#39;)</span>
        <span class="c1">#log.warning(&#39;Assuming MSC Nastran&#39;)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;msc&#39;</span>
    <span class="k">elif</span> <span class="n">version</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;AEROTRAN&#39;</span><span class="p">):</span>
        <span class="c1"># TODO: why is this separate?</span>
        <span class="c1"># C:\Users\Steve\Dropbox\pyNastran_examples\move_tpl\loadf.op2</span>
        <span class="c1">#log.warning(&#39;Assuming MSC Nastran&#39;)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;msc&#39;</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;V2005R3B&#39;</span><span class="p">]:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;msc&#39;</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;XXXXXXXX&#39;</span><span class="p">]:</span>
        <span class="c1">#log.warning(&#39;Assuming MSC Nastran&#39;)</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;msc&#39;</span>
    <span class="k">elif</span> <span class="n">version</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;OS11XXXX&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;OS12.210&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;OS14.210&#39;</span><span class="p">,</span>
                     <span class="sa">b</span><span class="s1">&#39;OS2017.1&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;OS2017.2&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;OS2018.1&#39;</span><span class="p">]:</span>
        <span class="c1"># should this be called optistruct or radioss?</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;optistruct&#39;</span>
    <span class="c1">#elif data[:20] == b&#39;XXXXXXXX20141   0   &#39;:</span>
        <span class="c1">#self.set_as_msc()</span>
        <span class="c1">#self.set_table_type()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;unknown version=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">version</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mode</span>

<div class="viewcode-block" id="reshape_bytes_block"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.reshape_bytes_block">[docs]</a><span class="k">def</span> <span class="nf">reshape_bytes_block</span><span class="p">(</span><span class="n">block</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="n">nwords</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">block2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">block</span><span class="p">[</span><span class="mi">8</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">8</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwords</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">block2</span></div>

<div class="viewcode-block" id="reshape_bytes_block_size"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.reshape_bytes_block_size">[docs]</a><span class="k">def</span> <span class="nf">reshape_bytes_block_size</span><span class="p">(</span><span class="n">name_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">name_str</span> <span class="o">=</span> <span class="n">name_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name_str</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">name_str</span></div>

<div class="viewcode-block" id="reshape_bytes_block_strip"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.reshape_bytes_block_strip">[docs]</a><span class="k">def</span> <span class="nf">reshape_bytes_block_strip</span><span class="p">(</span><span class="n">name_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">name_str</span> <span class="o">=</span> <span class="n">name_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name_str</span> <span class="o">=</span> <span class="n">reshape_bytes_block</span><span class="p">(</span><span class="n">name_bytes</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">name_str</span></div>

<div class="viewcode-block" id="mapfmt"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.mapfmt">[docs]</a><span class="k">def</span> <span class="nf">mapfmt</span><span class="p">(</span><span class="n">fmt</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fmt</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;d&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="mapfmt_str"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.mapfmt_str">[docs]</a><span class="k">def</span> <span class="nf">mapfmt_str</span><span class="p">(</span><span class="n">fmt</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fmt</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="update_op2_datacode"><a class="viewcode-back" href="../../../../reference/op2/op2_interface/pyNastran.op2.op2_interface.op2_reader.html#pyNastran.op2.op2_interface.op2_reader.update_op2_datacode">[docs]</a><span class="k">def</span> <span class="nf">update_op2_datacode</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="n">data_code_old</span><span class="p">):</span>
    <span class="n">op2</span><span class="o">.</span><span class="n">data_code</span> <span class="o">=</span> <span class="n">data_code_old</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data_code_old</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">op2</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Steven Doyle.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>