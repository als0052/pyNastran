

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pyNastran.bdf.cards.coordinate_systems &mdash; pyNastran 1.4-dev 1.4-dev documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> pyNastran 1.4-dev
          

          
            
            <img src="../../../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../quick_start/index.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../how_to/index.html">How To: pyNastran</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/pyNastran.html">pyNastran Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../manual/index.html">pyNastran Manual</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">pyNastran 1.4-dev</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>pyNastran.bdf.cards.coordinate_systems</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyNastran.bdf.cards.coordinate_systems</h1><div class="highlight"><pre>
<span></span><span class="c1"># pylint: disable=R0902,R0904,R0914,C0103,C1801,R0913</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">All coordinate cards are defined in this file.  This includes:</span>

<span class="sd"> * CORD1R</span>
<span class="sd"> * CORD1C</span>
<span class="sd"> * CORD1S</span>
<span class="sd"> * CORD2R</span>
<span class="sd"> * CORD2C</span>
<span class="sd"> * CORD2S</span>

<span class="sd">{ug} = [Tgb]{ub}</span>
<span class="sd">{ub} = [Tbg]{ug}</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">degrees</span><span class="p">,</span> <span class="n">radians</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">acos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractproperty</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>  <span class="c1"># type: ignore</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="kn">from</span> <span class="nn">pyNastran.nptyping</span> <span class="kn">import</span> <span class="n">NDArray3float</span>
    <span class="kn">from</span> <span class="nn">pyNastran.bdf.bdf</span> <span class="kn">import</span> <span class="n">BDF</span>
<span class="kn">from</span> <span class="nn">pyNastran.utils.numpy_utils</span> <span class="kn">import</span> <span class="n">integer_types</span>
<span class="kn">from</span> <span class="nn">pyNastran.bdf.field_writer_8</span> <span class="kn">import</span> <span class="n">set_blank_if_default</span>
<span class="kn">from</span> <span class="nn">pyNastran.bdf.cards.base_card</span> <span class="kn">import</span> <span class="n">BaseCard</span>
<span class="kn">from</span> <span class="nn">pyNastran.bdf.bdf_interface.assign_type</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">integer</span><span class="p">,</span> <span class="n">integer_or_blank</span><span class="p">,</span> <span class="n">double_or_blank</span><span class="p">,</span> <span class="n">string_or_blank</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">pyNastran.bdf.field_writer_8</span> <span class="kn">import</span> <span class="n">print_card_8</span>
<span class="kn">from</span> <span class="nn">pyNastran.bdf.field_writer_16</span> <span class="kn">import</span> <span class="n">print_card_16</span>
<span class="kn">from</span> <span class="nn">pyNastran.bdf.field_writer_double</span> <span class="kn">import</span> <span class="n">print_card_double</span>

<span class="kn">from</span> <span class="nn">pyNastran.femutils.coord_transforms</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">xyz_to_rtz_array</span><span class="p">,</span> <span class="n">xyz_to_rtp_array</span><span class="p">,</span> <span class="c1"># xyz to xxx transforms</span>
    <span class="n">rtz_to_xyz_array</span><span class="p">,</span> <span class="n">rtp_to_xyz_array</span><span class="p">,</span> <span class="c1"># xxx to xyz transforms</span>
    <span class="c1">#rtz_to_rtp_array, rtp_to_rtz_array, # rtp/rtz and rtz/rtp transforms</span>
<span class="p">)</span>


<div class="viewcode-block" id="global_to_basic_rectangular"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.global_to_basic_rectangular">[docs]</a><span class="k">def</span> <span class="nf">global_to_basic_rectangular</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">unused_xyz_global</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">):</span>
    <span class="n">coord_transform</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">local_to_global</span>
    <span class="k">return</span> <span class="n">coord_transform</span></div>
    <span class="c1">#transform = array([ex, ey, ez], dtype=dtype)</span>
    <span class="c1">#return tranform</span>

<div class="viewcode-block" id="_primary_axes"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems._primary_axes">[docs]</a><span class="k">def</span> <span class="nf">_primary_axes</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;gets the i,j,k axes from the ???&quot;&quot;&quot;</span>
    <span class="c1">## TODO: not sure...needs testing</span>
    <span class="n">coord_transform</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">beta</span><span class="p">()</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">coord_transform</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">ey</span> <span class="o">=</span> <span class="n">coord_transform</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">ez</span> <span class="o">=</span> <span class="n">coord_transform</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">return</span> <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span></div>

<div class="viewcode-block" id="global_to_basic_cylindrical"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.global_to_basic_cylindrical">[docs]</a><span class="k">def</span> <span class="nf">global_to_basic_cylindrical</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">xyz_global</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">):</span>
    <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span> <span class="o">=</span> <span class="n">_primary_axes</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
    <span class="n">rtz</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">xyz_global</span><span class="p">)</span>
    <span class="n">r1_rad</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">rtz</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">er</span> <span class="o">=</span> <span class="n">ex</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">r1_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">ey</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">r1_rad</span><span class="p">)</span>
    <span class="n">et</span> <span class="o">=</span> <span class="n">ey</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">r1_rad</span><span class="p">)</span> <span class="o">-</span> <span class="n">ex</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">r1_rad</span><span class="p">)</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">er</span><span class="p">,</span> <span class="n">et</span><span class="p">,</span> <span class="n">ez</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transform</span></div>

<div class="viewcode-block" id="global_to_basic_spherical"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.global_to_basic_spherical">[docs]</a><span class="k">def</span> <span class="nf">global_to_basic_spherical</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">xyz_global</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">):</span>
    <span class="n">ex</span><span class="p">,</span> <span class="n">ey</span><span class="p">,</span> <span class="n">ez</span> <span class="o">=</span> <span class="n">_primary_axes</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>

    <span class="n">rtp</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">xyz_global</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">rtp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">rtp</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">sint</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">sinp</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">cosp</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

    <span class="n">er</span> <span class="o">=</span> <span class="n">ex</span> <span class="o">*</span> <span class="n">sint</span> <span class="o">*</span> <span class="n">cosp</span> <span class="o">+</span> \
         <span class="n">ey</span> <span class="o">*</span> <span class="n">sint</span> <span class="o">*</span> <span class="n">sinp</span> <span class="o">+</span> \
         <span class="n">ez</span> <span class="o">*</span> <span class="n">cost</span>
    <span class="n">et</span> <span class="o">=</span> <span class="n">ex</span> <span class="o">*</span> <span class="n">cost</span> <span class="o">*</span> <span class="n">cosp</span> <span class="o">+</span> \
         <span class="n">ey</span> <span class="o">*</span> <span class="n">cost</span> <span class="o">*</span> <span class="n">sinp</span> <span class="o">-</span> \
         <span class="n">ez</span> <span class="o">*</span> <span class="n">sint</span>
    <span class="n">ep</span> <span class="o">=</span> <span class="o">-</span><span class="n">ex</span> <span class="o">*</span> <span class="n">sinp</span> <span class="o">+</span> <span class="n">ey</span> <span class="o">*</span> <span class="n">cosp</span>

    <span class="n">transform</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">er</span><span class="p">,</span> <span class="n">et</span><span class="p">,</span> <span class="n">ep</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">transform</span></div>

<div class="viewcode-block" id="normalize"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.normalize">[docs]</a><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Normalizes v into a unit vector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : (3, ) float ndarray</span>
<span class="sd">        the vector to normalize</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    vn : (3, ) float ndarray</span>
<span class="sd">        normalized v</span>

<span class="sd">    .. math:: v_{norm} = \frac{v}{\lvert v \lvert}</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">norm_v</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">norm_v</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;v=</span><span class="si">%s</span><span class="s1"> norm(v)=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">norm_v</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">v</span> <span class="o">/</span> <span class="n">norm_v</span></div>


<div class="viewcode-block" id="Coord"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord">[docs]</a><span class="k">class</span> <span class="nc">Coord</span><span class="p">(</span><span class="n">BaseCard</span><span class="p">):</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;COORD&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Defines a general CORDxx object&quot;&quot;&quot;</span>
        <span class="c1">#: have all the transformation matricies been determined</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Coord.Cid"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.Cid">[docs]</a>    <span class="k">def</span> <span class="nf">Cid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the coordinate ID&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span></div>

<div class="viewcode-block" id="Coord.setup_global_cord2x"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.setup_global_cord2x">[docs]</a>    <span class="k">def</span> <span class="nf">setup_global_cord2x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets up a global CORD2R, CORD2S, CORD2C&quot;&quot;&quot;</span>
        <span class="c1">#if self.Cid() == 0:</span>
            <span class="c1">#self.origin = np.array([0., 0., 0.], dtype=&#39;float64&#39;)</span>
            <span class="c1">#return</span>
        <span class="c1">#self.i = np.array([1., 0., 0.], dtype=&#39;float64&#39;)</span>
        <span class="c1">#self.j = np.array([0., 1., 0.], dtype=&#39;float64&#39;)</span>
        <span class="c1">#self.k = np.array([0., 0., 1.], dtype=&#39;float64&#39;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e1</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e2</span>
        <span class="n">e3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e3</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># e_{13}</span>
            <span class="n">e13</span> <span class="o">=</span> <span class="n">e3</span> <span class="o">-</span> <span class="n">e1</span>
            <span class="c1"># e_{12}</span>
            <span class="n">e12</span> <span class="o">=</span> <span class="n">e2</span> <span class="o">-</span> <span class="n">e1</span>
            <span class="c1">#print(&quot;e13 = %s&quot; % e13)</span>
            <span class="c1">#print(&quot;e12 = %s&quot; % e12)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">type = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cid  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">())</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e1 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e2 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e3 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e3</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#: k = (G3 cross G1) normalized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">e12</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = normalize(e12)&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># j = (k cross e13) normalized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">e13</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = norm(e12)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j*  = cross(k, e13)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j*  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">e13</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = norm(cross(k, e13))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#: i = j cross k</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rid = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = normalize(e12)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = norm(cross(k,e13))&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">))</span>
            <span class="k">raise</span></div>

        <span class="c1">#print(&#39;done setting up cid=%s rid=%s&#39; % (self.cid, self.Rid()))</span>

<div class="viewcode-block" id="Coord.setup"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. math::</span>
<span class="sd">          e_{13} = e_3 - e_1</span>

<span class="sd">        .. math::</span>
<span class="sd">          e_{12} = e_2 - e_1</span>

<span class="sd">        .. math::</span>
<span class="sd">          k = \frac{e_{12}}{\lvert e_{12} \rvert}</span>

<span class="sd">        .. math::</span>
<span class="sd">          j_{dir} = k \times e_{13}</span>

<span class="sd">        .. math::</span>
<span class="sd">          j = \frac{j_{dir}}{\lvert j_{dir} \rvert}</span>

<span class="sd">        .. math::</span>
<span class="sd">          i = j \times k</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#if self.is_resolved:</span>
            <span class="c1">#return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e1</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e2</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e3</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid Vector Length</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;type = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;cid  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">())</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e1 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e2 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e3 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1">#print(&#39;setting up cid=%s rid=%s&#39; % (self.cid, self.Rid()))</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">]:</span>
            <span class="n">rid_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span>
            <span class="n">rid_ref</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">rid_ref</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Circular Reference: cid=</span><span class="si">%s</span><span class="s1"> rid_trace=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e1</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e2</span>
            <span class="n">e3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rid_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">rid_ref</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">rid_ref</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">e3</span> <span class="o">=</span> <span class="n">rid_ref</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># e_{13}</span>
            <span class="n">e13</span> <span class="o">=</span> <span class="n">e3</span> <span class="o">-</span> <span class="n">e1</span>
            <span class="c1"># e_{12}</span>
            <span class="n">e12</span> <span class="o">=</span> <span class="n">e2</span> <span class="o">-</span> <span class="n">e1</span>
            <span class="c1">#print(&quot;e13 = %s&quot; % e13)</span>
            <span class="c1">#print(&quot;e12 = %s&quot; % e12)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">type = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cid  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">())</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e1 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e2 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e3 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e3</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#: k = (G3 cross G1) normalized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">e12</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = normalize(e12)&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># j = (k cross e13) normalized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">e13</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = norm(e12)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j*  = cross(k, e13)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j*  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">e13</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = norm(cross(k, e13))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#: i = j cross k</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rid = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = normalize(e12)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = norm(cross(k,e13))&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">))</span>
            <span class="k">raise</span>

        <span class="c1">#if 0:</span>
            <span class="c1">#print(&quot;\nCid = %s&quot; % (self.Cid()))</span>
            <span class="c1">#print(&quot;Rid = %s&quot; % (self.Rid()))</span>
            <span class="c1">#print(&quot;e1  = %s&quot; % (self.e1))</span>
            <span class="c1">#print(&quot;e2  = %s&quot; % (self.e2))</span>
            <span class="c1">#print(&quot;e3  = %s&quot; % (self.e3))</span>
            <span class="c1">#print(&quot;e1* = [%g, %g, %g]&quot; % tuple(e1))</span>
            <span class="c1">#print(&quot;e2* = [%g, %g, %g]&quot; % tuple(e2))</span>
            <span class="c1">#print(&quot;e3* = [%g, %g, %g]&quot; % tuple(e3))</span>
            <span class="c1">#print(&#39;-----&#39;)</span>
            <span class="c1">#print(&quot;e13 = %s&quot; % (e13))</span>
            <span class="c1">#print(&quot;e12 = %s&quot; % (e12))</span>
            <span class="c1">#print(&#39;-----&#39;)</span>
            <span class="c1">#print(&quot;i   = %s len=%s&quot;   % (str(self.i), norm(self.i)))</span>
            <span class="c1">#print(&quot;j   = %s len=%s&quot;   % (str(self.j), norm(self.j)))</span>
            <span class="c1">#print(&quot;k   = %s len=%s\n&quot; % (str(self.k), norm(self.k)))</span>
            <span class="c1">#print(&#39;-----&#39;)</span>
        <span class="c1">#print(&#39;done setting up cid=%s rid=%s&#39; % (self.cid, self.Rid()))</span>
        <span class="c1">#print(&#39;cid=%s rid_trace=%s&#39; % (self.cid, self.rid_trace))</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">,</span> <span class="s1">&#39;cid=</span><span class="si">%s</span><span class="s1"> rid_trace=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">)</span></div>

<div class="viewcode-block" id="Coord.setup_no_xref"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.setup_no_xref">[docs]</a>    <span class="k">def</span> <span class="nf">setup_no_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BDF</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        .. math::</span>
<span class="sd">          e_{13} = e_3 - e_1</span>

<span class="sd">        .. math::</span>
<span class="sd">          e_{12} = e_2 - e_1</span>

<span class="sd">        .. math::</span>
<span class="sd">          k = \frac{e_{12}}{\lvert e_{12} \rvert}</span>

<span class="sd">        .. math::</span>
<span class="sd">          j_{dir} = k \times e_{13}</span>

<span class="sd">        .. math::</span>
<span class="sd">          j = \frac{j_{dir}}{\lvert j_{dir} \rvert}</span>

<span class="sd">        .. math::</span>
<span class="sd">          i = j \times k</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e1</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e2</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e3</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Invalid Vector Length</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;type = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;cid  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">())</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e1 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e2 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e3 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1">#print(&#39;setting up cid=%s rid=%s&#39; % (self.cid, self.Rid()))</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">]:</span>
            <span class="n">rid_ref</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
            <span class="n">rid_ref</span><span class="o">.</span><span class="n">setup_no_xref</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">rid_ref</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Circular Reference: cid=</span><span class="si">%s</span><span class="s1"> rid_trace=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e1</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e2</span>
            <span class="n">e3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">e3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rid_ref</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">rid_ref</span><span class="o">.</span><span class="n">transform_node_to_global_no_xref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">rid_ref</span><span class="o">.</span><span class="n">transform_node_to_global_no_xref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
            <span class="n">e3</span> <span class="o">=</span> <span class="n">rid_ref</span><span class="o">.</span><span class="n">transform_node_to_global_no_xref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># e_{13}</span>
            <span class="n">e13</span> <span class="o">=</span> <span class="n">e3</span> <span class="o">-</span> <span class="n">e1</span>
            <span class="c1"># e_{12}</span>
            <span class="n">e12</span> <span class="o">=</span> <span class="n">e2</span> <span class="o">-</span> <span class="n">e1</span>
            <span class="c1">#print(&quot;e13 = %s&quot; % e13)</span>
            <span class="c1">#print(&quot;e12 = %s&quot; % e12)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">type = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cid  = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">())</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e1 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e2 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;e3 = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e3</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#: k = (G3 cross G1) normalized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">e12</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = normalize(e12)&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># j = (k cross e13) normalized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">e13</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3* = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = norm(e12)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j*  = cross(k, e13)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j*  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">e13</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = norm(cross(k, e13))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#: i = j cross k</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---InvalidUnitVectorError---&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cp  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rid = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e1  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e2  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e3  = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e13 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e13</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;e12 = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e12</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = normalize(e12)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;k   = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = norm(cross(k,e13))&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;j   = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">))</span>
            <span class="k">raise</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">,</span> <span class="s1">&#39;cid=</span><span class="si">%s</span><span class="s1"> rid_trace=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">)</span></div>

    <span class="c1">#def transform_force_to_global(self, F, M):</span>
        <span class="c1">#raise NotImplementedError(&#39;transform_force_to_global&#39;)</span>
        <span class="c1">#Fg = self.transform_vector_to_global(self, F)</span>
        <span class="c1">#Mg = self.transform_vector_to_global(self, M)</span>

        <span class="c1">#r = self.origin #  maybe a minus sign?</span>
        <span class="c1">#Mdelta = cross(r, Fg)</span>
        <span class="c1">#return Fg, Mg + Mdelta</span>

    <span class="k">def</span> <span class="nf">transform_vector_to_global_assuming_rectangular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms a vector to the global frame</span>
<span class="sd">        The CBAR/CBEAM y/z vectors use this.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p : (1,3) float ndarray</span>
<span class="sd">            the point in the local frame to be transformed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        p : (1, 3) float ndarray</span>
<span class="sd">            the vector in the global frame</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Local unit vectors haven&#39;t been set.</span><span class="se">\n</span><span class="s2">Type=</span><span class="si">%r</span><span class="s2"> cid=</span><span class="si">%s</span><span class="s2"> rid=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># rotate point p2 from the local frame to the global frame</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span> <span class="o">@</span> <span class="n">matrix</span>
        <span class="k">return</span> <span class="n">p3</span>

<div class="viewcode-block" id="Coord.resolve"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.resolve">[docs]</a>    <span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span><span class="p">:</span>
            <span class="c1">#if self.rid_ref is None and self.rid != 0:</span>
                <span class="c1">#msg = &quot;BDF has not been cross referenced; rid=%s rid_ref:\n%s&quot; % (</span>
                    <span class="c1">#self.rid, self.rid_ref,</span>
                <span class="c1">#)</span>
                <span class="c1">#raise RuntimeError(msg)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">transform_vector_to_global_no_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BDF</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span>

        <span class="c1">#if not self.is_resolved:</span>
            <span class="c1">#if isinstance(self.rid, integer_types) and self.rid != 0:</span>
                <span class="c1">#raise RuntimeError(&quot;BDF has not been cross referenced.&quot;)</span>
            <span class="c1">#if self.type in [&#39;CORD2R&#39;, &#39;CORD2C&#39;, &#39;CORD2S&#39;]:</span>
                <span class="c1">#self.rid_ref.setup()</span>
            <span class="c1">#else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_no_xref</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># the ijk axes arent resolved as R-theta-z, only points</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_to_xyz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Local unit vectors haven&#39;t been set.</span><span class="se">\n</span><span class="s2">Type=</span><span class="si">%r</span><span class="s2"> cid=</span><span class="si">%s</span><span class="s2"> rid=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># rotate point p2 from the local frame to the global frame</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">@</span> <span class="n">matrix</span>
        <span class="k">return</span> <span class="n">p3</span>

    <span class="k">def</span> <span class="nf">transform_vector_to_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms a generalized vector from the local frame to the</span>
<span class="sd">        global frame.  A generalized vector is unchanged when you shift</span>
<span class="sd">        it&#39;s point of application.  So:</span>
<span class="sd">          - Generalized Vectors (Force, Moment about the origin)</span>
<span class="sd">          - Not Generalized Vectors (node xyz, displacement, Moment)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p : (1,3) ndarray</span>
<span class="sd">            the vector in the local frame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        p3 : (1,3) ndarray</span>
<span class="sd">            the vector in the global frame</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Shifting the load application point of a force creates</span>
<span class="sd">        a moment, but the force will be the same.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;ACOORD&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;BDF has not been cross referenced.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

        <span class="c1"># the ijk axes arent resolved as R-theta-z, only points</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_to_xyz</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Local unit vectors haven&#39;t been set.</span><span class="se">\n</span><span class="s2">Type=</span><span class="si">%r</span><span class="s2"> cid=</span><span class="si">%s</span><span class="s2"> rid=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># rotate point p2 from the local frame to the global frame</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">@</span> <span class="n">matrix</span>
        <span class="k">return</span> <span class="n">p3</span>

    <span class="k">def</span> <span class="nf">transform_vector_to_global_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms a generalized vector from the local frame to the</span>
<span class="sd">        global frame.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

        <span class="c1"># the ijk axes arent resolved as R-theta-z, only points</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_to_xyz_array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Local unit vectors haven&#39;t been set.</span><span class="se">\n</span><span class="s2">Type=</span><span class="si">%r</span><span class="s2"> cid=</span><span class="si">%s</span><span class="s2"> rid=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># rotate point p2 from the local frame to the global frame</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">@</span> <span class="n">matrix</span>
        <span class="k">return</span> <span class="n">p3</span>

    <span class="k">def</span> <span class="nf">transform_node_to_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms a point from the local coordinate system to the reference</span>
<span class="sd">        coordinate frames &quot;global&quot; coordinate system.</span>

<span class="sd">        .. math::</span>
<span class="sd">            [p_{global}]_{1\times 3} =</span>
<span class="sd">            [p_{local}]_{1\times 3}[\beta_{ij}]_{3\times 3} + [p_{origin}]</span>

<span class="sd">        where :math:`[\beta]_{ij}` is the transformation matrix</span>

<span class="sd">        .. math::</span>
<span class="sd">          [\beta]_{ij} = \left[</span>
<span class="sd">          \begin{array}{ccc}</span>
<span class="sd">              g_x \cdot i  &amp;  g_x \cdot j  &amp;  g_x \cdot k    \\</span>
<span class="sd">              g_y \cdot i  &amp;  g_y \cdot j  &amp;  g_y \cdot k    \\</span>
<span class="sd">              g_z \cdot i  &amp;  g_z \cdot j  &amp;  g_z \cdot k</span>
<span class="sd">          \end{array} \right]</span>

<span class="sd">        * :math:`g` is the global directional vector (e.g. :math:`g_x = [1,0,0]`)</span>
<span class="sd">        * :math:`ijk` is the math:`i^{th}` direction in the local coordinate system</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : (1,3) float ndarray</span>
<span class="sd">            the point in the local frame to be transformed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz_global : (1,3) float ndarray</span>
<span class="sd">            the point in the global frame</span>

<span class="sd">        .. warning:: make sure you cross-reference before calling this</span>
<span class="sd">        .. warning:: you probably shouldnt call this, call the Node methods</span>
<span class="sd">                     get_position and get_position_wrt</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xyz</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_vector_to_global</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>

    <span class="k">def</span> <span class="nf">transform_node_to_global_no_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BDF</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xyz</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_vector_to_global_no_xref</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>

    <span class="k">def</span> <span class="nf">transform_node_to_global_assuming_rectangular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the point in a coordinate system that has unit vectors</span>
<span class="sd">        in the referenced coordinate system, but is not transformed</span>
<span class="sd">        from a cylindrical/spherical system.  This is used by cards</span>
<span class="sd">        like CBAR/CBEAM for element offset vectors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : (1,3) float ndarray</span>
<span class="sd">            the point in the local frame to be transformed</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (1, 3) float ndarray</span>
<span class="sd">            the position of the GRID in the alternate coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xyz</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_vector_to_global_assuming_rectangular</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="c1">#+ self.origin</span>

    <span class="k">def</span> <span class="nf">_transform_node_to_global_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xyz</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_vector_to_global_array</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>

    <span class="k">def</span> <span class="nf">_transform_node_to_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : (1,3) ndarray</span>
<span class="sd">            the point in the global frame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz_local : (1,3) ndarray</span>
<span class="sd">            the point in the local frame</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Origin=</span><span class="si">%s</span><span class="s1">; Cid=</span><span class="si">%s</span><span class="s1"> Rid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()))</span>
        <span class="n">xyz_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">beta</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">xyz_local</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_to_coord</span><span class="p">(</span><span class="n">xyz_coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xyz_local</span>

    <span class="k">def</span> <span class="nf">_transform_node_to_local_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : (n,3) ndarray</span>
<span class="sd">            the points in the global frame</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz_local : (1,3) ndarray</span>
<span class="sd">            the point in the local frame</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Origin=</span><span class="si">%s</span><span class="s1">; Cid=</span><span class="si">%s</span><span class="s1"> Rid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()))</span>
        <span class="n">xyz_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span> <span class="n">beta</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">xyz_local</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_to_coord_array</span><span class="p">(</span><span class="n">xyz_coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xyz_local</span>

    <span class="k">def</span> <span class="nf">transform_node_to_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms the global point p to the local coordinate system</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : (1,3) ndarray</span>
<span class="sd">            the point to transform</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Uses the matrix as there is no linking from a global</span>
<span class="sd">        coordinate system to the local.</span>

<span class="sd">        The matrix that comes in is the local to global, so we need</span>
<span class="sd">        to invert the matrix. The inverse of the tranformation</span>
<span class="sd">        matrix :math:`[\beta]` is the transpose of the matrix.</span>

<span class="sd">        .. math:: p_{global} = (p_{coord})[\beta] + p_{origin}</span>

<span class="sd">        .. math:: [\beta]^{-1} = [\beta]^T</span>

<span class="sd">        .. math:: p_{coord} = (p_{global} -p_{origin}) [\beta]^T</span>

<span class="sd">        .. math:: p_{local} = transform(p_{coord})</span>

<span class="sd">        Where transform(x) depends on the rectangular, cylindrical, or</span>
<span class="sd">        spherical coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_node_to_local</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform_node_to_local_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms the global point p to the local coordinate system</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_node_to_local_array</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">transform_node_from_local_to_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord_to</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an xyz coordinate in an arbitrary system to a different one</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="n">coord_to</span><span class="o">.</span><span class="n">cid</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xyz</span>
        <span class="n">xyz_global</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">xyz_local</span> <span class="o">=</span> <span class="n">coord_to</span><span class="o">.</span><span class="n">transform_node_to_local</span><span class="p">(</span><span class="n">xyz_global</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xyz_local</span>

    <span class="k">def</span> <span class="nf">transform_node_from_local_to_local_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord_to</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts an xyz coordinate array in an arbitrary system to a different one</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="n">coord_to</span><span class="o">.</span><span class="n">cid</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xyz</span>
        <span class="n">xyz_global</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transform_node_to_global_array</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">xyz_local</span> <span class="o">=</span> <span class="n">coord_to</span><span class="o">.</span><span class="n">transform_node_to_local_array</span><span class="p">(</span><span class="n">xyz_global</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xyz_local</span>

    <span class="k">def</span> <span class="nf">transform_vector_to_local</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        see transform_node_to_local, but set the origin to &lt;0, 0, 0&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">()</span>
        <span class="n">xyz_coord</span> <span class="o">=</span> <span class="n">xyz</span> <span class="o">@</span> <span class="n">beta</span><span class="o">.</span><span class="n">T</span>
        <span class="n">xyz_local</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_to_coord</span><span class="p">(</span><span class="n">xyz_coord</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xyz_local</span>

    <span class="k">def</span> <span class="nf">__properties__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the list of @property attributes&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;global_to_local&#39;</span><span class="p">,</span> <span class="s1">&#39;local_to_global&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">global_to_local</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the 3 x 3 global to local transform</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">local_to_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the 3 x 3 local to global transform</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">()</span>

<div class="viewcode-block" id="Coord.beta"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.beta">[docs]</a>    <span class="k">def</span> <span class="nf">beta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the 3 x 3 transformation</span>

<span class="sd">        .. math:: [\lambda] = [B_{ij}]</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                             <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                             <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="Coord.beta_n"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.beta_n">[docs]</a>    <span class="k">def</span> <span class="nf">beta_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the 3n x 3n transformation</span>

<span class="sd">        .. math:: [\lambda] = [B_{ij}]</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">        .. math:: [K] = [T]^T [Ke] [T]</span>

<span class="sd">        &gt;&gt;&gt; T = beta_n(1)</span>
<span class="sd">        [a1, a2, a3]</span>
<span class="sd">        [b1, b2, b3]</span>
<span class="sd">        [c1, c2, c3]</span>

<span class="sd">        &gt;&gt;&gt; T2 = beta_n(2)</span>
<span class="sd">        [a1, a2, a3, 0, 0, 0]</span>
<span class="sd">        [b1, b2, b3, 0, 0, 0]</span>
<span class="sd">        [c1, c2, c3, 0, 0, 0]</span>
<span class="sd">        [0, 0, 0, a1, a2, a3]</span>
<span class="sd">        [0, 0, 0, b1, b2, b3]</span>
<span class="sd">        [0, 0, 0, c1, c2, c3]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;n=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>  <span class="c1"># transformation matrix</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="Coord._check_square"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord._check_square">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_square</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">assert</span> <span class="n">nx</span> <span class="o">==</span> <span class="n">ny</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;nx=</span><span class="si">{</span><span class="n">nx</span><span class="si">}</span><span class="s1"> ny=</span><span class="si">{</span><span class="n">ny</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">assert</span> <span class="n">nx</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;nx=</span><span class="si">{</span><span class="n">nx</span><span class="si">}</span><span class="s1"> is not a multiple of 3&#39;</span></div>

<div class="viewcode-block" id="Coord.transform_matrix_to_global"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.transform_matrix_to_global">[docs]</a>    <span class="k">def</span> <span class="nf">transform_matrix_to_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_square</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">3</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_n</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">matrix_out</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">matrix</span> <span class="o">@</span> <span class="n">T</span>
        <span class="k">return</span> <span class="n">matrix_out</span></div>

<div class="viewcode-block" id="Coord.transform_matrix_to_global_from_element_coord"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.transform_matrix_to_global_from_element_coord">[docs]</a>    <span class="k">def</span> <span class="nf">transform_matrix_to_global_from_element_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span>
                                                      <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">Tlocal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_square</span><span class="p">(</span><span class="n">Tlocal</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">3</span>

        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta_n</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">@</span> <span class="n">Tlocal</span>
        <span class="n">matrix_out</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">matrix</span> <span class="o">@</span> <span class="n">T</span>
        <span class="k">return</span> <span class="n">matrix_out</span></div>

<div class="viewcode-block" id="Coord.repr_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.repr_fields">[docs]</a>    <span class="k">def</span> <span class="nf">repr_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_fields</span><span class="p">()</span></div>

<div class="viewcode-block" id="Coord.move_origin"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Coord.move_origin">[docs]</a>    <span class="k">def</span> <span class="nf">move_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz</span><span class="p">,</span> <span class="n">maintain_rid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the coordinate system to a new origin while maintaining</span>
<span class="sd">        the orientation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xyz : the new origin point to move the coordinate to in</span>
<span class="sd">              the global coordinate system</span>
<span class="sd">        maintain_rid : bool; default=False</span>
<span class="sd">            set the rid to cid=0 if False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

        <span class="n">xyz</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">xyz</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_e123</span><span class="p">(</span><span class="n">maintain_rid</span><span class="o">=</span><span class="n">maintain_rid</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Cannot move </span><span class="si">%s</span><span class="s1">; cid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">xyz</span></div></div>


<div class="viewcode-block" id="_fix_xyz_shape"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems._fix_xyz_shape">[docs]</a><span class="k">def</span> <span class="nf">_fix_xyz_shape</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;xyz&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks the shape of a grid point location and fixes it if possible</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xyz : (N, 3) float ndarray</span>
<span class="sd">        the xyz locations</span>
<span class="sd">    name : str; default=&#39;xyz&#39;</span>
<span class="sd">        the name in case of an error</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xyz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> must be type ndarray; type=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">xyz</span><span class="p">))</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">xyz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> must be 3 by 1 dim</span><span class="se">\n</span><span class="si">%s</span><span class="s1"> is </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xyz</span></div>


<div class="viewcode-block" id="define_spherical_cutting_plane"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.define_spherical_cutting_plane">[docs]</a><span class="k">def</span> <span class="nf">define_spherical_cutting_plane</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">cids</span><span class="p">,</span> <span class="n">thetas</span><span class="p">,</span> <span class="n">phis</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a series of coordinate systems defined as constant origin,</span>
<span class="sd">    with a series of theta and phi angles, which are defined about the</span>
<span class="sd">    aerodynamic axis &lt;1, 0, 0&gt;.  This is intended to be with a</span>
<span class="sd">    supersonic mach plane for calculating wave drag where:</span>
<span class="sd">        .. math::  \theta = \mu = \frac{1}{\sqrt(Mach^2 - 1)}</span>
<span class="sd">        .. math::  \phi = [-\pi, \pi]</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : BDF()</span>
<span class="sd">        a BDF object</span>
<span class="sd">    origin : (3, ) float ndarray</span>
<span class="sd">        defines the location of the origin in the global coordinate frame</span>
<span class="sd">    rid : int</span>
<span class="sd">        the new spherical reference coordinate system id</span>
<span class="sd">    cids : List[int, ...]</span>
<span class="sd">        list of new coordinate system ids</span>
<span class="sd">    thetas : List[float, ...]</span>
<span class="sd">        list of thetas (in radians)</span>
<span class="sd">    phis:  List[float, ...]</span>
<span class="sd">        list of phis (in radians)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    creates 1 CORD2S and ncid CORD2R coordinate systems</span>

<span class="sd">    .. todo:: hasn&#39;t been tested...</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">thetas</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(cids)=</span><span class="si">%s</span><span class="s1"> len(thetas)=</span><span class="si">%s</span><span class="s1">; must be equal&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cids</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">thetas</span><span class="p">)))</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cids</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">phis</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;len(cids)=</span><span class="si">%s</span><span class="s1"> len(phis)=</span><span class="si">%s</span><span class="s1">; must be equal&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cids</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">phis</span><span class="p">)))</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># check for dupliate coords</span>
    <span class="k">assert</span> <span class="n">rid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coords</span>
    <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">cids</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">cid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">coords</span>

    <span class="c1"># create the spherical coordinate system</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">)</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="n">e3</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
    <span class="n">card</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CORD2S&#39;</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">e3</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">add_card</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">card</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">is_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># create the mach planes</span>
    <span class="k">for</span> <span class="n">cid</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cids</span><span class="p">,</span> <span class="n">thetas</span><span class="p">,</span> <span class="n">phis</span><span class="p">):</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
        <span class="n">e3</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">]</span>
        <span class="n">card</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">+</span> <span class="n">e2</span> <span class="o">+</span> <span class="n">e3</span>
        <span class="n">model</span><span class="o">.</span><span class="n">add_card</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">card</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">is_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="define_coord_e123"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.define_coord_e123">[docs]</a><span class="k">def</span> <span class="nf">define_coord_e123</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">cord2_type</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">xyplane</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yzplane</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a coordinate system based on a defined axis and point on the</span>
<span class="sd">    plane.  This is the generalized version of the CORDx card.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : BDF()</span>
<span class="sd">        a BDF object</span>
<span class="sd">    cord2_type : str</span>
<span class="sd">        &#39;CORD2R&#39;, &#39;CORD2C&#39;, &#39;CORD2S&#39;</span>
<span class="sd">    cid : int</span>
<span class="sd">        the new coordinate system id</span>
<span class="sd">    origin : (3,) ndarray</span>
<span class="sd">         defines the location of the origin in the global coordinate frame</span>
<span class="sd">    rid : int; default=0</span>
<span class="sd">        the new reference coordinate system id</span>
<span class="sd">    xaxis : (3,) ndarray</span>
<span class="sd">        defines the x axis (default=None)</span>
<span class="sd">    yaxis : (3,) ndarray</span>
<span class="sd">        defines the y axis (default=None)</span>
<span class="sd">    zaxis : (3,) ndarray</span>
<span class="sd">        defines the z axis (default=None)</span>
<span class="sd">    add : bool; default=True</span>
<span class="sd">        adds the coordinate system to the model</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    coord : CORD2R, CORD2C, CORD2S</span>
<span class="sd">        the coordinate system</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    One axis (xaxis, yaxis, zaxis) and one plane</span>
<span class="sd">    (xyplane, yzplane, xz plane) must be defined; the others</span>
<span class="sd">    must be None.</span>

<span class="sd">    The axes and planes are defined in the rid coordinate system</span>

<span class="sd">    .. todo:: hasn&#39;t been tested...</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">cord2_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">],</span> <span class="n">cord2_type</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">)</span>
    <span class="n">rcoord</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>

    <span class="c1"># check for overdefined axes</span>
    <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;yaxis=</span><span class="si">%s</span><span class="s1"> zaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">)</span>
        <span class="n">xaxis</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="s1">&#39;xaxis&#39;</span><span class="p">)</span>
        <span class="n">xaxis</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;zaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>
        <span class="n">yaxis</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="s1">&#39;yaxis&#39;</span><span class="p">)</span>
        <span class="n">yaxis</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zaxis</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">zaxis</span><span class="p">,</span> <span class="s1">&#39;zaxis&#39;</span><span class="p">)</span>
        <span class="n">zaxis</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>

    <span class="c1"># check for invalid planes</span>
    <span class="k">if</span> <span class="n">xyplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">yzplane</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xzplane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;yzplane=</span><span class="si">%s</span><span class="s1"> xzplane=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yzplane</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;xaxis=</span><span class="si">%s</span><span class="s1"> yaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="p">)</span>
        <span class="n">xyplane</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">xyplane</span><span class="p">,</span> <span class="s1">&#39;xyplane&#39;</span><span class="p">)</span>
        <span class="n">xyplane</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">xyplane</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">yzplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">xzplane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;xzplane=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xzplane</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;yaxis=</span><span class="si">%s</span><span class="s1"> zaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">)</span>
        <span class="n">yzplane</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">yzplane</span><span class="p">,</span> <span class="s1">&#39;yzplane&#39;</span><span class="p">)</span>
        <span class="n">yzplane</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">yzplane</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;xaxis=</span><span class="si">%s</span><span class="s1"> zaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">)</span>
        <span class="n">xzplane</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">xzplane</span><span class="p">,</span> <span class="s1">&#39;xzplane&#39;</span><span class="p">)</span>
        <span class="n">xzplane</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_global</span><span class="p">(</span><span class="n">xzplane</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xyplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">xaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
            <span class="n">khat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">xyplane</span><span class="p">)</span>  <span class="c1"># xyplane is &quot;defining&quot; yaxis</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">khat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">khat</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">yaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
            <span class="n">khat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">xyplane</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>  <span class="c1"># xyplane is &quot;defining&quot; xaxis</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">khat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">khat</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">yzplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">yaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
            <span class="n">ihat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">yzplane</span><span class="p">)</span>  <span class="c1"># yzplane is &quot;defining&quot; zaxis</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ihat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">ihat</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">zaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>
            <span class="n">ihat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">yzplane</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">)</span>  <span class="c1"># yzplane is &quot;defining&quot; yaxis</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ihat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">ihat</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">xzplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">xaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
            <span class="n">jhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">xzplane</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>  <span class="c1"># xzplane is &quot;defining&quot; zaxis</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">jhat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">jhat</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># standard</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">zaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>
            <span class="n">jhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">)</span> <span class="c1"># xzplane is &quot;defining&quot; xaxis</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">jhat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">jhat</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">define_coord_ijk</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">cord2_type</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">add</span><span class="o">=</span><span class="n">add</span><span class="p">)</span></div>


<div class="viewcode-block" id="define_coord_ijk"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.define_coord_ijk">[docs]</a><span class="k">def</span> <span class="nf">define_coord_ijk</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">cord2_type</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">add</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a coordinate system based on 2 or 3 perpendicular unit vectors</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : BDF()</span>
<span class="sd">        a BDF object</span>
<span class="sd">    cord2_type : str</span>
<span class="sd">        &#39;CORD2R&#39;, &#39;CORD2C&#39;, &#39;CORD2S&#39;</span>
<span class="sd">    cid : int</span>
<span class="sd">        the new coordinate system id</span>
<span class="sd">    origin : (3,) ndarray</span>
<span class="sd">         defines the location of the origin in the global coordinate frame</span>
<span class="sd">    rid : int; default=0</span>
<span class="sd">        the new reference coordinate system id</span>
<span class="sd">    i : (3,) ndarray</span>
<span class="sd">        defines the i unit vector</span>
<span class="sd">    j : (3,) ndarray</span>
<span class="sd">        defines the j unit vector</span>
<span class="sd">    k : (3,) ndarray</span>
<span class="sd">        defines the k unit vector</span>
<span class="sd">    add : bool; default=True</span>
<span class="sd">        adds the coordinate system to the model</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    coord : CORD2R, CORD2C, CORD2S</span>
<span class="sd">        the coordinate system</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">cord2_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">],</span> <span class="n">cord2_type</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">)</span>

    <span class="c1"># create cross vectors</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;i, j and k are None&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># i is defined</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># all 3 vectors are defined</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">k</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;j or k are None; j=</span><span class="si">%s</span><span class="s1"> k=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="c1"># define e1, e2, e3</span>
    <span class="n">rcoord</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="s1">&#39;, which is required to create cid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cid</span><span class="p">)</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_local</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_local</span><span class="p">(</span><span class="n">origin</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span> <span class="c1"># point on z axis</span>
    <span class="n">e3</span> <span class="o">=</span> <span class="n">rcoord</span><span class="o">.</span><span class="n">transform_node_to_local</span><span class="p">(</span><span class="n">origin</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="c1"># point on x-z plane / point on x axis</span>
    <span class="n">card</span> <span class="o">=</span> <span class="p">[</span><span class="n">cord2_type</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">e1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">e2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">e3</span><span class="p">)</span>

    <span class="n">origin</span> <span class="o">=</span> <span class="n">e1</span>
    <span class="n">zaxis</span> <span class="o">=</span> <span class="n">e2</span>
    <span class="n">xzplane</span> <span class="o">=</span> <span class="n">e3</span>
    <span class="k">if</span> <span class="n">cord2_type</span> <span class="o">==</span> <span class="s1">&#39;CORD2R&#39;</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">CORD2R</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cord2_type</span> <span class="o">==</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">CORD2C</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">cord2_type</span> <span class="o">==</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">CORD2S</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">add</span><span class="p">:</span>
        <span class="n">model</span><span class="o">.</span><span class="n">_add_coord_object</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coord</span></div>


<div class="viewcode-block" id="RectangularCoord"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.RectangularCoord">[docs]</a><span class="k">class</span> <span class="nc">RectangularCoord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;defines common methods for rectangular coordinate systems&quot;&quot;&quot;</span>
<div class="viewcode-block" id="RectangularCoord.coord_to_xyz"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.RectangularCoord.coord_to_xyz">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_xyz</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3,) ndarray</span>
<span class="sd">            the point in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="RectangularCoord.xyz_to_coord"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.RectangularCoord.xyz_to_coord">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">xyz_to_coord</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3,) ndarray</span>
<span class="sd">            the delta xyz point in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="RectangularCoord.coord_to_xyz_array"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.RectangularCoord.coord_to_xyz_array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_xyz_array</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (n, 3) ndarray</span>
<span class="sd">            the point in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="RectangularCoord.xyz_to_coord_array"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.RectangularCoord.xyz_to_coord_array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">xyz_to_coord_array</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (n, 3) ndarray</span>
<span class="sd">            the delta xyz point in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="RectangularCoord.global_to_basic"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.RectangularCoord.global_to_basic">[docs]</a>    <span class="k">def</span> <span class="nf">global_to_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_global</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">global_to_basic_rectangular</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_global</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CylindricalCoord"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CylindricalCoord">[docs]</a><span class="k">class</span> <span class="nc">CylindricalCoord</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    defines common methods for cylindrical coordinate systems</span>

<span class="sd">    .. math:: r      = \sqrt(x^2+y^2)</span>
<span class="sd">    .. math:: \theta = tan^{-1}\left(\frac{y}{x}\right)</span>
<span class="sd">    .. math:: z      = z</span>

<span class="sd">    .. math:: x = r cos(\theta)</span>
<span class="sd">    .. math:: y = r sin(\theta)</span>
<span class="sd">    .. math:: z = z</span>
<span class="sd">    .. math:: p = [x,y,z] + e_1</span>

<span class="sd">    http://en.wikipedia.org/wiki/Cylindrical_coordinate_system</span>

<span class="sd">    .. _msc:  http://simcompanion.mscsoftware.com/resources/sites/MSC/content/meta/DOCUMENTATION/9000/DOC9188/~secure/refman.pdf?token=WDkwz5Q6v7LTw9Vb5p+nwkbZMJAxZ4rU6BoR7AHZFxi2Tl1QdrbVvWj00qmcC4+S3fnbL4WUa5ovbpBwGDBt+zFPzsGyYC13zvGPg0j/5SrMF6bnWrQoTGyJb8ho1ROYsm2OqdSA9jVceaFHQVc+tJq4b49VogM4dZBxyi/QrHgdUgPFos8BAL9mgju5WGk8yYcFtRzQIxU=</span>
<span class="sd">    .. seealso:: `MSC Reference Manual (pdf) &lt;`http://simcompanion.mscsoftware.com/resources/sites/MSC/content/meta/DOCUMENTATION/9000/DOC9188/~secure/refman.pdf?token=WDkwz5Q6v7LTw9Vb5p+nwkbZMJAxZ4rU6BoR7AHZFxi2Tl1QdrbVvWj00qmcC4+S3fnbL4WUa5ovbpBwGDBt+zFPzsGyYC13zvGPg0j/5SrMF6bnWrQoTGyJb8ho1ROYsm2OqdSA9jVceaFHQVc+tJq4b49VogM4dZBxyi/QrHgdUgPFos8BAL9mgju5WGk8yYcFtRzQIxU=&gt;`_.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CylindricalCoord.coord_to_xyz"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CylindricalCoord.coord_to_xyz">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_xyz</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ::</span>

<span class="sd">          y       R</span>
<span class="sd">          |     /</span>
<span class="sd">          |   /</span>
<span class="sd">          | / theta</span>
<span class="sd">          *------------x</span>

<span class="sd">        .. math:: x = R \cos(\theta)</span>
<span class="sd">        .. math:: y = R \sin(\theta)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3,) float ndarray</span>
<span class="sd">            the point in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CylindricalCoord.coord_to_xyz_array"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CylindricalCoord.coord_to_xyz_array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_xyz_array</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ::</span>

<span class="sd">          y       R</span>
<span class="sd">          |     /</span>
<span class="sd">          |   /</span>
<span class="sd">          | / theta</span>
<span class="sd">          *------------x</span>

<span class="sd">        .. math:: x = R \cos(\theta)</span>
<span class="sd">        .. math:: y = R \sin(\theta)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3,) float ndarray</span>
<span class="sd">            the point in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rtz_to_xyz_array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="CylindricalCoord.coord_to_spherical"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CylindricalCoord.coord_to_spherical">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_spherical</span><span class="p">(</span><span class="n">rtz</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;R-theta-z to rho-theta-phi transform&quot;&quot;&quot;</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">rtz</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="c1">#if rho == 0.0:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">if</span> <span class="n">rho</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">acos</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">rho</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rho</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CylindricalCoord.coord_to_cylindrical"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CylindricalCoord.coord_to_cylindrical">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_cylindrical</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="CylindricalCoord.xyz_to_coord"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CylindricalCoord.xyz_to_coord">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">xyz_to_coord</span><span class="p">(</span><span class="n">xyz</span><span class="p">:</span> <span class="n">NDArray3float</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3,) float ndarray</span>
<span class="sd">            the delta xyz point in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">xyz</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CylindricalCoord.xyz_to_coord_array"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CylindricalCoord.xyz_to_coord_array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">xyz_to_coord_array</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ::</span>

<span class="sd">          y       R</span>
<span class="sd">          |     /</span>
<span class="sd">          |   /</span>
<span class="sd">          | / theta</span>
<span class="sd">          *------------x</span>

<span class="sd">        .. math:: x = R \cos(\theta)</span>
<span class="sd">        .. math:: y = R \sin(\theta)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        rtp : (3,) float ndarray</span>
<span class="sd">            the point in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">xyz_to_rtz_array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="CylindricalCoord.global_to_basic"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CylindricalCoord.global_to_basic">[docs]</a>    <span class="k">def</span> <span class="nf">global_to_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_global</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">global_to_basic_cylindrical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_global</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SphericalCoord"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.SphericalCoord">[docs]</a><span class="k">class</span> <span class="nc">SphericalCoord</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    defines common methods for spherical coordinate systems</span>

<span class="sd">    .. math:: r = \rho = \sqrt(x^2+y^2+z^2)</span>

<span class="sd">    .. math:: \theta   = \cos^{-1}\left(\frac{z}{r}\right)</span>

<span class="sd">    .. math:: \phi     = \tan^{-1}\left(\frac{y}{x}\right)</span>

<span class="sd">    .. math:: x = r \sin(\theta)\cos(\phi)</span>

<span class="sd">    .. math:: y = r \sin(\theta)\sin(\phi)</span>

<span class="sd">    .. math:: z = r \cos(\theta)</span>

<span class="sd">    .. math:: p = [x,y,z]</span>

<span class="sd">    .. seealso:: http://en.wikipedia.org/wiki/Spherical_coordinate_system</span>

<span class="sd">    .. seealso:: `MSC Reference Manual (pdf) &lt;`http://simcompanion.mscsoftware.com/resources/sites/MSC/content/meta/DOCUMENTATION/9000/DOC9188/~secure/refman.pdf?token=WDkwz5Q6v7LTw9Vb5p+nwkbZMJAxZ4rU6BoR7AHZFxi2Tl1QdrbVvWj00qmcC4+S3fnbL4WUa5ovbpBwGDBt+zFPzsGyYC13zvGPg0j/5SrMF6bnWrQoTGyJb8ho1ROYsm2OqdSA9jVceaFHQVc+tJq4b49VogM4dZBxyi/QrHgdUgPFos8BAL9mgju5WGk8yYcFtRzQIxU=&gt;`_.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SphericalCoord.xyz_to_coord"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.SphericalCoord.xyz_to_coord">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">xyz_to_coord</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3, ) float ndarray</span>
<span class="sd">            the local XYZ point in the R, \theta, \phi coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">R</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">degrees</span><span class="p">(</span><span class="n">acos</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">R</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">R</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphericalCoord.xyz_to_coord_array"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.SphericalCoord.xyz_to_coord_array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">xyz_to_coord_array</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3, ) float ndarray</span>
<span class="sd">            the local XYZ point in the R, \theta, \phi coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">xyz_to_rtp_array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphericalCoord.coord_to_xyz"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.SphericalCoord.coord_to_xyz">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_xyz</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3,) float ndarray</span>
<span class="sd">            the R, \theta, \phi in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphericalCoord.coord_to_xyz_array"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.SphericalCoord.coord_to_xyz_array">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_xyz_array</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        xyz : (3,) float ndarray</span>
<span class="sd">            the R, \theta, \phi in the local coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rtp_to_xyz_array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphericalCoord.coord_to_spherical"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.SphericalCoord.coord_to_spherical">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_spherical</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="SphericalCoord.coord_to_cylindrical"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.SphericalCoord.coord_to_cylindrical">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">coord_to_cylindrical</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;hasn&#39;t been tested&quot;&quot;&quot;</span>
        <span class="n">rho</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span> <span class="o">=</span> <span class="n">p</span>

        <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
        <span class="n">thetar</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">thetar</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">thetar</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">phi</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="SphericalCoord.global_to_basic"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.SphericalCoord.global_to_basic">[docs]</a>    <span class="k">def</span> <span class="nf">global_to_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_global</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">global_to_basic_spherical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_global</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Cord2x"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x">[docs]</a><span class="k">class</span> <span class="nc">Cord2x</span><span class="p">(</span><span class="n">Coord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parent class for:</span>
<span class="sd">     - CORD2R</span>
<span class="sd">     - CORD2C</span>
<span class="sd">     - CORD2S</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">setup</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method emulates the CORD2x card.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            coord id</span>
<span class="sd">        origin : ndarray/None</span>
<span class="sd">            the origin</span>
<span class="sd">            None -&gt; [0., 0., 0.]</span>
<span class="sd">        zaxis : ndarray/None</span>
<span class="sd">            a point on the z-axis</span>
<span class="sd">            None -&gt; [0., 0., 1.]</span>
<span class="sd">        xzplane : ndarray/None</span>
<span class="sd">            a point on the xz-plane</span>
<span class="sd">            None -&gt; [1., 0., 0.]</span>
<span class="sd">        rid : int; default=0</span>
<span class="sd">            reference coord id</span>

<span class="sd">        .. note :: no type checking</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">),</span> <span class="s1">&#39;rid=</span><span class="si">%r</span><span class="s1"> type=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">rid</span><span class="p">))</span>
        <span class="n">Coord</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">=</span> <span class="n">rid</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xzplane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xzplane</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># if setup:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finish_setup</span><span class="p">()</span>

<div class="viewcode-block" id="Cord2x.export_to_hdf5"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.export_to_hdf5">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">export_to_hdf5</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">h5_file</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">cids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;exports the coords in a vectorized way&quot;&quot;&quot;</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">e3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">cids</span><span class="p">:</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span>
            <span class="c1">#comments.append(coord.comment)</span>
            <span class="n">rid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">rid</span><span class="p">)</span>
            <span class="n">e1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span>
            <span class="n">e2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span>
            <span class="n">e3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="o">.</span><span class="n">e3</span><span class="p">)</span>
        <span class="c1">#h5_file.create_dataset(&#39;_comment&#39;, data=comments)</span>
        <span class="n">h5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;cid&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">cids</span><span class="p">)</span>
        <span class="n">h5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;rid&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rid</span><span class="p">)</span>
        <span class="n">h5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;e1&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">e1</span><span class="p">)</span>
        <span class="n">h5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;e2&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">e2</span><span class="p">)</span>
        <span class="n">h5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;e3&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">e3</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord2x.init_from_empty"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.init_from_empty">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">init_from_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">e3</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord2x._add"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x._add">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_add</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="n">rid</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">rid</span>

        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xzplane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xzplane</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span></div>
        <span class="c1">#self._finish_setup()</span>

<div class="viewcode-block" id="Cord2x.add_axes"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.add_axes">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_axes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">xyplane</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yzplane</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a coordinate system based on a defined axis and point on the</span>
<span class="sd">        plane.  This is the generalized version of the CORD2x card.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            the new coordinate system id</span>
<span class="sd">        rid : int; default=0</span>
<span class="sd">            the new reference coordinate system id</span>
<span class="sd">        origin : (3,) ndarray</span>
<span class="sd">             defines the location of the origin in the global coordinate frame</span>
<span class="sd">        xaxis : (3,) ndarray</span>
<span class="sd">            defines the x axis (default=None)</span>
<span class="sd">        yaxis : (3,) ndarray</span>
<span class="sd">            defines the y axis (default=None)</span>
<span class="sd">        zaxis : (3,) ndarray</span>
<span class="sd">            defines the z axis (default=None)</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        One axis (xaxis, yaxis, zaxis) and one plane</span>
<span class="sd">        (xyplane, yzplane, xz plane) must be defined; the others</span>
<span class="sd">        must be None</span>

<span class="sd">        The axes and planes are defined in the rid coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">],</span> <span class="bp">cls</span><span class="o">.</span><span class="n">type</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">)</span>

        <span class="c1"># check for overdefined axes</span>
        <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;yaxis=</span><span class="si">%s</span><span class="s1"> zaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">)</span>
            <span class="n">xaxis</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="s1">&#39;xaxis&#39;</span><span class="p">)</span>
            <span class="n">xaxis</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">coord_to_xyz</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;zaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>
            <span class="n">yaxis</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="s1">&#39;yaxis&#39;</span><span class="p">)</span>
            <span class="n">yaxis</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">coord_to_xyz</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zaxis</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">zaxis</span><span class="p">,</span> <span class="s1">&#39;zaxis&#39;</span><span class="p">)</span>
            <span class="n">zaxis</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">coord_to_xyz</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>

        <span class="c1"># check for invalid planes</span>
        <span class="k">if</span> <span class="n">xyplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">yzplane</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xzplane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;yzplane=</span><span class="si">%s</span><span class="s1"> xzplane=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yzplane</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;xaxis=</span><span class="si">%s</span><span class="s1"> yaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="p">)</span>
            <span class="n">xyplane</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">xyplane</span><span class="p">,</span> <span class="s1">&#39;xyplane&#39;</span><span class="p">)</span>
            <span class="n">xyplane</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">coord_to_xyz</span><span class="p">(</span><span class="n">xyplane</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">yzplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">xzplane</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;xzplane=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xzplane</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;yaxis=</span><span class="si">%s</span><span class="s1"> zaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">)</span>
            <span class="n">yzplane</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">yzplane</span><span class="p">,</span> <span class="s1">&#39;yzplane&#39;</span><span class="p">)</span>
            <span class="n">yzplane</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">coord_to_xyz</span><span class="p">(</span><span class="n">yzplane</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;xaxis=</span><span class="si">%s</span><span class="s1"> zaxis=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">)</span>
            <span class="n">xzplane</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">xzplane</span><span class="p">,</span> <span class="s1">&#39;xzplane&#39;</span><span class="p">)</span>
            <span class="n">xzplane</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">coord_to_xyz</span><span class="p">(</span><span class="n">xzplane</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xyplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">xaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
                <span class="n">khat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">xyplane</span><span class="p">)</span>  <span class="c1"># xyplane is &quot;defining&quot; yaxis</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">khat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">khat</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">yaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
                <span class="n">khat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">xyplane</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>  <span class="c1"># xyplane is &quot;defining&quot; xaxis</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">khat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">khat</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">yzplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">yaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">yaxis</span><span class="p">)</span>
                <span class="n">ihat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">yzplane</span><span class="p">)</span>  <span class="c1"># yzplane is &quot;defining&quot; zaxis</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">ihat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">ihat</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">zaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>
                <span class="n">ihat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">yzplane</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">)</span>  <span class="c1"># yzplane is &quot;defining&quot; yaxis</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">ihat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">ihat</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">xzplane</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">xaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">xaxis</span><span class="p">)</span>
                <span class="n">jhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">xzplane</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>  <span class="c1"># xzplane is &quot;defining&quot; zaxis</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">jhat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">jhat</span><span class="p">)</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">zaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># standard</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">zaxis</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">zaxis</span><span class="p">)</span>
                <span class="n">jhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">)</span> <span class="c1"># xzplane is &quot;defining&quot; xaxis</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">jhat</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">jhat</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">add_ijk</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord2x.add_ijk"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.add_ijk">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_ijk</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a coordinate system based on 2 or 3 perpendicular unit vectors</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            the new coordinate system id</span>
<span class="sd">        origin : (3,) ndarray</span>
<span class="sd">             defines the location of the origin in the global coordinate frame</span>
<span class="sd">        rid : int; default=0</span>
<span class="sd">            the new reference coordinate system id</span>
<span class="sd">        i : (3,) ndarray</span>
<span class="sd">            defines the i unit vector</span>
<span class="sd">        j : (3,) ndarray</span>
<span class="sd">            defines the j unit vector</span>
<span class="sd">        k : (3,) ndarray</span>
<span class="sd">            defines the k unit vector</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">type</span>
        <span class="k">assert</span> <span class="n">Type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="s1">&#39;CORD2S&#39;</span><span class="p">],</span> <span class="n">Type</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">_fix_xyz_shape</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">)</span>

        <span class="c1"># create cross vectors</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;i, j and k are None&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># i is defined</span>
            <span class="k">if</span> <span class="n">j</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># all 3 vectors are defined</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">j</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;j or k are None; j=</span><span class="si">%s</span><span class="s1"> k=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s1">&#39;coordinate vectors arent perpendicular</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;  origin = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;  i = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;  j = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="s1">&#39;  k = </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># origin</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="n">origin</span>
        <span class="c1"># point on z axis</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">k</span>

        <span class="c1"># point on x-z plane / point on x axis</span>
        <span class="n">e3</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_op2_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">e3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">11</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;data = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

<div class="viewcode-block" id="Cord2x.add_card"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.add_card">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_card</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Defines the CORD2x class&quot;&quot;&quot;</span>
        <span class="c1">#: coordinate system ID</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;cid&#39;</span><span class="p">)</span>
        <span class="c1">#: reference coordinate system ID</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">integer_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rid&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1">#: origin in a point relative to the rid coordinate system</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;e1x&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;e1y&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                           <span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;e1z&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)],</span>
                          <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1">#: z-axis in a point relative to the rid coordinate system</span>
        <span class="n">zaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;e2x&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;e2y&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                          <span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;e2z&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)],</span>
                         <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="c1">#: a point on the xz-plane relative to the rid coordinate system</span>
        <span class="n">xzplane</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;e3x&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                            <span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;e3y&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
                            <span class="n">double_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;e3z&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)],</span>
                           <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span></div>
        <span class="c1">#self._finish_setup()</span>

<div class="viewcode-block" id="Cord2x._finish_setup"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x._finish_setup">[docs]</a>    <span class="k">def</span> <span class="nf">_finish_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e2</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">e3</span>

        <span class="c1">#: the global axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span></div>
            <span class="c1">#self.setup_global_cord2x()</span>

    <span class="k">def</span> <span class="nf">_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies all methods for this object work</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xref : bool</span>
<span class="sd">            has this model been cross referenced</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">),</span> <span class="s1">&#39;cid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cid</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">),</span> <span class="s1">&#39;rid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rid</span>

<div class="viewcode-block" id="Cord2x.update"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unused_nid_map</span><span class="p">,</span> <span class="n">cid_map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        maps = {</span>
<span class="sd">            &#39;node&#39; : nid_map,</span>
<span class="sd">            &#39;coord&#39; : cid_map,</span>
<span class="sd">        }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">=</span> <span class="n">cid_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">]</span></div>

<div class="viewcode-block" id="Cord2x.update_e123"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.update_e123">[docs]</a>    <span class="k">def</span> <span class="nf">update_e123</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maintain_rid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If you move the coordinate frame, e1, e2, e3 does not update.</span>
<span class="sd">        This updates the coordinate system.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        maintain_rid : bool; default=False</span>
<span class="sd">            set the rid to cid=0 if False</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">maintain_rid</span><span class="p">:</span>
            <span class="c1">#e1 = self.rid_ref.transform_node_to_global(self.e1)</span>
            <span class="c1">#e2 = self.rid_ref.transform_node_to_global(self.e2)</span>
            <span class="c1">#e3 = self.rid_ref.transform_node_to_global(self.e3)</span>
            <span class="c1">#e12 = e2 - e1</span>
            <span class="c1">#e13 = e3 - e1</span>
            <span class="c1">#self.e1 = self.rid_ref.transform_node_to_local(xyz)</span>
            <span class="c1">#self.e2 = self.rid_ref.transform_node_to_local(xyz + e12)</span>
            <span class="c1">#self.e3 = self.rid_ref.transform_node_to_local(xyz + e13)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;this method is very confusing...xyz is not defined...is that origin?&#39;</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#beta = self.beta()</span>
        <span class="c1">#self.e1 = copy.deepcopy(self.origin)</span>
        <span class="c1">#self.e2 = self.origin + beta[2, :]</span>
        <span class="c1">#self.e3 = self.origin + beta[0, :]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span></div>

<div class="viewcode-block" id="Cord2x.write_card"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.write_card">[docs]</a>    <span class="k">def</span> <span class="nf">write_card</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">is_double</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr_fields</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_8</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_double</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_double</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_16</span><span class="p">(</span><span class="n">card</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord2x.write_card_16"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.write_card_16">[docs]</a>    <span class="k">def</span> <span class="nf">write_card_16</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_double</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Writes a CORD2x card in 16-field format&quot;&quot;&quot;</span>
        <span class="n">card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr_fields</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">is_double</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_double</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_16</span><span class="p">(</span><span class="n">card</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord2x.cross_reference"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.cross_reference">[docs]</a>    <span class="k">def</span> <span class="nf">cross_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cross links the card so referenced cards can be extracted directly</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : BDF()</span>
<span class="sd">            the BDF object</span>

<span class="sd">        .. warning:: Doesn&#39;t set rid to the coordinate system if it&#39;s in the</span>
<span class="sd">                    global.  This isn&#39;t a problem.  It&#39;s meant to speed up the</span>
<span class="sd">                    code in order to resolve extra coordinate systems.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;, which is required by </span><span class="si">%s</span><span class="s1"> cid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord2x.uncross_reference"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.uncross_reference">[docs]</a>    <span class="k">def</span> <span class="nf">uncross_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Removes cross-reference links&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Cord2x.Rid"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord2x.Rid">[docs]</a>    <span class="k">def</span> <span class="nf">Rid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the reference coordinate system self.rid&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span><span class="o">.</span><span class="n">cid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span></div></div>


<div class="viewcode-block" id="Cord1x"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x">[docs]</a><span class="k">class</span> <span class="nc">Cord1x</span><span class="p">(</span><span class="n">Coord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parent class for:</span>
<span class="sd">     - CORD1R</span>
<span class="sd">     - CORD1C</span>
<span class="sd">     - CORD1S</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rid</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># used only for transform to global</span>

<div class="viewcode-block" id="Cord1x.export_to_hdf5"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.export_to_hdf5">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">export_to_hdf5</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">h5_file</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">cids</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;exports the coords in a vectorized way&quot;&quot;&quot;</span>
        <span class="n">unused_comments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cid</span> <span class="ow">in</span> <span class="n">cids</span><span class="p">:</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span>
            <span class="c1">#comments.append(coord.comment)</span>
            <span class="n">nodes</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">coord</span><span class="o">.</span><span class="n">g1</span><span class="p">,</span> <span class="n">coord</span><span class="o">.</span><span class="n">g2</span><span class="p">,</span> <span class="n">coord</span><span class="o">.</span><span class="n">g3</span><span class="p">])</span>
        <span class="c1">#h5_file.create_dataset(&#39;_comment&#39;, data=comments)</span>
        <span class="n">h5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;cid&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">cids</span><span class="p">)</span>
        <span class="n">h5_file</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;nodes&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord1x.Rid"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.Rid">[docs]</a>    <span class="k">def</span> <span class="nf">Rid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the reference coordinate system self.rid&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the CORD1R, CORD1C, CORD1S card</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            the coordinate id</span>
<span class="sd">        g1, g2, g3 : int</span>
<span class="sd">            grid point 1, 2, 3</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Coord</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>

        <span class="c1">#: the coordinate ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
        <span class="c1">#: a Node at the origin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="n">g1</span>
        <span class="c1">#: a Node on the z-axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2</span> <span class="o">=</span> <span class="n">g2</span>
        <span class="c1">#: a Node on the xz-plane</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3</span> <span class="o">=</span> <span class="n">g3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Cord1x.validate"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord1x.add_card"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.add_card">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_card</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">icard</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        card : BDF()</span>
<span class="sd">            a BDFCard object</span>
<span class="sd">        icard : int</span>
<span class="sd">            the coordinate location on the line</span>
<span class="sd">            (there are possibly 2 coordinates on 1 card)</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#self.is_resolved = False</span>
        <span class="k">assert</span> <span class="n">icard</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;icard=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">icard</span><span class="p">)</span>
        <span class="n">ncoord</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">icard</span>  <span class="c1"># 0 if the 1st coord, 4 if the 2nd</span>

        <span class="n">cid</span> <span class="o">=</span> <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ncoord</span><span class="p">,</span> <span class="s1">&#39;cid&#39;</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ncoord</span><span class="p">,</span> <span class="s1">&#39;g1&#39;</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">ncoord</span><span class="p">,</span> <span class="s1">&#39;g2&#39;</span><span class="p">)</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">ncoord</span><span class="p">,</span> <span class="s1">&#39;g3&#39;</span><span class="p">)</span>

        <span class="c1">#self.e1 = None</span>
        <span class="c1">#self.e2 = None</span>
        <span class="c1">#self.e3 = None</span>
        <span class="c1">#self.i = None</span>
        <span class="c1">#self.j = None</span>
        <span class="c1">#self.k = None</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_op2_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;data = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

<div class="viewcode-block" id="Cord1x.to_cord2x"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.to_cord2x">[docs]</a>    <span class="k">def</span> <span class="nf">to_cord2x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts a coordinate system from a CORD1x to a CORD2x</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : BDF()</span>
<span class="sd">            a BDF model</span>
<span class="sd">        rid : int; default=0</span>
<span class="sd">            The relative coordinate system</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rid1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">()</span>
        <span class="n">rid2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">()</span>
        <span class="n">rid3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">()</span>

        <span class="c1"># assume the points are in rid</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span><span class="o">.</span><span class="n">xyz</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">xyz</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span><span class="o">.</span><span class="n">xyz</span>

        <span class="c1"># move the nodes in necessary into rid system</span>
        <span class="k">if</span> <span class="n">rid</span> <span class="o">!=</span> <span class="n">rid1</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span><span class="o">.</span><span class="n">get_position_wrt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">rid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rid</span> <span class="o">!=</span> <span class="n">rid2</span><span class="p">:</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">get_position_wrt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">rid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rid</span> <span class="o">!=</span> <span class="n">rid3</span><span class="p">:</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span><span class="o">.</span><span class="n">get_position_wrt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">rid</span><span class="p">)</span>

        <span class="n">type1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>
        <span class="c1">#data = [type1, self.cid, rid1, list(p1) + list(p2) + list(p3)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;CORD1R&#39;</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">CORD2R</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;CORD1C&#39;</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">CORD2C</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;CORD1S&#39;</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">CORD2S</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;coordinate type of </span><span class="se">\n</span><span class="si">%s</span><span class="s1"> is </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">type1</span><span class="p">))</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid1</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">p1</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="n">p2</span><span class="p">,</span> <span class="n">xzplane</span><span class="o">=</span><span class="n">p3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="n">coord</span>
        <span class="k">return</span> <span class="n">coord</span></div>

    <span class="k">def</span> <span class="nf">_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies all methods for this object work</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xref : bool</span>
<span class="sd">            has this model been cross referenced</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">),</span> <span class="s1">&#39;cid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cid</span>

<div class="viewcode-block" id="Cord1x.cross_reference"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.cross_reference">[docs]</a>    <span class="k">def</span> <span class="nf">cross_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cross links the card so referenced cards can be extracted directly</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : BDF()</span>
<span class="sd">            the BDF object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;, which is required by </span><span class="si">%s</span><span class="s1"> cid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
        <span class="c1">#: grid point 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1">#: grid point 2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g2</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1">#: grid point 3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g3</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord1x.uncross_reference"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.uncross_reference">[docs]</a>    <span class="k">def</span> <span class="nf">uncross_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Removes cross-reference links&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G1</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G3</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Cord1x.setup"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds the position of the nodes used define the coordinate system</span>
<span class="sd">        and sets the ijk vectors</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span><span class="o">.</span><span class="n">cp_ref</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">cp_ref</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span><span class="o">.</span><span class="n">cp_ref</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rid_trace</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span><span class="o">.</span><span class="n">Cp</span><span class="p">())</span>

        <span class="c1">#: the origin in the local frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>

        <span class="c1">#: a point on the z-axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>

        <span class="c1">#: a point on the xz-plane</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">e3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>

        <span class="c1"># rid is resolved b/c e1, e2, &amp; e3 are in global coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1">#print(&#39;setting up cid=%s&#39; % self.cid)</span>
        <span class="c1"># call the Coord class&#39; setup method</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Cord1x</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_resolved</span> <span class="o">=</span> <span class="kc">True</span></div>
        <span class="c1">#print(&#39;cid=%s rid_trace=%s&#39; % (self.cid, self.rid_trace))</span>

<div class="viewcode-block" id="Cord1x.G1"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.G1">[docs]</a>    <span class="k">def</span> <span class="nf">G1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1_ref</span><span class="o">.</span><span class="n">nid</span></div>

<div class="viewcode-block" id="Cord1x.G2"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.G2">[docs]</a>    <span class="k">def</span> <span class="nf">G2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g2</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2_ref</span><span class="o">.</span><span class="n">nid</span></div>

<div class="viewcode-block" id="Cord1x.G3"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.G3">[docs]</a>    <span class="k">def</span> <span class="nf">G3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g3</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g3_ref</span><span class="o">.</span><span class="n">nid</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">node_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the integers for the node [g1,g2,g3]&quot;&quot;&quot;</span>
        <span class="n">grids</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">G1</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">G3</span><span class="p">()]</span>
        <span class="k">return</span> <span class="n">grids</span>

<div class="viewcode-block" id="Cord1x.write_card"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.write_card">[docs]</a>    <span class="k">def</span> <span class="nf">write_card</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">is_double</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr_fields</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_8</span><span class="p">(</span><span class="n">card</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cord1x.write_card_16"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.Cord1x.write_card_16">[docs]</a>    <span class="k">def</span> <span class="nf">write_card_16</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_double</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Writes a CORD1x card in 16-field format&quot;&quot;&quot;</span>
        <span class="n">card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr_fields</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">is_double</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_double</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_16</span><span class="p">(</span><span class="n">card</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GMCORD"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.GMCORD">[docs]</a><span class="k">class</span> <span class="nc">GMCORD</span><span class="p">(</span><span class="n">BaseCard</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;defines the GMCOORD class</span>

<span class="sd">    GMCORD | CID | ENTITY | ID1 | ID2 |</span>
<span class="sd">    GMCORD | 101 | GMCURV |  26 |  44 |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;GMCORD&#39;</span>

<div class="viewcode-block" id="GMCORD._init_from_empty"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.GMCORD._init_from_empty">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_init_from_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="s1">&#39;GMCURV&#39;</span>
        <span class="n">gm_ids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">34</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">GMCORD</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">gm_ids</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">gm_ids</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a GMCOORD&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">comment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">entity</span> <span class="o">=</span> <span class="n">entity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gm_ids</span> <span class="o">=</span> <span class="n">gm_ids</span>

<div class="viewcode-block" id="GMCORD.add_card"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.GMCORD.add_card">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_card</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a GMCORD card from ``BDF.add_card(...)``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        card : BDFCard()</span>
<span class="sd">            a BDFCard object</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;cid&#39;</span><span class="p">)</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;entity&#39;</span><span class="p">)</span>
        <span class="n">gm_ids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;GM_ID1&#39;</span><span class="p">),</span>
            <span class="n">integer_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;GM_ID2&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">GMCORD</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">gm_ids</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span></div>

<div class="viewcode-block" id="GMCORD.cross_reference"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.GMCORD.cross_reference">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cross_reference</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">BDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GMCORD.uncross_reference"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.GMCORD.uncross_reference">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">uncross_reference</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Removes cross-reference links&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GMCORD.setup"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.GMCORD.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="GMCORD.raw_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.GMCORD.raw_fields">[docs]</a>    <span class="k">def</span> <span class="nf">raw_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">list_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GMCORD&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">gm_ids</span>
        <span class="k">return</span> <span class="n">list_fields</span></div>

<div class="viewcode-block" id="GMCORD.write_card"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.GMCORD.write_card">[docs]</a>    <span class="k">def</span> <span class="nf">write_card</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">is_double</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">card</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr_fields</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">+</span> <span class="n">print_card_8</span><span class="p">(</span><span class="n">card</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CORD3G"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G">[docs]</a><span class="k">class</span> <span class="nc">CORD3G</span><span class="p">(</span><span class="n">Coord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines a general coordinate system using three rotational angles as</span>
<span class="sd">    functions of coordinate values in the reference coordinate system.</span>
<span class="sd">    The CORD3G entry is used with the MAT9 entry to orient material principal</span>
<span class="sd">    axes for 3-D composite analysis.</span>

<span class="sd">    +--------+-----+--------+------+----------+----------+----------+--------+</span>
<span class="sd">    |    1   |  2  |    3   |   4  |    5     |     6    |     7    |    8   |</span>
<span class="sd">    +========+=====+========+======+==========+==========+==========+========+</span>
<span class="sd">    | CORD3G | CID | METHOD | FORM | THETAID1 | THETAID2 | THETAID3 | CIDREF |</span>
<span class="sd">    +--------+-----+--------+------+----------+----------+----------+--------+</span>
<span class="sd">    | CORD3G | 100 |  E313  | EQN  |    110   |    111   |    112   |   0    |</span>
<span class="sd">    +--------+-----+--------+------+----------+----------+----------+--------+</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;CORD3G&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">method_es</span><span class="p">,</span> <span class="n">method_int</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">thetas</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the CORD3G card</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            coordinate system id</span>
<span class="sd">        method_es : str</span>
<span class="sd">            flag for coordinate system type</span>
<span class="sd">            E : Eularian?</span>
<span class="sd">            S : Space?</span>
<span class="sd">        method_int : int</span>
<span class="sd">            0-1000</span>
<span class="sd">            E1000 = &#39;E&#39; + 1000</span>
<span class="sd">        form : str</span>
<span class="sd">            EQN</span>
<span class="sd">        thetas : List[int]</span>
<span class="sd">            ???</span>
<span class="sd">        rid : int</span>
<span class="sd">            the referenced coordinate system that defines the system the</span>
<span class="sd">            vectors???</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Coord</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">comment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cid</span> <span class="o">=</span> <span class="n">cid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_es</span> <span class="o">=</span> <span class="n">method_es</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_int</span> <span class="o">=</span> <span class="n">method_int</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="o">=</span> <span class="n">form</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thetas</span> <span class="o">=</span> <span class="n">thetas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">=</span> <span class="n">rid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_int</span> <span class="o">&lt;</span> <span class="mi">1000</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;thetas=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thetas</span><span class="p">)</span>

        <span class="c1"># EQN for DEQATN, TABLE for TABLE3D</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;EQN&#39;</span><span class="p">,</span> <span class="s1">&#39;TABLE&#39;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_es</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="c1"># Euler / Space-Fixed</span>
        <span class="n">smethod</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">method_int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">smethod</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;method=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method_es</span><span class="si">}{</span><span class="n">method_int</span><span class="si">}</span><span class="s2">&#39; must be of the form E123 or S123&quot;</span>

    <span class="c1">#@classmethod</span>
    <span class="c1">#def add_op2_data(cls, data, comment=&#39;&#39;):</span>
        <span class="c1">#raise NotImplementedError(data)</span>

<div class="viewcode-block" id="CORD3G.add_card"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.add_card">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_card</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">card</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a CORD3G card from ``BDF.add_card(...)``</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        card : BDFCard()</span>
<span class="sd">            a BDFCard object</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;cid&#39;</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">string_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;E313&#39;</span><span class="p">)</span>
        <span class="n">method_es</span> <span class="o">=</span> <span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">method_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">method</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="n">form</span> <span class="o">=</span> <span class="n">string_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="s1">&#39;EQN&#39;</span><span class="p">)</span>
        <span class="n">thetas</span> <span class="o">=</span> <span class="p">[</span><span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;theta1&#39;</span><span class="p">),</span>
                  <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;theta2&#39;</span><span class="p">),</span>
                  <span class="n">integer</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;theta3&#39;</span><span class="p">)]</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">integer_or_blank</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;cidRef&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">card</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;len(CORD3G card) = </span><span class="si">%i</span><span class="se">\n</span><span class="s1">card=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">card</span><span class="p">),</span> <span class="n">card</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CORD3G</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">method_es</span><span class="p">,</span> <span class="n">method_int</span><span class="p">,</span> <span class="n">form</span><span class="p">,</span> <span class="n">thetas</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span>
                      <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span></div>

<div class="viewcode-block" id="CORD3G.cross_reference"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.cross_reference">[docs]</a>    <span class="k">def</span> <span class="nf">cross_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BDF</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cross links the card so referenced cards can be extracted directly</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model : BDF()</span>
<span class="sd">            the BDF object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;, which is required by CORD3G cid=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Coord</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rid</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="CORD3G.uncross_reference"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.uncross_reference">[docs]</a>    <span class="k">def</span> <span class="nf">uncross_reference</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Removes cross-reference links&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="CORD3G.Rid"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.Rid">[docs]</a>    <span class="k">def</span> <span class="nf">Rid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid_ref</span><span class="o">.</span><span class="n">cid</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rid</span></div>

<div class="viewcode-block" id="CORD3G.coord3g_transform_to_global"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.coord3g_transform_to_global">[docs]</a>    <span class="k">def</span> <span class="nf">coord3g_transform_to_global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        p : (3,) float ndarray</span>
<span class="sd">            the point to transform</span>

<span class="sd">        .. warning:: not done, just setting up how you&#39;d do this</span>
<span class="sd">        .. note::    per http://en.wikipedia.org/wiki/Euler_angles</span>

<span class="sd">         &quot;This means for example that a convention named (YXZ) is the result</span>
<span class="sd">         of performing first an intrinsic Z rotation, followed by X and</span>
<span class="sd">         Y rotations, in the moving axes (Note: the order of multiplication</span>
<span class="sd">         of matrices is the opposite of the order in which they&#39;re</span>
<span class="sd">         applied to a vector).&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_es</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
            <span class="n">rotations</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method_int</span><span class="p">)]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rotations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetas</span><span class="p">):</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
                <span class="n">st</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">theta</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_x</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span> <span class="o">@</span> <span class="n">p</span>
                <span class="k">elif</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_y</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span> <span class="o">@</span> <span class="n">p</span>
                <span class="k">elif</span> <span class="n">rotation</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation_z</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="n">st</span><span class="p">)</span> <span class="o">@</span> <span class="n">p</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rotation=</span><span class="si">{</span><span class="n">rotation</span><span class="si">!r}</span><span class="s1"> rotations=</span><span class="si">{</span><span class="n">rotations</span><span class="si">!r}</span><span class="s1"> method_int=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method_int</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_es</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Space-Fixed rotation hasn&#39;t been implemented&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Invalid method; Use Euler or Space-Fixed.  &#39;</span>
                               <span class="sa">f</span><span class="s1">&#39;method_es=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">method_es</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="CORD3G.rotation_x"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.rotation_x">[docs]</a>    <span class="k">def</span> <span class="nf">rotation_x</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">st</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">ct</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="n">st</span><span class="p">],</span>
                           <span class="p">[</span><span class="o">-</span><span class="n">st</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ct</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="CORD3G.rotation_y"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.rotation_y">[docs]</a>    <span class="k">def</span> <span class="nf">rotation_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">st</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ct</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">st</span><span class="p">],</span>
                           <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                           <span class="p">[</span><span class="o">-</span><span class="n">st</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">ct</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="CORD3G.rotation_z"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.rotation_z">[docs]</a>    <span class="k">def</span> <span class="nf">rotation_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="n">st</span><span class="p">):</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ct</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                           <span class="p">[</span><span class="o">-</span><span class="n">st</span><span class="p">,</span> <span class="n">ct</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span>
                           <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">matrix</span></div>

<div class="viewcode-block" id="CORD3G.raw_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD3G.raw_fields">[docs]</a>    <span class="k">def</span> <span class="nf">raw_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_es</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method_int</span><span class="p">)</span>
        <span class="n">list_fields</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;CORD3G&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">form</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">thetas</span> <span class="o">+</span>
                       <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">list_fields</span></div></div>


<div class="viewcode-block" id="CORD1R"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD1R">[docs]</a><span class="k">class</span> <span class="nc">CORD1R</span><span class="p">(</span><span class="n">Cord1x</span><span class="p">,</span> <span class="n">RectangularCoord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intilizes the CORD1R</span>

<span class="sd">    +-------+------+-----+-----+------+------+-----+------+</span>
<span class="sd">    |   1   |   2  |  3  |  4  |   5  |  6   |  7  |  8   |</span>
<span class="sd">    +=======+======+=====+=====+======+======+=====+======+</span>
<span class="sd">    |CORD1R | CIDA | G1A | G2A | CIDB | G1B  | G2B | G3B  |</span>
<span class="sd">    +-------+------+-----+-----+------+------+-----+------+</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;CORD1R&#39;</span>
    <span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;R&#39;</span>
    <span class="n">int_type</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the CORD1R card, which defines a rectangular coordinate</span>
<span class="sd">        system using 3 GRID points.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            the coordinate id</span>
<span class="sd">        g1, g2, g3 : int</span>
<span class="sd">            grid point 1, 2, 3</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Cord1x</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

<div class="viewcode-block" id="CORD1R.raw_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD1R.raw_fields">[docs]</a>    <span class="k">def</span> <span class="nf">raw_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">list_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CORD1R&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span>
        <span class="k">return</span> <span class="n">list_fields</span></div></div>


<div class="viewcode-block" id="CORD1C"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD1C">[docs]</a><span class="k">class</span> <span class="nc">CORD1C</span><span class="p">(</span><span class="n">Cord1x</span><span class="p">,</span> <span class="n">CylindricalCoord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intilizes the CORD1C</span>

<span class="sd">    +-------+------+-----+-----+------+------+-----+------+</span>
<span class="sd">    |   1   |   2  |  3  |  4  |   5  |  6   |  7  |  8   |</span>
<span class="sd">    +=======+======+=====+=====+======+======+=====+======+</span>
<span class="sd">    |CORD1C | CIDA | G1A | G2A | CIDB | G1B  | G2B | G3B  |</span>
<span class="sd">    +-------+------+-----+-----+------+------+-----+------+</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;CORD1C&#39;</span>
    <span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the CORD1C card, which defines a cylindrical coordinate</span>
<span class="sd">        system using 3 GRID points.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            the coordinate id</span>
<span class="sd">        g1, g2, g3 : int</span>
<span class="sd">            grid point 1, 2, 3</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Cord1x</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

    <span class="c1">#@classmethod</span>
    <span class="c1">#def add_op2_data(cls, data, comment):</span>
        <span class="c1">#self.cid = data[0]</span>
        <span class="c1">#self.g1 = data[1]</span>
        <span class="c1">#self.g2 = data[2]</span>
        <span class="c1">#self.g3 = data[3]</span>
        <span class="c1">#assert len(data) == 4, &#39;data = %s&#39; % (data)</span>
        <span class="c1">#bbbb</span>

<div class="viewcode-block" id="CORD1C.raw_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD1C.raw_fields">[docs]</a>    <span class="k">def</span> <span class="nf">raw_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">list_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CORD1C&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span>
        <span class="k">return</span> <span class="n">list_fields</span></div></div>


<div class="viewcode-block" id="CORD1S"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD1S">[docs]</a><span class="k">class</span> <span class="nc">CORD1S</span><span class="p">(</span><span class="n">Cord1x</span><span class="p">,</span> <span class="n">SphericalCoord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intilizes the CORD1S</span>

<span class="sd">    +-------+------+-----+-----+------+------+-----+------+</span>
<span class="sd">    |   1   |   2  |  3  |  4  |   5  |  6   |  7  |  8   |</span>
<span class="sd">    +=======+======+=====+=====+======+======+=====+======+</span>
<span class="sd">    |CORD1S | CIDA | G1A | G2A | CIDB | G1B  | G2B | G3B  |</span>
<span class="sd">    +-------+------+-----+-----+------+------+-----+------+</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;CORD1S&#39;</span>
    <span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the CORD1S card, which defines a spherical coordinate</span>
<span class="sd">        system using 3 GRID points.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            the coordinate id</span>
<span class="sd">        g1, g2, g3 : int</span>
<span class="sd">            grid point 1, 2, 3</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Cord1x</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

<div class="viewcode-block" id="CORD1S.raw_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD1S.raw_fields">[docs]</a>    <span class="k">def</span> <span class="nf">raw_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">list_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CORD1S&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span>
        <span class="k">return</span> <span class="n">list_fields</span></div></div>


<div class="viewcode-block" id="CORD2R"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD2R">[docs]</a><span class="k">class</span> <span class="nc">CORD2R</span><span class="p">(</span><span class="n">Cord2x</span><span class="p">,</span> <span class="n">RectangularCoord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intilizes the CORD2R</span>

<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>
<span class="sd">    |    1   |   2 |  3  |  4  |  5 |  6  |  7 |  8 |</span>
<span class="sd">    +========+=====+=====+=====+====+=====+====+====+</span>
<span class="sd">    | CORD2R | CID | RID | A1  | A2 | A3  | B1 | B2 |</span>
<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>
<span class="sd">    |        | B3  | C1  | C2  | C3 |     |    |    |</span>
<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>

<span class="sd">    .. note :: no type checking</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;CORD2R&#39;</span>
    <span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;R&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the CORD2R card, which defines a rectangular coordinate</span>
<span class="sd">        system using 3 vectors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            coordinate system id</span>
<span class="sd">        origin : List[float, float, float]</span>
<span class="sd">            the origin of the coordinate system</span>
<span class="sd">        zaxis : List[float, float, float]</span>
<span class="sd">            the z-axis of the coordinate system</span>
<span class="sd">        xzplane : List[float, float, float]</span>
<span class="sd">            a point on the xz plane</span>
<span class="sd">        rid : int; default=0</span>
<span class="sd">            the referenced coordinate system that defines the system the</span>
<span class="sd">            vectors</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Cord2x</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verifies all methods for this object work</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xref : bool</span>
<span class="sd">            has this model been cross referenced</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Cid</span><span class="p">()</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cid</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">),</span> <span class="s1">&#39;cid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cid</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">),</span> <span class="s1">&#39;rid=</span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rid</span>

<div class="viewcode-block" id="CORD2R.raw_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD2R.raw_fields">[docs]</a>    <span class="k">def</span> <span class="nf">raw_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">set_blank_if_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">list_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CORD2R&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">list_fields</span></div></div>


<div class="viewcode-block" id="CORD2C"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD2C">[docs]</a><span class="k">class</span> <span class="nc">CORD2C</span><span class="p">(</span><span class="n">Cord2x</span><span class="p">,</span> <span class="n">CylindricalCoord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intilizes the CORD2C</span>

<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>
<span class="sd">    |    1   |   2 |  3  |  4  |  5 |  6  |  7 |  8 |</span>
<span class="sd">    +========+=====+=====+=====+====+=====+====+====+</span>
<span class="sd">    | CORD2C | CID | RID | A1  | A2 | A3  | B1 | B2 |</span>
<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>
<span class="sd">    |        | B3  | C1  | C2  | C3 |     |    |    |</span>
<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;CORD2C&#39;</span>
    <span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the CORD2C card, which defines a cylindrical coordinate</span>
<span class="sd">        system using 3 vectors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            coordinate system id</span>
<span class="sd">        origin : List[float, float, float]</span>
<span class="sd">            the origin of the coordinate system</span>
<span class="sd">        zaxis : List[float, float, float]</span>
<span class="sd">            the z-axis of the coordinate system</span>
<span class="sd">        xzplane : List[float, float, float]</span>
<span class="sd">            a point on the xz plane</span>
<span class="sd">        rid : int; default=0</span>
<span class="sd">            the referenced coordinate system that defines the system the</span>
<span class="sd">            vectors</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Cord2x</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

<div class="viewcode-block" id="CORD2C.raw_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD2C.raw_fields">[docs]</a>    <span class="k">def</span> <span class="nf">raw_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">set_blank_if_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">list_fields</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;CORD2C&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span> <span class="o">+</span>
                       <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">list_fields</span></div></div>


<div class="viewcode-block" id="CORD2S"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD2S">[docs]</a><span class="k">class</span> <span class="nc">CORD2S</span><span class="p">(</span><span class="n">Cord2x</span><span class="p">,</span> <span class="n">SphericalCoord</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intilizes the CORD2S</span>

<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>
<span class="sd">    |    1   |   2 |  3  |  4  |  5 |  6  |  7 |  8 |</span>
<span class="sd">    +========+=====+=====+=====+====+=====+====+====+</span>
<span class="sd">    | CORD2S | CID | RID | A1  | A2 | A3  | B1 | B2 |</span>
<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>
<span class="sd">    |        | B3  | C1  | C2  | C3 |     |    |    |</span>
<span class="sd">    +--------+-----+-----+-----+----+-----+----+----+</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;CORD2S&#39;</span>
    <span class="n">Type</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the CORD2C card, which defines a spherical coordinate</span>
<span class="sd">        system using 3 vectors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cid : int</span>
<span class="sd">            coordinate system id</span>
<span class="sd">        origin : List[float, float, float]</span>
<span class="sd">            the origin of the coordinate system</span>
<span class="sd">        zaxis : List[float, float, float]</span>
<span class="sd">            the z-axis of the coordinate system</span>
<span class="sd">        xzplane : List[float, float, float]</span>
<span class="sd">            a point on the xz plane</span>
<span class="sd">        rid : int; default=0</span>
<span class="sd">            the referenced coordinate system that defines the system the</span>
<span class="sd">            vectors</span>
<span class="sd">        comment : str; default=&#39;&#39;</span>
<span class="sd">            a comment for the card</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Cord2x</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>

<div class="viewcode-block" id="CORD2S.raw_fields"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.CORD2S.raw_fields">[docs]</a>    <span class="k">def</span> <span class="nf">raw_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">set_blank_if_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Rid</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">list_fields</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;CORD2S&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span> <span class="n">rid</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e1</span><span class="p">)</span> <span class="o">+</span>
                       <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e2</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">e3</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">list_fields</span></div></div>


<div class="viewcode-block" id="create_coords_along_line"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.create_coords_along_line">[docs]</a><span class="k">def</span> <span class="nf">create_coords_along_line</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">percents</span><span class="p">,</span> <span class="n">cid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a series of coordinate systems</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : BDF()</span>
<span class="sd">        the model</span>
<span class="sd">    p1 : (3,) float ndarray</span>
<span class="sd">        the start point</span>
<span class="sd">    p2 : (3,) float ndarray</span>
<span class="sd">        the end point</span>
<span class="sd">    percents : (ncoords, ) float ndarray</span>
<span class="sd">        the location of the coords (0. to 1.; inclusive)</span>
<span class="sd">    cid : int; default=0</span>
<span class="sd">        the reference coordinate system</span>
<span class="sd">    axis : int; default=1</span>
<span class="sd">        the axis normal to the plane; defines the &quot;x&quot; axis</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xyz_cid0 : (nnodes, 3) float ndarray</span>
<span class="sd">        the xyz locations the global (basic) coordinate system</span>
<span class="sd">    nid_cp_cd : (nnodes, 3) int ndarray</span>
<span class="sd">       the node_id, cp coord, cd coord</span>
<span class="sd">    icd_transform : ???</span>
<span class="sd">       a mapping of the cid to nids???</span>
<span class="sd">    cids : List[int]</span>
<span class="sd">        the created coordinate system ids</span>
<span class="sd">    origins : List[(ox, oy, oz)]</span>
<span class="sd">        the origin of each coordinate system</span>
<span class="sd">    cid_to_inids : Dict[cid] -&gt; inids</span>
<span class="sd">        maps the coord id to the index of the nodes along the axis</span>
<span class="sd">        cid : int</span>
<span class="sd">           the coord id</span>
<span class="sd">        inids : (nnodes_in_cid)</span>

<span class="sd">    Warnings</span>
<span class="sd">    --------</span>
<span class="sd">     - requires at least 1 node</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cid</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">cids</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">origins</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># x axis, yz plane</span>
        <span class="n">z_axisi</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
        <span class="n">xz_planei</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># xz plane, y axis</span>
        <span class="n">z_axisi</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
        <span class="n">xz_planei</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># xy plane, z axis</span>
        <span class="n">z_axisi</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span>
        <span class="n">xz_planei</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">z_axisi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">z_axisi</span><span class="p">)</span>
    <span class="n">xz_planei</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xz_planei</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">unused_icid</span><span class="p">,</span> <span class="n">percent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">percents</span><span class="p">):</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">percent</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">percent</span><span class="p">)</span> <span class="o">*</span> <span class="n">p2</span>
        <span class="n">zaxis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span> <span class="o">+</span> <span class="n">z_axisi</span>

        <span class="c1"># let&#39;s put the torque down the axis of the wing</span>
        <span class="c1"># (x-axis, but globally the y-axis), so we add a</span>
        <span class="c1"># point in the y-axis</span>
        <span class="n">xzplane</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">xz_planei</span>

        <span class="c1">#print(&#39;origin = %s&#39; % origin)</span>
        <span class="c1">#print(&#39;zaxis = %s&#39; % zaxis)</span>
        <span class="c1">#print(&#39;xzplane = %s&#39; % xzplane)</span>
        <span class="n">unused_coord</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">add_cord2r</span><span class="p">(</span>
            <span class="n">cid</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">zaxis</span><span class="p">,</span> <span class="n">xzplane</span><span class="p">,</span> <span class="n">rid</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">cids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
        <span class="n">origins</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
        <span class="n">cid</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">cids</span></div>

<div class="viewcode-block" id="get_nodes_along_axis_in_coords"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.get_nodes_along_axis_in_coords">[docs]</a><span class="k">def</span> <span class="nf">get_nodes_along_axis_in_coords</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">nids</span><span class="p">,</span> <span class="n">xyz_cp</span><span class="p">,</span> <span class="n">icp_transform</span><span class="p">,</span> <span class="n">cids</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : BDF()</span>
<span class="sd">        the model</span>
<span class="sd">    nids : (nnodes, ) ndarray</span>
<span class="sd">        the nodes of the model</span>
<span class="sd">    xyz_cp : (nnodes, 3) float ndarray</span>
<span class="sd">        the xyz locations in a representative local coordinate system</span>
<span class="sd">        for example, for cid=0, use xyz_cid0</span>
<span class="sd">    icp_transform : Dict[cp cid] -&gt; inids</span>
<span class="sd">       a mapping of the CP coord to the node indices</span>
<span class="sd">    icd_transform : Dict[cd cid] -&gt; inids</span>
<span class="sd">       a mapping of the CD coord to the node indices</span>
<span class="sd">    cids : List[int]</span>
<span class="sd">        the created coordinate system ids</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    #origins : List[(ox, oy, oz)]</span>
<span class="sd">        #the origin of each coordinate system</span>
<span class="sd">    cid_to_inids : Dict[cid] -&gt; inids</span>
<span class="sd">        maps the coord id to the index of the nodes along the axis</span>
<span class="sd">        cid : int</span>
<span class="sd">           the coord id</span>
<span class="sd">        inids : (nnodes_in_cid)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># setup the cutting planes</span>
    <span class="c1"># down the axis from the outboard to the inboard</span>
    <span class="n">cid_to_inids</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">icid</span><span class="p">,</span> <span class="n">cid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cids</span><span class="p">):</span> <span class="c1"># 114 cids</span>
        <span class="c1">#origin = origins[icid]</span>
        <span class="c1">#origin = model.coords[cid].origin</span>

        <span class="n">xyz_cid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform_xyzcp_to_xyz_cid</span><span class="p">(</span><span class="n">xyz_cp</span><span class="p">,</span> <span class="n">nids</span><span class="p">,</span> <span class="n">icp_transform</span><span class="p">,</span>
                                                   <span class="n">cid</span><span class="o">=</span><span class="n">cid</span><span class="p">,</span> <span class="n">in_place</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
        <span class="n">xvalues_raw</span> <span class="o">=</span> <span class="n">xyz_cid</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">inids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xvalues_raw</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cid_to_inids</span><span class="p">[</span><span class="n">cid</span><span class="p">]</span> <span class="o">=</span> <span class="n">inids</span>
        <span class="n">model</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;nnodes[icid=</span><span class="si">%3s</span><span class="s1">, cid=</span><span class="si">%s</span><span class="s1">] = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">icid</span><span class="p">,</span> <span class="n">cid</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inids</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">cid_to_inids</span></div>

<div class="viewcode-block" id="transform_coords_vectorized"><a class="viewcode-back" href="../../../../reference/bdf/cards/pyNastran.bdf.cards.coordinate_systems.html#pyNastran.bdf.cards.coordinate_systems.transform_coords_vectorized">[docs]</a><span class="k">def</span> <span class="nf">transform_coords_vectorized</span><span class="p">(</span><span class="n">cps_to_check0</span><span class="p">,</span> <span class="n">icp_transform</span><span class="p">,</span>
                                <span class="n">nids</span><span class="p">,</span> <span class="n">xyz_cp</span><span class="p">,</span> <span class="n">xyz_cid0</span><span class="p">,</span> <span class="n">xyz_cid0_correct</span><span class="p">,</span>
                                <span class="n">coords</span><span class="p">,</span> <span class="n">do_checks</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transforms coordinates in a vectorized way</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cps_to_check0 : List[int]</span>
<span class="sd">        the Cps to check</span>
<span class="sd">    icp_transform : dict{int cp : (n,) int ndarray}</span>
<span class="sd">        Dictionary from coordinate id to index of the nodes in</span>
<span class="sd">        ``self.point_ids`` that their input (`CP`) in that</span>
<span class="sd">        coordinate system.</span>
<span class="sd">    nids : (n, ) int ndarray</span>
<span class="sd">        the GRID/SPOINT/EPOINT ids corresponding to xyz_cp</span>
<span class="sd">    xyz_cp : (n, 3) float ndarray</span>
<span class="sd">        points in the CP coordinate system</span>
<span class="sd">    xyz_cid : (n, 3) float ndarray</span>
<span class="sd">        points in the CID coordinate system</span>
<span class="sd">    xyz_cid_correct : (n, 3) float ndarray</span>
<span class="sd">        points in the CID coordinate system</span>
<span class="sd">    unused_in_place : bool, default=False</span>
<span class="sd">        If true the original xyz_cp is modified, otherwise a</span>
<span class="sd">        new one is created.</span>
<span class="sd">    do_checks : bool; default=False</span>
<span class="sd">        internal value for testing</span>
<span class="sd">        True : makes use of xyz_cid_correct</span>
<span class="sd">        False : xyz_cid_correct is unused</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    nids_checked : (nnodes_checked,) int ndarray</span>
<span class="sd">       the node ids that were checked</span>
<span class="sd">    cps_checked : List[int]</span>
<span class="sd">        the Cps that were checked</span>
<span class="sd">    cps_to_check : List[int]</span>
<span class="sd">        the Cps that are unreferenceable given the current information</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cps_to_check</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">cps_checked</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nids_checked</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">cps_to_check0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cps_to_check0</span>
    <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="n">cps_to_check0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">icp_transform</span><span class="p">:</span>
                <span class="n">inode</span> <span class="o">=</span> <span class="n">icp_transform</span><span class="p">[</span><span class="n">cp</span><span class="p">]</span>
                <span class="n">nids_checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nids</span><span class="p">[</span><span class="n">inode</span><span class="p">])</span>
                <span class="c1">#print(&quot;  cp=%s used in a transform (CORD2R)...done&quot; % (cp))</span>
            <span class="c1">#else:</span>
                <span class="c1">#print(&quot;  cp=%s not used in a transform (CORD2R)...done&quot; % (cp))</span>
            <span class="c1">#print(&#39;***nids_checked=%s&#39; % nids[inode])</span>
            <span class="c1">#xyz_cid0[inode, :] = xyz_cp[inode, :]</span>
            <span class="k">continue</span>

        <span class="n">coord</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">cp</span><span class="p">]</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">origin</span>

        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># the coord has not been xref&#39;d, so add it to cps_to_check</span>
            <span class="c1">#if self.is_bdf_vectorized:</span>
                <span class="c1">#assert in_place is False, &#39;in_place=%r must be False for vectorized&#39; % in_place</span>
            <span class="c1">#else:</span>
                <span class="c1">#raise RuntimeError(&#39;you must cross-reference the nodes&#39;)</span>

            <span class="n">cps_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cp</span> <span class="ow">in</span> <span class="n">icp_transform</span><span class="p">:</span>
                <span class="n">inode</span> <span class="o">=</span> <span class="n">icp_transform</span><span class="p">[</span><span class="n">cp</span><span class="p">]</span>
                <span class="n">xyz_cid0</span><span class="p">[</span><span class="n">inode</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="c1">#print(&quot;  cp=%s used, but not done (%s)...&quot; % (cp, coord.type))</span>
            <span class="k">continue</span>

        <span class="n">cps_checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="c1">#is_beta = np.diagonal(beta).min() != 1.</span>
        <span class="c1">#is_origin = np.abs(coord.origin).max() != 0.</span>

        <span class="k">if</span> <span class="n">cp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">icp_transform</span><span class="p">:</span>
            <span class="c1"># we may need coordinate system, but it&#39;s not explicitly used</span>
            <span class="c1"># in the list of GRID CP coordinate systems</span>
            <span class="c1">#print(&quot;  cp=%s not used in a transform (%s)...done&quot; % (cp, coord.type))</span>
            <span class="k">continue</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">beta</span><span class="p">()</span>
        <span class="n">inode</span> <span class="o">=</span> <span class="n">icp_transform</span><span class="p">[</span><span class="n">cp</span><span class="p">]</span>
        <span class="n">nids_checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nids</span><span class="p">[</span><span class="n">inode</span><span class="p">])</span>
        <span class="c1">#print(&#39;***nids_checked=%s&#39; % nids[inode])</span>
        <span class="n">xyzi</span> <span class="o">=</span> <span class="n">coord</span><span class="o">.</span><span class="n">coord_to_xyz_array</span><span class="p">(</span><span class="n">xyz_cp</span><span class="p">[</span><span class="n">inode</span><span class="p">,</span> <span class="p">:])</span>
        <span class="c1">#try:</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">xyzi</span> <span class="o">@</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">origin</span>
        <span class="c1">#except TypeError:</span>
            <span class="c1">#msg = &#39;Bad Math...\n&#39;</span>
            <span class="c1">#msg += &#39;%s\n&#39; % coord.rstrip()</span>
            <span class="c1">#msg += &#39;  origin = %s\n&#39; % origin</span>
            <span class="c1">#msg += &#39;  i = %s\n&#39; % coord.i</span>
            <span class="c1">#msg += &#39;  j = %s\n&#39; % coord.j</span>
            <span class="c1">#msg += &#39;  k = %s\n&#39; % coord.k</span>
            <span class="c1">#msg += &#39;  beta = \n%s&#39; % beta</span>
            <span class="c1">#self.log.error(msg)</span>
            <span class="c1">#raise</span>

        <span class="n">xyz_cid0</span><span class="p">[</span><span class="n">inode</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">new</span>
        <span class="k">if</span> <span class="n">do_checks</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">xyz_cid0_correct</span><span class="p">[</span><span class="n">inode</span><span class="p">,</span> <span class="p">:],</span> <span class="n">new</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;xyz_cid0:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                   <span class="s1">&#39;xyz_cid0_correct:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span>
                   <span class="s1">&#39;inode=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xyz_cid0</span><span class="p">[</span><span class="n">inode</span><span class="p">,</span> <span class="p">:],</span> <span class="n">xyz_cid0_correct</span><span class="p">[</span><span class="n">inode</span><span class="p">,</span> <span class="p">:],</span>
                                 <span class="n">inode</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1">#elif is_beta:</span>
            <span class="c1">#xyz_cid0[inode, :] = xyzi @ beta</span>
        <span class="c1">#else:</span>
            <span class="c1">#xyz_cid0[inode, :] = xyzi + coord.origin</span>
    <span class="c1">#print(&#39;nids_checkedA =&#39;, nids_checked)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nids_checked</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nids_checked</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">nids_checked</span> <span class="o">=</span> <span class="n">nids_checked</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># this is already sorted because icp_transform is sorted</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nids_checked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">nids_checked</span><span class="p">)</span>
        <span class="n">nids_checked</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">nids_checked</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nids_checked</span>
    <span class="n">cps_to_check</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">nids_checked</span><span class="p">,</span> <span class="n">cps_checked</span><span class="p">,</span> <span class="n">cps_to_check</span></div>

<span class="n">CORDx</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">CORD1R</span><span class="p">,</span> <span class="n">CORD1C</span><span class="p">,</span> <span class="n">CORD1S</span><span class="p">,</span> <span class="n">CORD2R</span><span class="p">,</span> <span class="n">CORD2C</span><span class="p">,</span> <span class="n">CORD2S</span><span class="p">]</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Steven Doyle.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>