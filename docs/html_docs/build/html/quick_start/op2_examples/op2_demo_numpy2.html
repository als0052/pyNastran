

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>OP2 Numpy Demo #2 (Composite Plate Stress) &mdash; pyNastran 1.4-dev 1.4-dev documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/my_theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Transient DataFrames in PyNastran" href="op2_pandas_DataFrames.html" />
    <link rel="prev" title="OP2 Numpy Demo #1 (Displacement, Solid Stress)" href="op2_demo_numpy1.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pyNastran 1.4-dev
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Quick Start</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#bdf">BDF</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#op2">OP2</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../op2_overview.html">OP2 Overview</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="op2_demos.html">OP2 Demos</a></li>
<li class="toctree-l4"><a class="reference internal" href="op2_examples.html">OP2 Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../test_op2.html">test_op2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#op4">OP4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#gui">GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#other">Other</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to/index.html">How To: pyNastran</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/pyNastran.html">pyNastran Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../manual/index.html">pyNastran Manual</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pyNastran 1.4-dev</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Quick Start</a> &raquo;</li>
        
          <li><a href="../op2_overview.html">OP2 Overview</a> &raquo;</li>
        
          <li><a href="op2_demos.html">OP2 Demos</a> &raquo;</li>
        
      <li>OP2 Numpy Demo #2 (Composite Plate Stress)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/quick_start/op2_examples/op2_demo_numpy2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="op2-numpy-demo-2-composite-plate-stress">
<h1>OP2 Numpy Demo #2 (Composite Plate Stress)<a class="headerlink" href="#op2-numpy-demo-2-composite-plate-stress" title="Permalink to this headline">¶</a></h1>
<p>The Jupyter notebook for this demo can be found in: -
docs/quick_start/demo/op2_demo_numpy1.ipynb -
<a class="reference external" href="https://github.com/SteveDoyle2/pyNastran/tree/master/docs/quick_start/demo/op2_demo_numpy1.ipynb">https://github.com/SteveDoyle2/pyNastran/tree/master/docs/quick_start/demo/op2_demo_numpy1.ipynb</a></p>
<p>It’s recommended that you first go through: -
<a class="reference external" href="https://github.com/SteveDoyle2/pyNastran/tree/master/docs/quick_start/demo/op2_demo.ipynb">https://github.com/SteveDoyle2/pyNastran/tree/master/docs/quick_start/demo/op2_demo.ipynb</a>
-
<a class="reference external" href="https://github.com/SteveDoyle2/pyNastran/tree/master/docs/quick_start/demo/op2_demo_numpy1.ipynb">https://github.com/SteveDoyle2/pyNastran/tree/master/docs/quick_start/demo/op2_demo_numpy1.ipynb</a></p>
<p>In this tutorial, composite plate stresses will be covered.</p>
<div class="section" id="load-the-model">
<h2>Load the model<a class="headerlink" href="#load-the-model" title="Permalink to this headline">¶</a></h2>
<div class="figure align-default" id="id1">
<img alt="image.png" src="quick_start/op2_examples/attachment:image.png" />
<p class="caption"><span class="caption-text">image.png</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>If the BWB example OP2 doesn’t exist, we’ll run Nastran to create it.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pyNastran</span>
<span class="kn">from</span> <span class="nn">pyNastran.op2.op2</span> <span class="kn">import</span> <span class="n">read_op2</span>
<span class="kn">from</span> <span class="nn">pyNastran.utils.nastran_utils</span> <span class="kn">import</span> <span class="n">run_nastran</span>
<span class="n">pkg_path</span> <span class="o">=</span> <span class="n">pyNastran</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pkg_path</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">)</span>

<span class="n">bdf_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="s1">&#39;bwb&#39;</span><span class="p">,</span> <span class="s1">&#39;bwb_saero.bdf&#39;</span><span class="p">)</span>
<span class="n">op2_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="s1">&#39;bwb&#39;</span><span class="p">,</span> <span class="s1">&#39;bwb_saero.op2&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">op2_filename</span><span class="p">):</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;scr=yes&#39;</span><span class="p">,</span> <span class="s1">&#39;bat=no&#39;</span><span class="p">,</span> <span class="s1">&#39;old=no&#39;</span><span class="p">]</span>
    <span class="n">run_nastran</span><span class="p">(</span><span class="n">bdf_filename</span><span class="p">,</span> <span class="n">nastran_cmd</span><span class="o">=</span><span class="s1">&#39;nastran&#39;</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">keywords</span><span class="p">,</span> <span class="n">run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">shutil</span>
    <span class="n">op2_filename2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;bwb_saero.op2&#39;</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">op2_filename2</span><span class="p">,</span> <span class="n">op2_filename</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">op2_filename</span><span class="p">),</span> <span class="n">print_bad_path</span><span class="p">(</span><span class="n">op2_filename</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">read_op2</span><span class="p">(</span><span class="n">op2_filename</span><span class="p">,</span> <span class="n">build_dataframe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">get_op2_stats</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
<text style=color:green>INFO:    op2_scalar.py:1588           op2_filename = 'c:\\nasa\\m4\\formats\\git\\pynastran\\pyNastran\\..\\models\\bwb\\bwb_saero.op2'
</text><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">op2_results</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">cbar_force</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">op2_results</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">ctria3_force</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">op2_results</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">cquad4_force</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">displacements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">spc_forces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">grid_point_forces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">cbar_stress</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">cbar_strain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">cquad4_composite_stress</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ctria3_composite_stress</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">cquad4_composite_strain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ctria3_composite_strain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="accessing-the-composite-stress">
<h2>Accessing the Composite Stress<a class="headerlink" href="#accessing-the-composite-stress" title="Permalink to this headline">¶</a></h2>
<p>Let’s get the max principal stress.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isubcase</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">stress</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cquad4_composite_stress</span><span class="p">[</span><span class="n">isubcase</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">get_headers</span><span class="p">()</span>
<span class="n">imax</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;major&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span><span class="o">=</span><span class="n">RealCompositePlateStressArray</span> <span class="n">nelements</span><span class="o">=</span><span class="mi">9236</span> <span class="n">ntotal</span><span class="o">=</span><span class="mi">92360</span>
<span class="n">data</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">ntotal</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span> <span class="n">where</span> <span class="mi">9</span><span class="o">=</span><span class="p">[</span><span class="n">o11</span><span class="p">,</span> <span class="n">o22</span><span class="p">,</span> <span class="n">t12</span><span class="p">,</span> <span class="n">t1z</span><span class="p">,</span> <span class="n">t2z</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">max_shear</span><span class="p">]</span>
<span class="n">element_layer</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">92360</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">92360</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="n">element</span> <span class="nb">type</span><span class="p">:</span> <span class="n">QUAD4LC</span><span class="o">-</span><span class="n">composite</span><span class="o">-</span><span class="mi">95</span>
<span class="n">sort1</span>
<span class="n">lsdvmns</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Composite Stress/Strain data is tricky to access as there is not a good way to index the data. Let’s cheat a bit using the element ids and layers to make a pivot table.</p>
<ul class="simple">
<li><strong>table</strong> is (ntimes, nelements, nlayers, ndata)</li>
<li><strong>max_principal_stress_table</strong> is (nelements, nlayers)</li>
</ul>
<div class="figure align-default" id="id2">
<img alt="image.png" src="quick_start/op2_examples/attachment:image.png" />
<p class="caption"><span class="caption-text">image.png</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Element, Layer&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">stress</span><span class="o">.</span><span class="n">element_layer</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Element</span><span class="p">,</span> <span class="n">Layer</span>
<span class="p">[[</span> <span class="mi">1001</span>     <span class="mi">1</span><span class="p">]</span>
 <span class="p">[</span> <span class="mi">1001</span>     <span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span> <span class="mi">1001</span>     <span class="mi">3</span><span class="p">]</span>
 <span class="o">...</span>
 <span class="p">[</span><span class="mi">22050</span>     <span class="mi">8</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">22050</span>     <span class="mi">9</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">22050</span>    <span class="mi">10</span><span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyNastran.femutils.utils</span> <span class="kn">import</span> <span class="n">pivot_table</span>

<span class="c1">## now pivot the stress</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">element_layer</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">layers</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">element_layer</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">table</span><span class="p">,</span> <span class="n">rows_new</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">(</span><span class="n">stress</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">eids</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>

<span class="c1"># now access the max principal stress for the static result</span>
<span class="c1"># table is (itime, nelements, nlayers, data)</span>
<span class="n">itime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_principal_stress_table</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">itime</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">imax</span><span class="p">]</span>
<span class="n">ueids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">eids</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;max_principal_stress_table:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">max_principal_stress_table</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_principal_stress_table</span><span class="p">:</span>
<span class="p">[[</span> <span class="mf">239.3</span>   <span class="mf">163.91</span>   <span class="mf">98.41</span> <span class="o">...</span>  <span class="o">-</span><span class="mf">35.77</span>  <span class="o">-</span><span class="mf">34.6</span>   <span class="o">-</span><span class="mf">19.86</span><span class="p">]</span>
 <span class="p">[</span>  <span class="mf">18.61</span>   <span class="mf">78.52</span>   <span class="mf">25.52</span> <span class="o">...</span>  <span class="o">-</span><span class="mf">63.92</span>  <span class="o">-</span><span class="mf">62.48</span>  <span class="o">-</span><span class="mf">12.99</span><span class="p">]</span>
 <span class="p">[</span>   <span class="mf">2.99</span>  <span class="mf">105.48</span>   <span class="mf">49.37</span> <span class="o">...</span> <span class="o">-</span><span class="mf">137.74</span> <span class="o">-</span><span class="mf">127.07</span>  <span class="o">-</span><span class="mf">41.14</span><span class="p">]</span>
 <span class="o">...</span>
 <span class="p">[</span> <span class="mf">157.</span>    <span class="mf">170.3</span>   <span class="mf">112.79</span> <span class="o">...</span>   <span class="mf">44.56</span>   <span class="mf">47.13</span>   <span class="mf">38.9</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">123.96</span>  <span class="mf">143.01</span>   <span class="mf">97.41</span> <span class="o">...</span>   <span class="mf">40.99</span>   <span class="mf">44.06</span>   <span class="mf">42.47</span><span class="p">]</span>
 <span class="p">[</span>  <span class="mf">90.04</span>  <span class="mf">109.97</span>   <span class="mf">79.86</span> <span class="o">...</span>   <span class="mf">33.18</span>   <span class="mf">36.12</span>   <span class="mf">24.04</span><span class="p">]]</span>
</pre></div>
</div>
<div class="section" id="more-realistic-pivot-table">
<h3>More realistic pivot table<a class="headerlink" href="#more-realistic-pivot-table" title="Permalink to this headline">¶</a></h3>
<p>All the elements have 10 layers. Let’s remove the last 5 layers of the last element. By having empty layers, the pivot table now has nan data in it.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># drop out 5 layers</span>
<span class="n">eids2</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">element_layer</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">layers2</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">element_layer</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">data2</span> <span class="o">=</span> <span class="n">stress</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="p">:]</span>

<span class="c1"># now pivot the stress</span>
<span class="n">table</span><span class="p">,</span> <span class="n">rows_new</span> <span class="o">=</span> <span class="n">pivot_table</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span> <span class="n">eids2</span><span class="p">,</span> <span class="n">layers2</span><span class="p">)</span>

<span class="c1"># access the table data</span>
<span class="c1"># table is (itime, nelements, nlayers, data)</span>
<span class="n">itime</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_principal_stress_table2</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">itime</span><span class="p">,:,:,</span><span class="n">imax</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;max_principal_stress_table2:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">max_principal_stress_table2</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_principal_stress_table2</span><span class="p">:</span>
<span class="p">[[</span> <span class="mf">239.3</span>   <span class="mf">163.91</span>   <span class="mf">98.41</span> <span class="o">...</span>  <span class="o">-</span><span class="mf">35.77</span>  <span class="o">-</span><span class="mf">34.6</span>   <span class="o">-</span><span class="mf">19.86</span><span class="p">]</span>
 <span class="p">[</span>  <span class="mf">18.61</span>   <span class="mf">78.52</span>   <span class="mf">25.52</span> <span class="o">...</span>  <span class="o">-</span><span class="mf">63.92</span>  <span class="o">-</span><span class="mf">62.48</span>  <span class="o">-</span><span class="mf">12.99</span><span class="p">]</span>
 <span class="p">[</span>   <span class="mf">2.99</span>  <span class="mf">105.48</span>   <span class="mf">49.37</span> <span class="o">...</span> <span class="o">-</span><span class="mf">137.74</span> <span class="o">-</span><span class="mf">127.07</span>  <span class="o">-</span><span class="mf">41.14</span><span class="p">]</span>
 <span class="o">...</span>
 <span class="p">[</span> <span class="mf">157.</span>    <span class="mf">170.3</span>   <span class="mf">112.79</span> <span class="o">...</span>   <span class="mf">44.56</span>   <span class="mf">47.13</span>   <span class="mf">38.9</span> <span class="p">]</span>
 <span class="p">[</span> <span class="mf">123.96</span>  <span class="mf">143.01</span>   <span class="mf">97.41</span> <span class="o">...</span>   <span class="mf">40.99</span>   <span class="mf">44.06</span>   <span class="mf">42.47</span><span class="p">]</span>
 <span class="p">[</span>  <span class="mf">90.04</span>  <span class="mf">109.97</span>   <span class="mf">79.86</span> <span class="o">...</span>     <span class="n">nan</span>     <span class="n">nan</span>     <span class="n">nan</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="grid-point-forces-interface-loads">
<h2>Grid Point Forces - Interface Loads<a class="headerlink" href="#grid-point-forces-interface-loads" title="Permalink to this headline">¶</a></h2>
<p>We need some more data from the geometry</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyNastran</span>
<span class="kn">from</span> <span class="nn">pyNastran.bdf.bdf</span> <span class="kn">import</span> <span class="n">read_bdf</span>
<span class="n">bdf_model</span> <span class="o">=</span> <span class="n">read_bdf</span><span class="p">(</span><span class="n">bdf_filename</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="n">bdf_model</span><span class="o">.</span><span class="n">get_displacement_index_xyz_cp_cd</span><span class="p">()</span>
<span class="n">icd_transform</span><span class="p">,</span> <span class="n">icp_transform</span><span class="p">,</span> <span class="n">xyz_cp</span><span class="p">,</span> <span class="n">nid_cp_cd</span> <span class="o">=</span> <span class="n">out</span>
<span class="n">nids</span> <span class="o">=</span> <span class="n">nid_cp_cd</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">nid_cd</span> <span class="o">=</span> <span class="n">nid_cp_cd</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
<span class="n">xyz_cid0</span> <span class="o">=</span> <span class="n">bdf_model</span><span class="o">.</span><span class="n">transform_xyzcp_to_xyz_cid</span><span class="p">(</span>
    <span class="n">xyz_cp</span><span class="p">,</span> <span class="n">nids</span><span class="p">,</span> <span class="n">icp_transform</span><span class="p">,</span>
    <span class="n">cid</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">del</span> <span class="n">nids</span><span class="p">,</span> <span class="n">out</span>
</pre></div>
</div>
<text style=color:blue>DEBUG:   bdf.py:1006                  ---starting BDF.read_bdf of c:\nasa\m4\formats\git\pynastran\pyNastran\..\models\bwb\bwb_saero.bdf---
</text><text style=color:blue>DEBUG:   pybdf.py:556                 opening 'c:\\nasa\\m4\\formats\\git\\pynastran\\models\\bwb\\bwb_saero.bdf'
</text><text style=color:blue>DEBUG:   cross_reference.py:151       Cross Referencing...
</text><text style=color:blue>DEBUG:   bdf.py:1054                  ---finished BDF.read_bdf of c:\nasa\m4\formats\git\pynastran\pyNastran\..\models\bwb\bwb_saero.bdf---
</text><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyNastran.bdf.utils</span> <span class="kn">import</span> <span class="n">parse_patran_syntax_dict</span>
<span class="n">elems_nids</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;Elem 1396 1397 1398 1399 1418 1419 1749 1750 1751 1752 2010 2011 2012 2620 2621 2639 2640 2641 1247:1251 1344:1363 1372:1380 1526:1536 1766:1774 1842:1851 2141:2152 2310:2321 2342:2365 2569:2577 2801:2956 3081:3246 3683:3742 3855:3920 4506:4603 4968:5047 5070:5175 5298:5469 5494:5565 5837:5954 &#39;</span>
    <span class="s1">&#39;Node 2795 2796 2797 2798 3104 3106 3107 3132 3133 3135 3136 3137 3746 3747 3748 3749 3751 3752 3753 3754 3756 3757 3758 3759 3761 3762 3763 3764 3766 3767 3768 3769 3771 3772 3773 3774 3776 3777 3778 3779 3781 3782 3783 3784 3791 3792 3793 3796 3797 3798 3801 3802 3803 3806 3807 3808 3811 3812 3813 3816 3817 3818 3821 3822 3823 3826 3827 3828 4334 4335 4336 4338 4339 4340 4343 4344 4347 4348 4350 4351 4352 4354 4355 4356 4359 4360 4363 4364 4367 4368 4371 4372 4374 4375 4376 4378 4379 4382 4383 4385 4386 4387 4389 4390 4391 4394 4395 4398 4399 4401 4402 4403 4405 4406 4407 4409 4410 4411 4413 4414 4415 4418 4419 4593 4594 4596 4597 4599 4600 4602 4603 4605 4606 4608 4609 4611 4612 4614 4615 4617 4618 4620 4621 5818 5819 5820 5822 5823 5824 5826 5827 5828 5830 5831 5832 5834 5835 5836 5838 5839 5840 5842 5843 5844 5846 5847 5848 5850 5851 5852 5854 5855 5856 5872 5873 5874 5876 5877 5878 5880 5881 5882 5884 5885 5886 5888 5889 5890 5892 5893 5894 5896 5897 5898 5900 5901 5902 5904 5905 5906 6203 6204 6205 6206 6208 6209 6210 6211 6213 6214 6215 6216 6218 6219 6220 6221 6223 6224 6225 6226 6228 6229 6230 6231 6233 6234 6235 6236 6238 6239 6240 6241 6243 6244 6245 6246 6255 6256 6257 6263 6264 6265 6266 6268 6269 6270 6271 6273 6274 6275 6276 6278 6279 6280 6281 6283 6284 6285 6286 6288 6289 6290 6291 6293 6294 6295 6296 6298 6299 6300 6301 6303 6304 6305 6306 6355 6356 6357 6359 6360 6361 6363 6364 6365 6367 6368 6369 6371 6372 6373 6375 6376 6377 6379 6380 6381 6383 6384 6385 6411 6412 6414 6415 6417 6418 6420 6421 6423 6424 6426 6427 6429 6430 6432 6433 6435 6436 6438 6439 6441 6442 6459 6460 6462 6463 6465 6466 6468 6469 6471 6472 6474 6475 6477 6478 6480 6481 6483 6484 6486 6487 6489 6490 1201506 1201531 1202016 1202039 1202764 1202767 1202768 1202770 1202771 1202773 1202774 1202776 1202779 1202780 1202782 1202783 1202785 1202786 1202788 1203040 1316:1327 1444:1473 1490:1507 1531:1538 1563:1567 1710:1729 2008:2016 2039:2054 2136:2153 2351:2356 2507:2528 2720:2729 2731:2735 2764:2793 3040:3055 3339:3346 3348:3355 3357:3364 3366:3373 3375:3382 3384:3391 3396:3406:2 3407:3414 3424:3431 3433:3440 3442:3449 3451:3458 3460:3467 3469:3476 3481:3491:2 3492:3499 3658:3668 3670:3680 3682:3692 3705:3715 3717:3727 3729:3739 4560:4589 5290:5298 5300:5308 5310:5318 5320:5328 5339:5347 5349:5357 5359:5367 5369:5377 5858:5870 5947:5994 6001:6005 6007:6011 6013:6017 6019:6023 6025:6029 6031:6035 6037:6041 6043:6047 6309:6314 6319:6350 6445:6455 6811:6819 6821:6829 6831:6839 6841:6849 6851:6859 6870:6878 6880:6888 6890:6898 6900:6908 6910:6918 1201316:1201326:2 1201464:1201473 1201533:1201537:2 1202041:1202053:2 1202136:1202152:2 1202351:1202355:2 1202507:1202527:2 1202731:1202735 1203042:1203052:2 1203424:1203431 1203433:1203440 1203442:1203449 1203451:1203458 1203460:1203467 1203469:1203476 1203481:1203491:2 1203492:1203499 1203705:1203715 1203717:1203727 1203729:1203739 1205339:1205347 1205349:1205357 1205359:1205367 1205369:1205377 1206870:1206878 1206880:1206888 1206890:1206898 1206900:1206908 1206910:1206918 &#39;</span>
<span class="p">)</span>
<span class="c1"># print(elems_nids)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">parse_patran_syntax_dict</span><span class="p">(</span><span class="n">elems_nids</span><span class="p">)</span>
<span class="n">eids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Elem&#39;</span><span class="p">]</span>
<span class="n">nids</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Node&#39;</span><span class="p">]</span>
<span class="c1">#print(data, type(data))</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">isubcase</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">grid_point_forces</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">grid_point_forces</span><span class="p">[</span><span class="n">isubcase</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">grid_point_forces</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()))</span>
<span class="c1">#print(grid_point_forces.object_methods())</span>

<span class="c1"># global xyz</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">bdf_model</span><span class="o">.</span><span class="n">coords</span>

<span class="c1"># some more data</span>
<span class="n">coord_out</span> <span class="o">=</span> <span class="n">bdf_model</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">summation_point</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
<span class="c1">#summation_point = [1197.97, 704.153, 94.9258]  # ~center of interface line</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">bdf_model</span><span class="o">.</span><span class="n">log</span>
<span class="n">forcei</span><span class="p">,</span> <span class="n">momenti</span><span class="p">,</span> <span class="n">force_sumi</span><span class="p">,</span> <span class="n">moment_sumi</span> <span class="o">=</span> <span class="n">grid_point_forces</span><span class="o">.</span><span class="n">extract_interface_loads</span><span class="p">(</span>
    <span class="n">nids</span><span class="p">,</span> <span class="n">eids</span><span class="p">,</span>
    <span class="n">coord_out</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span>
    <span class="n">nid_cd</span><span class="p">,</span>
    <span class="n">icd_transform</span><span class="p">,</span>
    <span class="n">xyz_cid0</span><span class="p">,</span>
    <span class="n">summation_point</span><span class="o">=</span><span class="n">summation_point</span><span class="p">,</span>
    <span class="n">consider_rxf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">itime</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
<span class="c1"># print(forcei, force_sumi)</span>
<span class="c1"># print(momenti, moment_sumi)</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;force  = </span><span class="si">{</span><span class="n">force_sumi</span><span class="si">}</span><span class="s1">; total=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">force_sumi</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;moment = </span><span class="si">{</span><span class="n">moment_sumi</span><span class="si">}</span><span class="s1">; total=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">moment_sumi</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<pre class="literal-block">
  type=RealGridPointForcesArray nelements=2 total=56033
  data: [1, ntotal, 6] where 6=[f1, f2, f3, m1, m2, m3]
  data.shape=(1, 56033, 6)
  element type: <em>TOTALS</em>, APP-LOAD, BAR, F-OF-MPC, F-OF-SPC, QUAD4, TRIA3
  sort1
  lsdvmns = [0]

force  = [    -0.05078125     -0.08984375 126271.086     ]; total=126271.09
moment = [ 1.1500996e+08 -1.5267941e+08  2.0000000e+01]; total=191149920.00
</pre>
<div class="figure align-default" id="id3">
<img alt="image.png" src="quick_start/op2_examples/attachment:image.png" />
<p class="caption"><span class="caption-text">image.png</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="op2_pandas_DataFrames.html" class="btn btn-neutral float-right" title="Transient DataFrames in PyNastran" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="op2_demo_numpy1.html" class="btn btn-neutral float-left" title="OP2 Numpy Demo #1 (Displacement, Solid Stress)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Steven Doyle.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>